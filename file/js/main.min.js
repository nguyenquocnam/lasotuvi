const DOMAIN = "api/v1",
    WebsocketUrl = "wss://tuvi.vn/api/v1/ws",
    APIs = {
        users: {
            update: `${DOMAIN}/users`,
            updateAvatar: `${DOMAIN}/users/avatar`,
            changePassword: `${DOMAIN}/users/change-password`,
            savedList: `${DOMAIN}/users/saved-list`
        },
        auth: {
            resendToken: `${DOMAIN}/auth/resent-token`,
            changePassword: `${DOMAIN}/auth/change-password`,
            forgotPassword: `${DOMAIN}/auth/forgot-password`,
            changeForgotPassword: `${DOMAIN}/auth/reset-forgotten-password`
        },
        categories: {
            get: `${DOMAIN}/categories`
        },
        laSo: {
            luuNien: `${DOMAIN}/la-so/sao-luu-nien`,
            get: `${DOMAIN}/la-so`,
            luanGiai: `https://tuvi.vn/api/v1/luan-giai2`
        },
        others: {
            lichVanNien: `${DOMAIN}/lich-van-nien`,
            canXuong: `${DOMAIN}/can-xuong`,
            systemReport: `${DOMAIN}/system-report`,
            masterContact: `${DOMAIN}/master/contact`
        },
        payments: {
            requestPayment: `${DOMAIN}/payments/request`,
            hubCard: `${DOMAIN}/payments/hub-card/request`,
            banking: `${DOMAIN}/banking`,
            request: `${DOMAIN}/master/payment`
        },
        ranking: {
            get: `${DOMAIN}/users/ranking`
        },
        markets: {
            top: `${DOMAIN}/markets/top`,
            topics: `${DOMAIN}/markets/topics`,
            masterTopics: `${DOMAIN}/markets/master/topics`,
            comment: `${DOMAIN}/markets/comments`,
            commentMaster: `${DOMAIN}/markets/comments/master`,
            private: `${DOMAIN}/markets/comments/private`,
            report: `${DOMAIN}/markets/comments/report`,
            like: `${DOMAIN}/markets/comments/like`,
            unLike: `${DOMAIN}/markets/comments/unlike`,
            unLock: `${DOMAIN}/markets/comments/unlocks`
        },
        notifications: {
            get: `${DOMAIN}/users/notifications`
        },
        moderators: {
            deleteComment: `${DOMAIN}/markets/comments/delete`,
            deleteTopic: `${DOMAIN}/markets/topics/delete`
        },
        master: {
            get: `${DOMAIN}/users/master`
        },
        media: {
            upload: `${DOMAIN}/medias/images/upload`
        },
        gift: {
            code: `${DOMAIN}/gift/code`
        },
        article: {
            get: `${DOMAIN}/article`
        }
    },
    LIMIT = 6,
    Agents = {
        methods: {
            GET: "GET",
            POST: "POST",
            DELETE: "DELETE",
            PUT: "PUT"
        },
        headers: {
            "Content-Type": "application/json"
        },
        headersUpload: {},
        request: function(t, e, a, n, i) {
            const o = {
                url: t,
                type: e,
                timeout: 3e3,
                headers: this.headers,
                async: !0,
                cache: !1,
                dataType: "json",
                contentType: "application/json; charset=UTF-8",
                success: function(t) {
                    n && n(t)
                },
                error: function(t) {
                    i && i(t)
                }
            };
            return a && (o.data = JSON.stringify(a)), $.ajax(o)
        },
        upload: function(t, e, a, n, i) {
            var o = {
                url: t,
                method: e,
                timeout: 0,
                headers: this.headersUpload,
                processData: !1,
                contentType: "application/json; charset=UTF-8",
                mimeType: "multipart/form-data",
                contentType: !1,
                data: a,
                success: function(t) {
                    if ($("#spinnerReportSystem").hide(), n) {
                        var e = JSON.parse(t);
                        n(e)
                    }
                },
                error: function(t) {
                    i && i(t)
                }
            };
            $.ajax(o)
        },
        get: function(t, e, a) {
            this.request(t, this.methods.GET, void 0, e, a)
        },
        post: function(t, e, a, n) {
            this.request(t, this.methods.POST, e, a, n)
        },
        put: function(t, e, a, n) {
            this.request(t, this.methods.PUT, e, a, n)
        },
        delete: function(t, e, a, n) {
            this.request(t, this.methods.DELETE, e, a, n)
        }
    },
    EmailRegex = /^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,
    PasswordRegex = /^\S{6,30}$/,
    NameRegex = /^[a-zA-Z]+(([',. -][a-zA-Z ])?[a-zA-Z]*)*$/,
    UsernameRegex = /^[a-zA-Z_0-9]{3,60}$/,
    PhoneRegex = /(84|0[3|5|7|8|9])+([0-9]{8})\b/,
    AddressRegex = /^.{3,500}$/,
    IdCardRegex = /^([0-9]{9,13})$/,
    GOOGLE_CLIENT_ID = "1099497528626-k99ptin422coajg1hdcnub13nh4keh3k.apps.googleusercontent.com",
    FACEBOOK_APP_ID = "516868156385418",
    commentDefaultTemplate = '<div class="d-flex regular-mb ${item.is_sub}" id="comment-${item.id}" data-sub-id="${item.id_comment}"> <a href="/${item.user.username}"><img class="cmt-avt" src="${item.user.avatar}" alt=""></a> <div> <div class="d-flex align-items-center"> <div class="cmt-bubble"> <div class="change-flex-direction-500"> <div class="d-flex align-items-center"> <a href="/${item.user.username}"><div class="txt-content-bold m-r-5 line-clamp-1">${item.user.name}</div></a> <img src="/public/images/icon/professor-verify.png" class="icon-professor-verify regular-mr ${item.user.is_teacher}"/> </div> <div class="d-flex align-items-center"> <div class="user-medal-rank user-medal-rank-${item.user.rank.id} zoom-half mr-2"></div> <div class="txt-sub-content line-clamp-1 user-title-rank-${item.user.rank.id}"> ${item.user.rank.title} </div> </div> </div> <div class="txt-content small-mt text-break white-space-pl content-comment-topic" id="content-comment-topic" data-id="${item.id}" data-sub-id="${item.id_comment}"> {{html item.content_new}} </div> </div> </div> <div class="d-flex align-items-center mt-1"> <button class="btn txt-sub-content text-secondary hover-line-color cmt-act-btn ${item.liked} btn-like-comment" data-id="${item.id}" data-sub-id="${item.id_comment}"> Thích </button> <div class="like-count txt-sub-content ${item.null_like}">${item.like_count}</div> <button class="btn txt-sub-content text-secondary hover-line-color cmt-act-btn btn-rep-comment" id="btn-rep-comment" data-id="${item.id}" data-sub="${item.isSub}" data-sub-id="${item.id_comment}">Trả lời </button> <div class="txt-sub-content text-secondary regular-pl">${item.time}</div> <button class="btn cmt-option-btn hover-line-color btn-more-action-comment rotation-90 m-l-15" type="button" data-toggle="dropdown"> <img class="cmt-option-icon" src="/public/images/icon/cmt-option.png"> </button> <ul class="dropdown-menu view-list-action-comment text-center p-0 cursor-pointer" role="menu" aria-labelledby="menu1"> <li role="presentation" class="text-action-comment edit-comment txt-content ${item.owner_cmt}" data-toggle="modal" data-target="#editCommentModal" data-content="${item.content}" data-type="${item.type}" data-id="${item.id}" data-sub-id="${item.id_comment}">Sửa </li> <li role="presentation" data-id="${item.id}" data-sub-id="${item.id_comment}" data-toggle="modal" data-target="#checkDeleteCommentModal" class="text-action-comment delete-comment txt-content ${item.owner_delete}" data-type="${item.type}">Xóa </li> <li role="presentation" data-id="${item.id}" data-sub-id="${item.id_comment}" class="text-action-comment report-comment txt-content ${item.owner_report}" data-toggle="modal" data-target="#reportCommentModal">Báo cáo </li> <li role="presentation" data-id="${item.id}" data-sub-id="${item.id_comment}" class="text-action-comment txt-content ${item.is_mod} mode-hide-comment-topic" data-name="modHideComment" data-toggle="modal" data-target="#modalHideForMod">Ẩn bình luận</li> </ul> </div> </div> </div>',
    MAX_LENGTH_TITLE_TOPIC = 500,
    LoadFunctions = {
        "/": initHomeScreen,
        "/thong-ke-can-xuong-doan-so": initThongKeCanXuongScreen,
        "/dong-gop-y-kien": initSystemReportScreen,
        "/login": initLoginScreen,
        "/register": initRegisterScreen,
        "/profile": initProfileScreen,
        "/forgot-password": initForgotPassword,
        "/cho-la-so": initChoLasoScreen,
        "/payment": initPayment,
        "/thu-vien-tu-vi": initThuVienTuViScreen,
        "/payment/callBack": initPaymentCallback,
        "/ho-tro-va-hoi-dap": initQAScreen,
        "/cho-la-so/top-la-so": initTopTopicScreen,
        "/chinh-sach-danh-cho-thay": initTeacherPolicyScreen,
        "/yeu-cau-thanh-toan": initPaymentRequestScreen,
        "/dang-la-so": initDangLaSoScreen
    };

function playAudio() {
    document.getElementById("noti-bell").play()
}

function pauseAudio() {
    document.getElementById("noti-bell").pause()
}

function loadTopTopicsDefault() {
    const t = $("#containerTopTopic");
    Agents.get(`${APIs.markets.topics}?pageSize=10&pageNumber=1`, function(e) {
        if (200 == e.code) {
            const a = e.data.data;
            a && a.forEach((e, a) => {
                e.budgetFormatted = formatPrice(e.budget_display);
                let n = e.laso.can_chi_tuoi;
                e.background = getAnimalClass(n.split(" ")[1]);
                let i = e.laso.cuc_cua_tuoi;
                e.colorBackground = getColorNguHanhClass(i.split(" ")[0]), e.user.avatar || (e.user.avatar = "/public/images/avt-default.jpg"), e.active = 0 == a ? "active" : "", $("#cardTopTopic").tmpl(e).appendTo(t)
            }), $("#top-carousel").on("slide.bs.carousel", function(t) {
                var e = $(t.relatedTarget).index(),
                    a = $("#top-carousel .carousel-item").length;
                if (e >= a - 4)
                    for (var n = 5 - (a - e), i = 0; i < n; i++) "left" == t.direction ? $("#top-carousel .carousel-item").eq(i).appendTo(".carousel-inner") : $("#top-carousel .carousel-item").eq(0).appendTo(".carousel-inner")
            })
        } else {
            $("#containerTop").addClass("d-none")
        }
    }), $("#btnUpLaso").on("click", function(t) {
        isLogged() ? window.location.replace("/dang-la-so") : openModalLogin(t, "/dang-la-so")
    }), $("#btnPushTop").on("click", function(t) {
        isLogged() ? window.location.replace("/profile?tab=3") : openModalLogin(t, "/profile?tab=3")
    })
}

function loadNotification(t, e) {
    $("#" + t).append('<div class="spinner-border" style="margin-left: 50%" role="status"><span class="sr-only">Loading...</span></div>'), Agents.get(APIs.notifications.get + "?limit=10&page=" + e, function(e) {
        const a = e.data;
        if (a) {
            const e = a.data,
                n = a.page,
                i = a.page_info.has_next_page;
            e ? (e.forEach(function(t) {
                t.time = sinceTime(t.created);
                const e = t.action;
                e.actor && "" == e.actor.avatar && (e.actor.avatar = "/public/images/icon/ic_default_avt.jpg"), e.actionStr = convertActionToStr(e.action), e.targetStr = getTargetName(e.target_module, e.target_object), e.preTarget = getPreTarget(e.target_module), t.href = getHref(e.target_module, e.target_object)
            }), $("#" + t).find(".spinner-border").remove(), $("#uNotiTemplate").tmpl(e).appendTo("#" + t), $("#" + t).attr("data-page", n), $("#" + t).attr("data-has-next", i)) : ($("#" + t).find(".spinner-border").remove(), $("#" + t).append('<div class="text-center txt-content-mid m-t-10">Chưa có thông báo</div>'))
        }
    }, function(e) {
        $("#" + t).find(".spinner-border").remove()
    })
}

function convertActionToStr(t) {
    return "COMMENT" == t ? "đã trả lời" : "LIKE" == t ? "đã thích" : "UNLOCK" == t ? "đã mở khoá" : "TAG_MASTER" == t ? "đã mời thầy xem" : void 0
}

function getTargetName(t, e) {
    return "market_topic" == t ? e.title || "" : "market_topic_comment" == t ? e && e.topic ? e.topic.title : "" : void 0
}

function getPreTarget(t) {
    return "market_topic" == t ? "bài viết lá số" : "market_topic_comment" == t ? "bình luận trong lá số" : void 0
}

function getHref(t, e) {
    let a = "",
        n = "";
    return e && (a = e.id || "", n = e.topic ? e.topic.slug || "" : e.slug || ""), "market_topic" == t ? "/" + n : "market_topic_comment" == t ? "/" + n + "?comment=" + a : void 0
}

function isMobile() {
    const t = {
        Android: function() {
            return navigator.userAgent.match(/Android/i)
        },
        BlackBerry: function() {
            return navigator.userAgent.match(/BlackBerry/i)
        },
        iOS: function() {
            return navigator.userAgent.match(/iPhone|iPad|iPod/i)
        },
        Opera: function() {
            return navigator.userAgent.match(/Opera Mini/i)
        },
        Windows: function() {
            return navigator.userAgent.match(/IEMobile/i)
        },
        any: function() {
            return t.Android() || t.BlackBerry() || t.iOS() || t.Opera() || t.Windows()
        }
    };
    return isMobileDevice = t.any()
}


$(function() {
	
 
    const t = window.location.pathname;


    if ( isLaSoScreen(t)) initLasoScreen(t);
    else if (t.startsWith("/xem-ngay-tot-xau")) initBadGoodDayScreen();
    else if (isTopicScreen(t)) initLasoScreen(t), initDetailTopic(t);
    else if (t.startsWith("/payment/callback")) initPaymentCallback();
    else {
        const e = LoadFunctions[t];
        e ? e() : initProfileGuestScreen()
    }

    function e(t) {
        t.getBasicProfile();
        const e = t.getAuthResponse().access_token,
            a = $('input[name="previous"]'),
            n = a && "" !== a.val() ? a.val() : "/",
            i = encodeURIComponent(n);
        e ? window.location.href = "/social-login?type=GOOGLE&previous=" + i + "&token=" + e : openModalHaveError("Có lỗi xảy ra!", "Vui lòng thử lại")
    }
    $(".fb-like").attr("data-href", window.location.href), $(".fb-save").attr("data-uri", window.location.href), $(".fb-share-button").attr("data-href", window.location.href), $("#scrollTop").on("click", function() {
        topFunction()
    }), $("#btn-read-more").on("click", function(t) {
        "none" === $("#dots").css("display") ? ($("#dots").css("display", "inline"), $("#btn-read-more").text("xem thêm"), $("#moreTxt").css("display", "none")) : ($("#dots").css("display", "none"), $("#btn-read-more").text("Thu gọn"), $("#moreTxt").css("display", "inline"))
    }), $("#close-modal-la-so").click(function() {
        $("#modal-la-so").css("display", "none"), $("body").css("overflow", "");
        const t = $("#table-la-so"),
            e = $("#binh-giai-tong-quan"),
            a = $("#binh-giai-12-cung"),
            n = $("#binh-giai-dai-van"),
            i = $("#binh-giai-tieu-van");
        $("#wide-left-content").append(e, a, n, i), t.removeAttr("style"), $("#content-la-so").append(t)
    }), $("button[name=toLogin]").on("click", function() {
        const t = window.location,
            e = encodeURIComponent(t);
        window.location.href = "/login?previous=" + e
    }), $("button[name=toRegister]").on("click", function() {
        window.location.href = "/register"
    }), $("#btn-logout-sidebar").on("click", function() {
        window.location.href = "/logout"
    }), $("#btnSignInGoogle").on("click", function(t) {
        auth2.signIn().then(e, function(t) {
            openModalHaveError("Có lỗi xảy ra!", "Vui lòng thử lại")
        })
    }), $("#btnSignInFB").on("click", function() {
        FB.login(function(t) {
            if (t.authResponse) {
                const e = t.authResponse.accessToken || null,
                    a = $('input[name="previous"]'),
                    n = a && "" !== a.val() ? a.val() : "/",
                    i = encodeURIComponent(n);
                e ? window.location.href = "/social-login?type=FACEBOOK&previous=" + i + "&token=" + e : openModalHaveError("Có lỗi xảy ra!", "Vui lòng thử lại")
            } else openModalHaveError("Có lỗi xảy ra!", "Vui lòng thử lại")
        }, {
            scope: "email,user_likes"
        })
    }), $("#btn-show-noti-box").on("click", function() {
        $("#noti-box").removeClass("hide-noti-box"), $("#noti-box").addClass("show-noti-box");
        const t = $("#noti-web-count");
        t.empty(), $(t.parent()).addClass("d-none"), $(t.parent()).removeClass("d-flex")
    }), $("#btn-hide-noti-box").on("click", function() {
        $("#noti-box").removeClass("show-noti-box"), $("#noti-box").addClass("hide-noti-box")
    }), $("#btn-show-noti-box-mobile").on("click", function() {
        $("#noti-box-mobile").removeClass("d-none"), $("#noti-box-mobile").addClass("d-block"), $("#btn-hide-noti-box-mobile").removeClass("d-none"), $("#btn-hide-noti-box-mobile").addClass("d-block"), document.body.style.overflow = "hidden", $("#noti-mobile-count").addClass("d-none"), $("#noti-mobile-count").empty()
    }), $("#btn-hide-noti-box-mobile").on("click", function() {
        $("#noti-box-mobile").removeClass("d-block"), $("#noti-box-mobile").addClass("d-none"), $("#btn-hide-noti-box-mobile").removeClass("d-block"), $("#btn-hide-noti-box-mobile").addClass("d-none"), document.body.style.overflow = "auto"
    }), isLogged() && (isMobile() ? (loadNotification("user-noti-box-mobile", 1), $("#user-noti-box-mobile").on("scroll", function() {
        if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
            const t = $(this).attr("data-page");
            if ("true" == $(this).attr("data-has-next")) {
                loadNotification("user-noti-box-mobile", parseInt(t) + 1)
            }
        }
    })) : (loadNotification("noti-box-web", 1), $("#noti-box-web").on("scroll", function() {
        if ($(this).scrollTop() + $(this).innerHeight() >= $(this)[0].scrollHeight) {
            const t = $(this).attr("data-page");
            if ("true" == $(this).attr("data-has-next")) {
                loadNotification("noti-box-web", parseInt(t) + 1)
            }
        }
    }))), loadTopTopicsDefault()
}), $(window).on("load", function() {
    var t, e, a, n, i;
    
});
const ResizeFunc = {
    "": resizeInHome,
    "/": resizeInHome,
    "/cho-la-so": resizeChoLaso
};

function initWebsocket() {
    if (window.WebSocket) {
        const t = new WebSocket(WebsocketUrl);
        t.onopen = function() {}, t.onclose = function(t) {}, t.onmessage = function(t) {
            const e = t.data;
            if (e) {
                const t = JSON.parse(e).content;
                if (t) {
                    var a = JSON.parse(t);
                    switch (a.type || 0) {
                        case 1:
                            handlerNotiUseFunction(a.data);
                            break;
                        case 2:
                            handlerNoti(a.data);
                            break;
                        case 3:
                            handlerNotiModDelTopic(a.data);
                            break;
                        case 4:
                            handlerNotiModDelCmt(a.data);
                            break;
                        case 5:
                            handlerUploadBalance(a.data)
                    }
                }
            }
        }
    }
}
var ringTimeOut;

function handlerNoti(t) {
    if (isMobile()) {
        notiItemHandler("user-noti-box-mobile", t);
        const a = $("#noti-mobile-count"),
            n = a.html().toString().trim() || "";
        var e = 1;
        n && (e = parseInt(n), e++), a.html(e), a.removeClass("d-none")
    } else {
        ringTimeOut || ($("img.user-noti-bell").css("animation", "ringbell 1200ms infinite"), playAudio(), ringTimeOut = setTimeout(function() {
            $("img.user-noti-bell").css("animation", ""), window.clearTimeout(ringTimeOut), ringTimeOut = null
        }, 3e3)), notiItemHandler("noti-box-web", t);
        const a = $("#noti-web-count"),
            n = a.html().toString().trim() || "";
        e = 1;
        n && (e = parseInt(n), e++), a.text(e), $(a.parent()).removeClass("d-none"), $(a.parent()).addClass("d-flex")
    }
}

function handlerUploadBalance(t) {
    let e = t.user ? t.user.balance : 0;
    e && (e = formatPrice(e), $("p[data-id=userBalance]").text(e))
}

function handlerNotiModDelTopic(t) {
    if (t) {
        $(`div[data-id-current-topic=${t}]`) && (window.location.href = "/cho-la-so")
    }
}

function handlerNotiModDelCmt(t) {
    if (t && !checkMod()) {
        let e = $(`#comment-${t}`);
        e && e.remove()
    }
}

function handlerNotiUseFunction(t) {
    if (!isMobile()) {
        const a = $("#notiContainer"),
            n = GenId(),
            i = {
                id: n,
                data: t
            },
            o = `\n                        <script>\n                             $('#p-${n} button.push-notification-close-area').on('click',function (){\n                                   var parent = $(this).parent()\n                                    $(parent).fadeOut(300, function () {\n                                        $(this).remove();\n                                    });\n                             })\n                              setInterval(function () {\n                                  let self = this;\n                                        $('#p-${n}').fadeOut(300, function () {\n                                            $(this).remove();\n                                            clearInterval(self)\n                                        });\n                               }, 10000)\n                         <\/script>\n                        `;
        var e = $("#notification").tmpl(i);
        a.append(e), a.append(o)
    }
}

function notiItemHandler(t, e) {
    e.time = sinceTime(e.created);
    const a = e.action;
    a.actor && "" == a.actor.avatar && (a.actor.avatar = "/public/images/icon/ic_default_avt.jpg"), a.actionStr = convertActionToStr(a.action), a.targetStr = getTargetName(a.target_module, a.target_object), a.preTarget = getPreTarget(a.target_module), e.href = getHref(a.target_module, a.target_object);
    var n = $("#uNotiTemplate").tmpl(e);
    $("#" + t).prepend(n)
}

function validateEmail(t) {
    return !!t && EmailRegex.test(t)
}

function validatePassword(t) {
    if (t) return PasswordRegex.test(t)
}

function validateUsername(t) {
    if (t) return UsernameRegex.test(t)
}

function validateName(t) {
    if (t) return t.length >= 3 && t.length <= 50 && NameRegex.test(removeAscent(t))
}

function removeAscent(t) {
    return null == t ? t : t = (t = (t = (t = (t = (t = (t = (t = t.toLowerCase()).replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a")).replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e")).replace(/ì|í|ị|ỉ|ĩ/g, "i")).replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o")).replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u")).replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y")).replace(/đ/g, "d")
}

function validatePhone(t) {
    if (t) return PhoneRegex.test(t)
}

function validateAddress(t) {
    if (t) return AddressRegex.test(t)
}

function validateIdCard(t) {
    if (t) return IdCardRegex.test(t)
}
$(window).resize(function() {
    const t = window.location.pathname;
    if ($(window).width() > 768 && ($("#sidebar").removeClass("active"), $(".overlay").removeClass("active"), $("body").removeClass("no-scroll"), $(".header-content-mobile").css("display", "")), isLaSoScreen(t) || isTopicScreen(t)) resizeLaSo();
    else {
        const e = ResizeFunc[t];
        e && e()
    }
}).resize();
const Validate = {
    email: validateEmail,
    password: validatePassword,
    name: validateName,
    phone: validatePhone,
    address: validateAddress,
    idCard: validateIdCard,
    username: validateUsername
};

function isTopicScreen(t) {
    if (-1 != t.indexOf("?")) {
        var e = t.split("?");
        e.length > 1 && (t = e[0])
    }
    return /-t\d*$/.test(t)
}

function isLaSoScreen(t) {
    if (-1 != t.indexOf("?")) {
        var e = t.split("?");
        e.length > 1 && (t = e[0])
    }
    return t.startsWith("/la-so")
}

function isLogged() {
    return "true" == $("body").attr("data-logged")
}

function getTOKEN() {
    var t = $("body").attr("data-token");
    return t ? (Agents.headers = {
        "X-TU-VI": t
    }, t) : ""
}

function openModalLogin(t, e) {
    if (t && t.hasOwnProperty("target")) {
        const a = $(t.target);
        a && a.length && (a.attr("data-target", "#modalRequiredLogin"), a.attr("data-toggle", "modal"), $("#modalRequiredLogin").find("#cfLogin").on("click", function() {
            const t = window.location.href;
            e || (e = encodeURIComponent(t)), window.location.href = "/login?previous=" + e
        }))
    }
}

function openModalHideMod(t, e) {
    let a = parseInt(t) || 0;
    if (a) {
        const t = {
            id: a
        };
        e ? Agents.post(APIs.moderators.deleteComment, t, function(t) {
            if ("200" == t.code) {
                var n = $(`.content-comment-topic[${e}=${a}]`),
                    i = $(n[0]);
                i.empty(), i.text("Nội dung đã bị ẩn bởi quản lý Tuvi.vn")
            }
        }, function(t) {}) : Agents.post(APIs.moderators.deleteTopic, t, function(t) {
            "200" == t.code && (window.location.href = "/cho-la-so")
        }, function(t) {})
    }
}

function openModalHaveError(t, e) {
    $("#titleErrMes").text(t), $("#contentErrMes").text(e), $("#modalError").modal("show")
}

function initQC() {
    const t = [{
        width: 728,
        height: 90,
        href: "https://tuvi.vn/thong-ke-can-xuong-doan-so",
        image: "/public/images/qc/qc-thong-ke-can-xuong.jpg"
    }, {
        href: "https://tuvi.vn/cho-la-so",
        image: "/public/images/qc/qc-cho-la-so.jpg",
        width: 970,
        height: 90
    }, {
        width: 200,
        height: 200,
        href: "https://tuvi.vn/can-xuong-doan-so",
        image: "/public/images/qc/qc-can-xuong-tinh-so.jpg"
    }, {
        width: 200,
        height: 200,
        href: "https://tuvi.vn/xem-tuoi-vo-chong",
        image: "/public/images/qc/qc-xem-tuoi-ket-hon.jpg"
    }, {
        width: 300,
        height: 250,
        href: "https://tuvi.vn/lap-la-so-tu-vi",
        image: "/public/images/qc/qc-lap-la-so.jpg"
    }, {
        width: 300,
        height: 250,
        href: "https://tuvi.vn/tu-vi-2021-cua-12-con-giap-du-bao-chinh-xac-van-han-moi-phuong-dien-nam-tan-suu-a1",
        image: "/public/images/qc/qc-tu-vi-12-con-giap.jpg"
    }, {
        width: 468,
        height: 60,
        href: "https://tuvi.vn/lich-van-nien",
        image: "/public/images/qc/qc-lich-van-nien.jpg"
    }, {
        width: 300,
        height: 100,
        href: "https://tuvi.vn/cho-la-so",
        image: "/public/images/qc/qc-cho-la-so-mobile.jpg"
    }, {
        width: 300,
        height: 100,
        href: "https://tuvi.vn/tu-vi-2021-cua-12-con-giap-du-bao-chinh-xac-van-han-moi-phuong-dien-nam-tan-suu-a1",
        image: "/public/images/qc/qc-tu-vi-12-con-giap-mobile.jpg"
    }];

    function e(e, a) {
        const n = [];
        for (let o = 0; o < t.length; o++) {
            var i = t[o];
            i.width == e && i.height == a && n.push(i)
        }
        return 1 == n.length ? n[0] : n.length > 0 ? n[Math.floor(Math.random() * n.length)] : void 0
    }

    function a(t, e) {
        if (t && e) {
            let a = e.href || "",
                n = e.image || "",
                i = e.width || 300,
                o = e.height || 100;
            t.html(`\n                <a target="_blank" href="${a}"><img alt="tuvi-banner" width="${i}" height="${o}" src="${n}"/></a>\n            `)
        }
    }
    const n = $(".zoom-qc");
    for (let t = 0; t < n.length; t++) {
        const i = n[t],
            o = $(i);
        if (o.is(":visible")) {
            const t = o.attr("data-qc-width"),
                n = o.attr("data-qc-height");
            if (t && n) {
                a(o, e(t, n))
            }
        }
    }
}

function GenId() {
    return "_" + Math.random().toString(36).substr(2, 9)
}

function goToByScroll(t) {
    t = t.replace("link", "");
    const e = $("#" + t);
    if (e && e.length > 0) {
        var a = e.offset().top;
        $("html,body").animate({
            scrollTop: a - 45
        }, "slow")
    }
}

function sinceTime(t) {
    var e = Math.floor((new Date - new Date(t)) / 1e3);
    if (e > 0) {
        var a = e / 31536e3;
        return a > 1 ? Math.floor(a) + " năm trước" : (a = e / 2592e3) > 1 ? Math.floor(a) + " tháng trước" : (a = e / 86400) > 1 ? Math.floor(a) + " ngày trước" : (a = e / 3600) > 1 ? Math.floor(a) + " giờ trước" : (a = e / 60) > 1 ? Math.floor(a) + " phút trước" : Math.floor(e) + " giây trước"
    }
    return "Vừa xong"
}

function getIconTagTopic(t) {
    if (!t) return "";
    switch (t) {
        case 1:
            return '<div class="tag-cate-icon tag-cate-career zoom-half"></div>';
        case 2:
            return '<div class="tag-cate-icon tag-cate-friends zoom-half"></div>';
        case 3:
            return '<div class="tag-cate-icon tag-cate-couple zoom-half"></div>';
        case 4:
            return '<div class="tag-cate-icon tag-cate-child zoom-half"></div>';
        case 5:
            return '<div class="tag-cate-icon tag-cate-love zoom-half"></div>';
        case 6:
            return '<div class="tag-cate-icon tag-cate-economy zoom-half"></div>';
        case 7:
            return '<div class="tag-cate-icon tag-cate-health zoom-half"></div>';
        case 8:
            return '<div class="tag-cate-icon tag-cate-emigrate zoom-half"></div>';
        case 9:
            return '<div class="tag-cate-icon tag-cate-colleague zoom-half"></div>';
        case 10:
            return '<div class="tag-cate-icon tag-cate-ancestor zoom-half"></div>';
        case 11:
            return '<div class="tag-cate-icon tag-cate-parents zoom-half"></div>';
        case 12:
            return '<div class="tag-cate-icon tag-cate-house zoom-half"></div>';
        case 13:
            return '<span class="txt-sub-content">Đại vận</span>';
        case 14:
            return '<span class="txt-sub-content">Tiểu vận</span>';
        default:
            return '<div class="tag-cate-icon tag-cate-career zoom-half"></div>'
    }
}

function getAnimalClass(t) {
    if (t) switch (t = t.toLowerCase()) {
        case "tí":
        case "tý":
            return "chuot";
        case "sửu":
            return "suu";
        case "dần":
            return "dan";
        case "mão":
            return "mao";
        case "thìn":
            return "thin";
        case "tị":
        case "tỵ":
            return "ty";
        case "ngọ":
            return "ngo";
        case "mùi":
            return "mui";
        case "thân":
            return "than";
        case "dậu":
            return "dau";
        case "tuất":
            return "tuat";
        case "hợi":
            return "hoi";
        default:
            return "chuot"
    }
}

function getColorNguHanhClass(t) {
    if (t) switch (t = t.toLowerCase()) {
        case "kim":
            return "kim";
        case "mộc":
            return "moc";
        case "thủy":
            return "thuy";
        case "hỏa":
            return "hoa";
        case "thổ":
            return "tho";
        default:
            return "kim"
    }
}

function topFunction() {
    $("html,body").animate({
        scrollTop: 0
    }, "slow")
}

function formatPrice(t) {
    var e = 0;
    return t && (e = t.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".")), e
}

function formatPriceNew(t) {
    var e = "";
    const a = (t = t.toString().replaceAll(".", "")).length;
    if (a > 3) {
        let n = 0;
        for (let i = a - 1; i >= 0; i--) n += 1, e = t.substr(i, 1) + e, n % 3 == 0 && n < a && (e = "." + e)
    } else e = t;
    return e
}

function getBackgroundLaSoPreview(t, e) {
    var a = "la-so-preview-chuot la-so-preview-kim";
    switch (t.toString().toLowerCase()) {
        case "tý":
            a = "la-so-preview-chuot";
            break;
        case "sửu":
            a = "la-so-preview-suu";
            break;
        case "dần":
            a = "la-so-preview-dan";
            break;
        case "mão":
            a = "la-so-preview-mao";
            break;
        case "thìn":
            a = "la-so-preview-thin";
            break;
        case "tỵ":
            a = "la-so-preview-ty";
            break;
        case "ngọ":
            a = "la-so-preview-ngo";
            break;
        case "mùi":
            a = "la-so-preview-mui";
            break;
        case "thân":
            a = "la-so-preview-than";
            break;
        case "dậu":
            a = "la-so-preview-dau";
            break;
        case "tuất":
            a = "la-so-preview-tuat";
            break;
        case "hợi":
            a = "la-so-preview-hoi"
    }
    switch (e.toString().toLowerCase()) {
        case "kim":
            a += " la-so-preview-kim";
            break;
        case "thủy":
            a += " la-so-preview-thuy";
            break;
        case "hỏa":
            a += " la-so-preview-hoa";
            break;
        case "thổ":
            a += " la-so-preview-tho";
            break;
        case "mộc":
            a += " la-so-preview-moc"
    }
    return a
}

function parseJwt(t) {
    if (t) {
        var e = t.split(".")[1].replace(/-/g, "+").replace(/_/g, "/"),
            a = decodeURIComponent(atob(e).split("").map(function(t) {
                return "%" + ("00" + t.charCodeAt(0).toString(16)).slice(-2)
            }).join(""));
        return JSON.parse(a)
    }
}

function checkRole() {
    return "true" == $("body").attr("data-master")
}

function checkMod() {
    return "true" == $("body").attr("data-mod")
}

function checkModComment(t) {
    return 1 == t
}

function getPosition(t, e, a) {
    return t.split(e, a).join(e).length
}

function blinkMe(t) {
    t && "object" == typeof t && ($(t).addClass("blink_me"), setTimeout(function() {
        $(t).removeClass("blink_me")
    }, 1100))
}

function topicItemHandler(t) {
    const e = t.user;
    e || (t.user = {
        avatar: "",
        name: "",
        rank_id: 0,
        rank_name: ""
    }), e.rank || (e.rank = {
        title: ""
    }), t.budget = formatPrice(t.budget_display);
    const a = t.laso.can_chi_tuoi,
        n = t.laso.loai_hanh_cua_ban_menh.split(" ");
    return t.background = getBackgroundLaSoPreview(a.split(" ")[1], n[n.length - 1]), t.icon_save = "/public/images/icon/ic-save.png", t.is_saved && (t.icon_save = "/public/images/icon/ic-saved.png"), t.user.is_thay && (t.user.is_thay = "/public/images/icon/professor-verify-avt.png"), t.timeSince = sinceTime(t.updated || Date.now()), t
}
const fileTypes = ["image/jpeg", "image/jpg", "image/png"];

function validFileType(t) {
    return fileTypes.includes(t.type)
}

function validFileSize(t) {
    return t.size < 2e6
}

function initQAScreen() {
    switch (localStorage.getItem("openCollapse")) {
        case "criteriaUser":
            setTimeout(function() {
                $("#collapseCriteriaUser").addClass("show"), $("html,body").animate({
                    scrollTop: 555
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "");
            break;
        case "criteriaPro":
            setTimeout(function() {
                $("#collapseCriteriaPro").addClass("show"), $("html,body").animate({
                    scrollTop: 610
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "");
            break;
        case "ruleSocial":
            setTimeout(function() {
                $("#collapseRuleSocial").addClass("show"), $("html,body").animate({
                    scrollTop: 790
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "");
            break;
        case "confirmAccPro":
            setTimeout(function() {
                $("#collapseConfirmAccPro").addClass("show"), $("html,body").animate({
                    scrollTop: 705
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "");
            break;
        case "paymentSupport":
            setTimeout(function() {
                $("#collapsePaymentSupport").addClass("show"), $("html,body").animate({
                    scrollTop: 730
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "");
            break;
        case "ruleLaSoMarket":
            setTimeout(function() {
                $("#collapseRuleLaSoMarket").addClass("show"), $("html,body").animate({
                    scrollTop: 850
                }, "slow")
            }, 300), localStorage.setItem("openCollapse", "")
    }
}

function initHomeScreen() {
    loadNextAndPreDay(), loadPaginationTopTopics(), $(".lazy").lazy(), $("#btnTimLichNhanh").click(function() {
        var t = $("#form-tim-lich-nhanh"),
            e = t.find('select[name="day"]').val(),
            a = t.find('select[name="month"]').val(),
            n = t.find('select[name="year"]').val(),
            i = 0;
        t.find("input[name='calendar']:checked").map(function() {
            i = $(this).val()
        });
        window.location.href = `/xem-ngay-${e}-${a}-${n}?lunar=${i}`
    });
    const t = {
            DAY: {
                id: 1,
                noResult: "Chưa có xếp hạng trong hôm nay"
            },
            WEEK: {
                id: 2,
                noResult: "Chưa có xếp hạng trong tuần này"
            },
            MONTH: {
                id: 3,
                noResult: "Chưa có xếp hạng trong tháng này"
            }
        },
        e = {
            master: {
                id: 1,
                title: "Thầy",
                pointTitle: "Điểm uy tín"
            },
            user: {
                id: 2,
                title: "Tín chủ",
                pointTitle: "Điểm hoạt động"
            }
        },
        a = `${DOMAIN}/users/ranking?limit=10&page=1`;
    var n = !1;
    $("#rankingDayProTab").click(function() {
        n || r(a, t.DAY, e.master, $("#rankingDayPro"), function() {
            n = !0
        })
    });
    var i = !1;
    $("#rankingWeekProTab").click(function() {
        i || r(a, t.WEEK, e.master, $("#rankingWeekPro"), function() {
            i = !0
        })
    });
    var o = !1;
    $("#rankingWeekUserTab").click(function() {
        o || r(a, t.WEEK, e.user, $("#rankingWeekUser"), function() {
            o = !0
        })
    });
    var s = !1;

    function r(a, n, i, o, s) {
        i || (i = e.user), n || (n = t.MONTH), o || (o = $("#rankingMonthPro")), Agents.get(a + `&rankBy=${n.id}&role=${i.id}`, function(t) {
            if ("200" == t.code) {
                o.empty();
                const e = t.data || null;
                if (e) {
                    const t = e.data || [];
                    if (t.length > 0) {
                        let e = $('<table class="txt-sub-content ranking-professor-table"></table>');
                        e.append('<tr class="txt-sub-content-bold"><td>Hạng</td>' + `<td>${i.title}</td>` + "<td>Cấp độ</td>" + `<td>${i.pointTitle}</td>` + "</tr>"), t.forEach(function(t) {
                            let a = t.rank || 1;
                            const n = t.total_point || 0,
                                i = t.user,
                                o = i.rank || null,
                                s = o && o.hasOwnProperty("id") ? o.id : 1,
                                r = o && o.hasOwnProperty("title") ? o.title : "";
                            a <= 3 && (a = `<div class="top-professor-rank top-professor-${a} m-auto"></div>`);
                            const c = `<tr class="txt-sub-content-mid">\n                                                <td>${a}</td>\n                                                <td><a href="/${i.username||""}"\n                                                            class="text-black text-decoration-none">${i.name||""}</a></td>\n                                                <td class="d-flex align-items-center justify-content-center">\n                                                    <div class="user-medal-rank user-medal-rank-${s} zoom-half mr-2"></div>\n                                                    <div class="user-title-rank-${s}">\n                                                        ${r}\n                                                    </div>\n                                                </td>\n                                                <td>${n}</td>\n                                            </tr>`;
                            e.append(c)
                        }), o.append(e)
                    } else {
                        const t = n.noResult || "";
                        o.append(`<p class="txt-sub-content text-secondary text-center large-mt large-mb">${t}</p>`)
                    }
                }
                s && "function" == typeof s && s()
            }
        }, function(t) {})
    }
    $("#rankingDayUserTab").click(function() {
        s || r(a, t.DAY, e.user, $("#rankingDayUser"), function() {
            s = !0
        })
    })
}

function initSaveTopicGlobal() {
    $("button[name=saveLaSoHome]").click(function(t) {
        if (t.preventDefault(), isLogged()) try {
            const e = $(this),
                a = "BUTTON" == t.target.nodeName ? $(t.target.children) : $(t.target),
                n = e.attr("data-id"),
                i = e.attr("data-save"),
                o = `${DOMAIN}/user/saved-list`,
                s = {
                    module: "TOPIC",
                    item_object: n
                };
            n && ("false" == i ? Agents.post(o, s, function(t) {
                "200" == t.code && (e.attr("data-save", "true"), a.attr("src", "/public/images/icon/ic-saved.png"))
            }, function(t) {}) : Agents.delete(o, s, function(t) {
                "200" == t.code && (e.attr("data-save", "false"), a.attr("src", "/public/images/icon/ic-save.png"))
            }, function(t) {}))
        } catch (t) {} else openModalLogin(t)
    })
}

function loadPaginationTopTopics() {
    const t = $("#listPagination");
    let e = parseInt($("#listTopTopics").attr("data-total-number")) || 0;
    const a = [];
    if (e > 1) {
        e > 5 && (e = 5), a.push('<li class="paginationjs-prev" name="btnBack"><a class="cursor-pointer">«</a></li>'), a.push('<li class="paginationjs-page J-paginationjs-page active" name="pagNum" data-page="1">\n                        <a class="cursor-pointer">1</a>\n                     </li>');
        for (let t = 2; t <= e; t++) a.push(`<li class="paginationjs-page J-paginationjs-page" name="pagNum" data-page="${t}">\n                        <a class="cursor-pointer">${t}</a>\n                     </li>`);
        a.push('<li class="paginationjs-next" name="btnNext"><a class="cursor-pointer">»</a></li>')
    } else $("#paginationTopic").addClass("d-none");
    t.html(a), initSaveTopicGlobal();
    const n = $("#listTopTopics");
    $("#listPagination li[name=btnNext]").on("click", function() {
        $("html, body").animate({
            scrollTop: $("#listTopTopics").offset().top
        }, 500);
        let t = $("#listPagination li.active").attr("data-page") || 0;
        if (t > 0 && t < 6) {
            $(`#listPagination li[data-page=${t}]`).removeClass("active"), 5 == t ? t = 5 : t++;
            const e = `?pageSize=5&pageNumber=${t}`;
            Agents.get(`${APIs.markets.topics}${e}`, function(t) {
                if (200 == t.code) {
                    const e = t.data.data;
                    n.empty(), e.forEach(t => {
                        const e = t.id || 0,
                            a = topicItemHandler(t),
                            i = t.user,
                            o = i && i.is_thay;
                        t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), o && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">'), $("#cardTopic").tmpl(a).appendTo(n);
                        var s = $(`a#${e} > div.list-tag`);
                        s && 1 == s.length && (s = s[0]);
                        const r = a.tags || [];
                        if (r.length > 0)
                            for (let t = 0; t < r.length; t++) {
                                const e = getIconTagTopic(r[t].id || 0),
                                    a = $(e);
                                var c = $("<div class='small-tag'></div>");
                                c.html(a), $(s).find(".tag-container").append(c)
                            } else $(s).addClass("d-none"), $(s).empty();
                        var l = $(`a#${e} .list-view-user`),
                            d = a.view_users || [],
                            p = a.total_view_user || 0;
                        if (p > 0) {
                            const t = 5 == p ? 5 : p > 5 ? 4 : p;
                            for (let e = 0; e < t; e++) {
                                const t = d[e];
                                var m = t ? t.avatar : "";
                                m && "" != m || (m = "/public/images/avt-default.jpg");
                                const a = t ? t.name : "";
                                var u = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${m}" title="${a}">`);
                                $(l).append(u)
                            }
                            if (p > 5) {
                                let t = p - 4 > 99 ? 99 : p - 4;
                                const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                                $(l).append(e)
                            }
                        }
                        initSaveTopicGlobal()
                    })
                }
            }), $(`#listPagination li[data-page=${t}]`).addClass("active")
        } else $(`#listPagination li[data-page=${t}]`).addClass("active")
    }), $("#listPagination li[name=btnBack]").on("click", function() {
        $("html, body").animate({
            scrollTop: $("#listTopTopics").offset().top
        }, 500);
        let t = $("#listPagination li.active").attr("data-page") || 0;
        if (t > 0 && t < 6) {
            $(`#listPagination li[data-page=${t}]`).removeClass("active"), 1 == t ? t = 1 : t--;
            const e = `?pageSize=5&pageNumber=${t}`;
            Agents.get(`${APIs.markets.topics}${e}`, function(t) {
                if (200 == t.code) {
                    const e = t.data.data;
                    n.empty(), e.forEach(t => {
                        const e = t.id || 0,
                            a = topicItemHandler(t),
                            i = t.user,
                            o = i && i.is_thay;
                        t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), o && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">'), $("#cardTopic").tmpl(a).appendTo(n);
                        var s = $(`a#${e} > div.list-tag`);
                        s && 1 == s.length && (s = s[0]);
                        const r = a.tags || [];
                        if (r.length > 0)
                            for (let t = 0; t < r.length; t++) {
                                const e = getIconTagTopic(r[t].id || 0),
                                    a = $(e);
                                var c = $("<div class='small-tag'></div>");
                                c.html(a), $(s).find(".tag-container").append(c)
                            } else $(s).addClass("d-none"), $(s).empty();
                        var l = $(`a#${e} .list-view-user`),
                            d = a.view_users || [],
                            p = a.total_view_user || 0;
                        if (p > 0) {
                            const t = 5 == p ? 5 : p > 5 ? 4 : p;
                            for (let e = 0; e < t; e++) {
                                const t = d[e];
                                var m = t ? t.avatar : "";
                                m && "" != m || (m = "/public/images/avt-default.jpg");
                                const a = t ? t.name : "";
                                var u = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${m}" title="${a}">`);
                                $(l).append(u)
                            }
                            if (p > 5) {
                                let t = p - 4 > 99 ? 99 : p - 4;
                                const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                                $(l).append(e)
                            }
                        }
                        initSaveTopicGlobal()
                    })
                }
            }), $(`#listPagination li[data-page=${t}]`).addClass("active")
        } else $(`#listPagination li[data-page=${t}]`).addClass("active")
    }), $("#listPagination li.paginationjs-page").on("click", function() {
        $("html, body").animate({
            scrollTop: $("#listTopTopics").offset().top
        }, 500);
        const t = this.getAttribute("data-page");
        $("#listPagination li.active").removeClass("active"), $(this).addClass("active");
        const e = `?pageSize=5&pageNumber=${t}`;
        Agents.get(`${APIs.markets.topics}${e}`, function(t) {
            if (200 == t.code) {
                const e = t.data.data;
                n.empty(), e.forEach(t => {
                    const e = t.id || 0,
                        a = topicItemHandler(t),
                        i = t.user,
                        o = i && i.is_thay;
                    t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), o && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">'), $("#cardTopic").tmpl(a).appendTo(n);
                    var s = $(`a#${e} > div.list-tag`);
                    s && 1 == s.length && (s = s[0]);
                    const r = a.tags || [];
                    if (r.length > 0)
                        for (let t = 0; t < r.length; t++) {
                            const e = getIconTagTopic(r[t].id || 0),
                                a = $(e);
                            var c = $("<div class='small-tag'></div>");
                            c.html(a), $(s).find(".tag-container").append(c)
                        } else $(s).addClass("d-none"), $(s).empty();
                    var l = $(`a#${e} .list-view-user`),
                        d = a.view_users || [],
                        p = a.total_view_user || 0;
                    if (p > 0) {
                        const t = 5 == p ? 5 : p > 5 ? 4 : p;
                        for (let e = 0; e < t; e++) {
                            const t = d[e];
                            var m = t ? t.avatar : "";
                            m && "" != m || (m = "/public/images/avt-default.jpg");
                            const a = t ? t.name : "";
                            var u = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${m}" title="${a}">`);
                            $(l).append(u)
                        }
                        if (p > 5) {
                            let t = p - 4 > 99 ? 99 : p - 4;
                            const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                            $(l).append(e)
                        }
                    }
                    initSaveTopicGlobal(), $(".lazy").lazy()
                })
            }
        })
    })
}

function loadNextAndPreDay() {
    $("#previous-date").on("click", function() {
        const t = $("#next-date"),
            e = t.attr("data-day"),
            a = t.attr("data-month"),
            n = t.attr("data-year"),
            i = new Date(a + "/" + e + "/" + n);
        i.setDate(i.getDate() - 1), t.attr("data-day", i.getDate()), t.attr("data-month", i.getMonth() + 1), t.attr("data-year", i.getFullYear()), $(this).attr("data-day", i.getDate()), $(this).attr("data-month", i.getMonth() + 1), $(this).attr("data-year", i.getFullYear()), getLichVanNienByDay(i.getDate(), i.getMonth() + 1, i.getFullYear())
    }), $("#next-date").on("click", function() {
        const t = $("#previous-date"),
            e = t.attr("data-day"),
            a = t.attr("data-month"),
            n = t.attr("data-year"),
            i = new Date(a + "/" + e + "/" + n);
        i.setDate(i.getDate() + 1), t.attr("data-day", i.getDate()), t.attr("data-month", i.getMonth() + 1), t.attr("data-year", i.getFullYear()), $(this).attr("data-day", i.getDate()), $(this).attr("data-month", i.getMonth() + 1), $(this).attr("data-year", i.getFullYear()), getLichVanNienByDay(i.getDate(), i.getMonth() + 1, i.getFullYear())
    }), $("#previous-date-right").on("click", function() {
        const t = $(this),
            e = $("#next-date-right"),
            a = t.attr("data-day"),
            n = t.attr("data-month"),
            i = t.attr("data-year"),
            o = new Date(n + "/" + a + "/" + i);
        o.setDate(o.getDate() - 1), e.attr("data-day", o.getDate()), e.attr("data-month", o.getMonth() + 1), e.attr("data-year", o.getFullYear()), t.attr("data-day", o.getDate()), t.attr("data-month", o.getMonth() + 1), t.attr("data-year", o.getFullYear()), getLichVanNienByDay(o.getDate(), o.getMonth() + 1, o.getFullYear())
    }), $("#next-date-right").on("click", function() {
        const t = $(this),
            e = $("#previous-date-right"),
            a = t.attr("data-day"),
            n = t.attr("data-month"),
            i = t.attr("data-year"),
            o = new Date(n + "/" + a + "/" + i);
        o.setDate(o.getDate() + 1), e.attr("data-day", o.getDate()), e.attr("data-month", o.getMonth() + 1), e.attr("data-year", o.getFullYear()), t.attr("data-day", o.getDate()), t.attr("data-month", o.getMonth() + 1), t.attr("data-year", o.getFullYear()), getLichVanNienByDay(o.getDate(), o.getMonth() + 1, o.getFullYear())
    })
}

function resizeInHome() {
    const t = $(".right-content-responsive"),
        e = $(".right-content");
    if ($(window).width() < 769) {
        if (0 === t.find("#lap-la-so-tu-vi").length) {
            const e = $("#lap-la-so-tu-vi"),
                a = $("#lvn-container"),
                n = $("#tim-lich-nhanh");
            t.prepend(e, a, n)
        }
    } else if (0 === e.find("#lap-la-so-tu-vi").length) {
        const t = $("#lap-la-so-tu-vi"),
            a = $("#lvn-container"),
            n = $("#tim-lich-nhanh");
        e.prepend(t, a, n)
    }
}

function getRanking(t, e, a, n) {
    const i = `${APIs.ranking.get}?limit=${t}&page=${e}&rankBy=${a}`;
    Agents.get(i, function(t) {
        if (t && t.data) {
            const e = t.data.data,
                a = $(`${n}`);
            a.empty();
            const i = '<tr class="txt-sub-content-bold"><td>Hạng</td><td>Thầy</td><td>Cấp độ</td><td>Điểm uy tín</td></tr>';
            a.append(i), e.forEach(function(t) {
                let e = "";
                switch (t.rank) {
                    case 1:
                        e = "top-professor-rank top-professor-1 m-auto", t.rank = "";
                        break;
                    case 2:
                        e = "top-professor-rank top-professor-2 m-auto", t.rank = "";
                        break;
                    case 3:
                        e = "top-professor-rank top-professor-3 m-auto", t.rank = "";
                        break;
                    default:
                        e = ""
                }
                const n = {
                        item: t,
                        className: e
                    },
                    i = $("#getRanking").tmpl(n);
                a.append(i)
            })
        }
    }, function(t) {})
}

function getLichVanNienByDay(t, e, a) {
    const n = `${APIs.others.lichVanNien}?day=${t}&month=${e}&year=${a}`;
    Agents.get(n, function(t) {
        if (t = t.data) {
            $("#lvn-full").text(t.full_format), $("#lvn-l-month").text("Tháng " + t.lunar_month), $("#lvn-l-day").text(t.lunar_day), $("#lvn-ch-day").text(t.can_chi_ngay), $("#lvn-ch-month").text(t.can_chi_thang), $("#xem-chi-tiet-am-duong").attr("href", `/xem-ngay-${t.solar_day}-${t.solar_month}-${t.solar_year}`), $("#lvn-full-right").text(t.full_format), $("#lvn-full-right").attr("data-day", t.solar_day), $("#lvn-full-right").attr("data-month", t.solar_month), $("#lvn-full-right").attr("data-year", t.solar_year), $("#lvn-l-month-right").text("Tháng " + t.lunar_month), $("#lvn-l-day-right").text(t.lunar_day), $("#lvn-ch-day-right").text(t.can_chi_ngay), $("#lvn-ch-month-right").text(t.can_chi_thang);
            let e = t.gio_tot_xaus;
            if (e) {
                let t = "";
                for (let a = 0; a < e.length; a++) {
                    let n = e[a];
                    "T" == n.type && (t += n.time + ", ")
                }
                t = t.substr(0, t.length - 2), $("#lvn-ngay-tot").text(t), $("#lvn-ngay-tot-right").text(t)
            }
            let a = `${t.solar_month}/${t.solar_day}/${t.solar_year}`,
                n = new Date(a),
                i = new Date;
            n.getDate() === i.getDate() && n.getMonth() === i.getMonth() && n.getFullYear() === i.getFullYear() ? $("#txt-today").removeClass("d-none") : $("#txt-today").addClass("d-none")
        }
    })
}

function initThongKeCanXuongScreen() {
    $("#btn-thong-ke-can-xuong").on("click", function() {
        let t = `thong-ke-can-xuong-${$("#TKCX-year").val()}-${$("#TKCX-month").val()}-${$("#TKCX-day").val()}-${$("#TKCX-hour").val()}-${$("#TKCX-order").val()}`;
        window.location.href = t
    }), loadThongKeCanXuong()
}

function loadThongKeCanXuong() {
    var t = $("#pagination-tkcx"),
        e = parseInt($("#list-result-thong-ke").attr("data-total-number")),
        a = $("#TKCX-order").val(),
        n = $("#TKCX-day").val(),
        i = $("#TKCX-month").val(),
        o = parseInt($("#TKCX-year").val()),
        s = $("#TKCX-hour").val(),
        r = `${APIs.others.canXuong}?year=${o}&month=${i}&day=${n}&hour=${s}&order=${a}`;
    t.pagination({
        dataSource: r,
        locator: "data.edges",
        totalNumber: e,
        pageSize: 20,
        showPageNumbers: !0,
        showPrevious: !0,
        showNext: !0,
        showFirstOnEllipsisShow: !0,
        showLastOnEllipsisShow: !0,
        ajax: {},
        callback: function(t, e) {
            if (t) {
                const e = t,
                    a = $("#list-result-thong-ke");
                a.empty();
                const n = '<tr class="txt-content-bold color-background">\n                                <td>Năm</td>\n                                <td>Tháng</td>\n                                <td>Ngày</td>\n                                <td>Giờ</td>\n                                <td>Điểm cân xương</td>\n                            </tr>';
                a.html(n), e.forEach(function(t) {
                    const e = {
                        item: t
                    };
                    var n = $("#tkcxTable").tmpl(e);
                    a.append(n)
                })
            }
        }
    })
}

function initBadGoodDayScreen() {
    $("#sb-xem-ngay-tot-xau").on("click", function() {
        $("#form-ngay-tot-xau");
        const t = $('select[name="filter"]').val(),
            e = $('select[name="month"]').val(),
            a = $('select[name="year"]').val();
        window.location.href = `/xem-ngay-tot-xau-thang-${e}-nam-${a}?filter=${t}`
    })
}

function initThuVienTuViScreen() {
    const t = parseInt($("#info-page-knowledge").attr("data-total-page")),
        e = parseInt($("#info-page-knowledge").attr("data-current-page")),
        a = $("#info-page-knowledge").attr("data-category");
    let n = "/thu-vien-tu-vi?";
    "" != a && (n += "category=" + a);
    let i = [];
    if (t > 0 && e <= t) {
        if (t < 5) i = Array.from(new Array(t), (t, e) => e + 1);
        else if (e <= 4) i = Array.from(new Array(5), (t, e) => e + 1);
        else if (e >= t - 1)
            for (let e = t - 4; e < t + 1; e++) i.push(e);
        else i = [e - 2, e - 1, e, e + 1, e + 2];
        const a = $("#knowledge-pagination");
        let o = [];
        if (e > 1) {
            let t = '\n                                <li class="page-item pagination-previous">\n                                <a href=" ' + n + "&page=" + (e - 1) + ' ">\n                                    <span class="page-link txt-sub-content" aria-label="Previous">\n                                        <span aria-hidden="true"><</span>\n                                        <span class="sr-only">Previous</span>\n                                    </span>\n                                    </a>\n                                </li>\n                             ';
            o.push(t)
        }
        if (i.forEach(function(t) {
                let a = '\n                                <li class="page-item pagination-item-sc ' + (t == e ? "active" : "") + ' " data-page=" + item + ">\n                                <a href=" ' + n + "&page=" + t + `">\n                                        <span class="page-link txt-sub-content"> ${t} </span>\n                                        </a>\n                                </li>\n                            `;
                o.push(a)
            }), e < t) {
            let t = '\n                                <li class="page-item pagination-next">\n                                <a href=" ' + n + "&page=" + (e + 1) + '">\n                                    <span class="page-link txt-sub-content" aria-label="Next">\n                                        <span aria-hidden="true">></span>\n                                        <span class="sr-only">Next</span>\n                                    </span>\n                                    </a>\n                                </li>\n                             ';
            o.push(t)
        }
        a.html(o)
    }

    function o() {
        const t = $("#text-search-category").val(),
            e = `${APIs.categories.get}?page=1&limit=20&search=${t}`;
        Agents.get(e, function(e) {
            if (200 == e.code) {
                const a = e.data,
                    n = $("#list-category"),
                    i = ['<a href="/thu-vien-tu-vi">\n                        <div class="category' + ("" == t ? " current" : "") + '">\n                            <span>Tất cả bài viết</span>\n                        </div>\n                    </a>'],
                    o = a.edges;
                n.empty(), o && o.length > 0 ? (o.forEach(function(t) {
                    const e = '<a href="/thu-vien-tu-vi?category=' + t.slug + '">\n                            <div class="category">\n                                <span>' + t.name + "</span>\n                            </div>\n                        </a>";
                    i.push(e)
                }), n.html(i)) : n.html("<p>Không tìm thấy kết quả</p>")
            } else container.html("<p>Có lỗi xảy ra!</p>")
        }, function(t) {})
    }
    $("#text-search-category").keypress(function(t) {
        "13" == (t.keyCode ? t.keyCode : t.which) && o()
    }), $("#btn-search-category").on("click", function() {
        o()
    })
}

function initSystemReportScreen() {
    function t(t) {
        let e = grecaptcha.getResponse();
        return 0 !== e.length && e
    }
    $("#spinnerReportSystem").hide(), $("#imgReportSystem").on("change", function() {
        "" != this.value ? $("#defaultTxtImage").text(this.value.split("\\").pop()) : $("#defaultTxtImage").text("URL image")
    }), $("#btnSystemReport").on("click", function(e) {
        let a = $("#nameReporter").val().trim(),
            n = $("#emailReporter").val().trim(),
            i = parseInt($("#errorId").val()),
            o = $("#contentReporter").val(),
            s = "",
            r = !1;
        if (validateName(a) ? $("#nameReporter").css("border", "solid 1px var(--border-color)") : ($("#nameReporter").css("border", "2.5px solid yellow"), r = !0), validateEmail(n) ? $("#emailReporter").css("border", "solid 1px var(--border-color)") : ($("#emailReporter").css("border", "2.5px solid yellow"), r = !0), validateAddress(o) ? $("#contentReporter").css("border", "solid 1px var(--border-color)") : ($("#contentReporter").css("border", "2.5px solid yellow"), r = !0), t() ? s = t() : r = !0, r) $("#titleMes").text("Lưu ý!!"), $("#contentMes").text("Tín chủ cần điền đầy đủ, chính xác thông tin và xác nhận mã captcha. Các thông tin sai hoặc thiếu đã được bôi vàng. Vui lòng kiểm tra lại");
        else {
            const t = document.querySelector("#imgReportSystem").files,
                e = new FormData;
            e.append("name", a), e.append("email", n), e.append("title_id", i), e.append("content", o), e.append("captcha", s);
            for (const a of t) a || ($("#titleMes").text("Lưu ý!!"), $("#contentMes").text("Upload ảnh không thành công!! Tín chủ vui lòng thử lại.")), e.append("file", a);
            Agents.upload(APIs.others.systemReport, Agents.methods.POST, e, function(t) {
                t && 200 == t.code ? ($("#titleMes").text("Phản hồi thành công"), $("#contentMes").text("Phản hồi của tín chủ đã được gửi đi thành công. Tuvi.vn cảm ơn tín chủ đã góp ý!"), $("#contentMes").append('<br/><br/><a style="font-size: 14px" href="/"><< Trở về trang chủ</a>'), $("#nameReporter").val(""), $("#emailReporter").val(""), $("#errorId").val(1), $("#contentReporter").val(""), $("#imgReportSystem").val(""), $("#defaultTxtImage").text("URL image"), grecaptcha.reset()) : ($("#titleMes").text("Phản hồi không thành công"), $("#contentMes").text("Phản hồi của tín chủ chưa được gửi thành công!"), grecaptcha.reset())
            }, function(t) {
                $("#titleMes").text("Phản hồi không thành công"), $("#contentMes").text("Phản hồi của tín chủ chưa được gửi thành công!"), grecaptcha.reset()
            })
        }
    })
}

function eventOnFocusInput() {
    let t = [];
    const e = $("#listMaster");
    let a = $("#nameMaster").val().toLowerCase(),
        n = "" != a ? `${APIs.master.get}?search=${a}` : APIs.master.get;
    e.empty(), t = [], Agents.get(n, function(a) {
        const n = a.data.data || [];
        n.length ? (n.forEach(function(e) {
            let a = e.name || "",
                n = e.rank_id || 1,
                i = e.rank || null,
                o = i ? i.title : "",
                s = e.username || "",
                r = e.avatar || "/public/images/avt-default.jpg";
            1 == n ? t.push(`<li data-item-master class="item-master" name="itemMaster" data-id-master="${e.id}">\n                            <img class="cmt-avt" src="${r}">\n                            <div data-item-master class="d-flex flex-column">\n                            <span class="txt-content-mid" data-item-master name="nameMaster">${a}</span>\n                            <span class="txt-sub-content text-secondary" data-item-master name="username">@${s}</span>\n                           </div>\n                     </li>`) : t.push(`<li data-item-master class="item-master" name="itemMaster" data-id-master="${e.id}">\n                            <img class="cmt-avt" src="${r}">\n                            <div data-item-master class="d-flex flex-column">\n                            <span class="txt-content-mid" data-item-master name="nameMaster">${a}</span>\n                            <span class="txt-sub-content text-secondary" data-item-master name="username">@${s}</span>\n                            <div data-item-master class="d-inline-flex align-items-center small-mt">\n                                <div data-item-master class="user-medal-rank user-medal-rank-${n} zoom-half mr-2"></div>\n                                <span data-item-master class="user-title-rank-${n}">${o}</span>\n                            </div>\n                           </div>\n                     </li>`)
        }), e.html(t), e.append("<script>$('li.item-master').on('click', function(event) {\n                            event.stopImmediatePropagation();\n                        let nameSpans = $(this).find('span[name=nameMaster]');\n                        let nameMaster = $(nameSpans[0]).text()\n                        let idMaster = $(this).attr('data-id-master') || 0;\n                        $('#nameMaster').val(nameMaster);\n                        $('#nameMaster').attr('data-id-master-selected', idMaster)\n                        $('#listMaster').addClass('d-none')\n                        $('#nameMaster').attr('disabled', true)\n                        $('#delInput').removeAttr('hidden')\n                    }) \n                    $(window).on('mousedown', function(event) {\n                      let target = $(event.target).attr('data-item-master')\n                      if(typeof target !== 'undefined' && target !== false){\n                           $('#nameMaster').off('blur')\n                      } else {\n                          $('#nameMaster').on('blur', function() {\n                            $('#listMaster').empty();\n                            $('#listMaster').addClass('d-none');\n                          })\n                      }\n                    })\n                        <\/script>"), e.removeClass("d-none"), $("#nameMaster").attr("")) : (e.html('<div class="text-center">Không có kết quả tìm kiếm</div>'), e.removeClass("d-none"))
    }, function(t) {})
}

function searchMaster() {
    var t;
    $("#delInput").on("click", function() {
        $("#nameMaster").val(""), $("#delInput").attr("hidden", !0), $("#nameMaster").removeAttr("data-id-master-selected"), $("#nameMaster").removeAttr("disabled"), $("#nameMaster").attr("placeholder", "Nhập tên thầy...")
    }), $("#nameMaster").on("focusin", function() {
        $("#nameMaster").attr("data-id-master-selected") || eventOnFocusInput(), $("#nameMaster").on("keyup", function() {
            $("#listMaster").html('<div class="w-100 text-center"><div class="spinner-border " role="status"><span class="sr-only">Loading...</span></div></div>'), clearTimeout(t), t = setTimeout(function() {
                eventOnFocusInput()
            }, 700)
        })
    })
}

function initLasoScreen(t) {
			console.log("hover");

    pushLaSoToHistory(t), loadLaSoHistory(), searchMaster(), o();
    for (var e = parseInt($("#body-detail-laso").attr("data-suggest-price")), a = document.getElementsByClassName("cung"), n = 0, i = 0; i < a.length; i++) {
        a[i].childNodes[1].childNodes[1].childNodes[1].childNodes[3].childNodes[1].innerHTML.trim().includes("Mệnh") && (n = parseInt($(a[i]).attr("data-cung-full-id")))
    }

    function o() {
        $("#click-an-sao-luu-dai-van").is(":checked") || $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            (e = e.trim()).startsWith("ĐV.") && t.addClass("d-none")
        }), $("#click-an-sao-luu-tu-duc").is(":checked") || $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            "L.Nguyệt Đức" != (e = e.trim()) && "L.Thiên Đức" != e && "L.Phúc Đức" != e && "L.Long Đức" != e || t.addClass("d-none")
        })
    }

    function s() {
		console.log("ss");
        var t = $(window).width(),
            e = "250px";
        $("#click-tu-hoa-phai").is(":checked") ? e = "340px" : ($("#click-an-sao-luu-dai-van").is(":checked") || $("#click-an-sao-luu-tu-duc").is(":checked")) && (e = "295px"), $(".cung").css("height", e), $(".cung-view").css("height", e), t < 769 && $("#content-la-so").css("height", $("#table-la-so")[0].getBoundingClientRect().height)
    }
	console.log("ss");
    $(".view-con-giap-la-so").addClass(`list-line-${n}`), $(".cung").hover(function() {
        handlerHoverLaSo(this, "")
    }, function() {
        handlerUnHoverLaSo(this, "")
    }), $(".view-item-suggest").on("click", function(t) {
        $(".view-item-suggest").removeClass("active-item-suggest");
        const e = $(this).attr("data-cung");
        $(this).attr("data-loaded");
        if ("dai-van" == e) goToByScroll("binh-giai-dai-van");
        else if ("tieu-van" == e) goToByScroll("binh-giai-tieu-van");
        else {
            const a = getParamSearch(e);
            t.preventDefault();
            const n = $("#cung-" + e),
                i = n.attr("data-loaded");
            inActiveTab(), activeTab("#cung-" + e), goToByScroll("cung-" + e);
            let o = $("#cung-" + e + " div.detail-item-binh-giai-12-cung");
            "false" == i && (o.empty(), o.html('\n                      <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    '), loadLuanGiai(a, function(t) {
                if ("200" == t.code) {
                    const e = t.data;
                    handlerLoadLG(n, o, e)
                }
            }))
        }
        $(this).addClass("active-item-suggest")
    }), $("#muc-luc > div > .item-muc-luc-title").on("click", function() {
        if (this.childNodes.length > 4) {
            const t = $(this.childNodes[3].childNodes[1]);
            t && ("icon-up" == t[0].className ? ($("#list-12-cung-muc-luc").addClass("show"), $("#list-12-cung-muc-luc-right").addClass("show"), $(t[0]).addClass("turn-up")) : ($("#list-12-cung-muc-luc").removeClass("show"), $("#list-12-cung-muc-luc-right").removeClass("show"), $(t[0]).removeClass("turn-up")))
        }
    }), $("#muc-luc .view-header-follow-la-so").on("click", function(t) {
        const e = $(this).attr("data-cung");
        if (e)
            if ("dai-van" == e) goToByScroll("binh-giai-dai-van");
            else if ("tieu-van" == e) goToByScroll("binh-giai-tieu-van");
        else if ("tong-quan" == e) goToByScroll("binh-giai-tong-quan");
        else {
            let e, i = $(this).attr("data-cung"),
                o = "",
                s = !1;
            if ("than" == i) {
                var a = $('span[data-cung="than"]'),
                    n = $(a.parent()).children()[0];
                o = $(n).attr("data-cung"), s = !0
            }
            e = getParamSearch(s ? o : i, s), t.preventDefault();
            const r = $("#cung-" + i),
                c = r.attr("data-loaded");
            $("#muc-luc .view-header-follow-la-so").removeClass("active-muc-luc-mini"), $(this).addClass("active-muc-luc-mini"), inActiveTab(), activeTab("#cung-" + i), goToByScroll("cung-" + i);
            let l = $("#cung-" + i + " div.detail-item-binh-giai-12-cung");
            "false" == c && (l.empty(), l.html('\n                            <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    '), loadLuanGiai(e, function(t) {
                if ("200" == t.code) {
                    const e = t.data;
                    handlerLoadLG(r, l, e)
                }
            }))
        }
    }), $("#table-binh-giai-dai-van > tbody > tr > td").on("click", function() {
        handlerClickBinhGiaiDaiVan($(this), $("#list-binh-giai-dai-van"))
    }), $("#binh-giai-tieu-van > tbody > tr > td").on("click", function() {
        handlerClickBinhGiaiTieuVan($(this), $("#list-binh-giai-tieu-van"))
    }), $("#binh-giai-12-cung-content > div.cung-data").on("click", function(t) {
        handlerClickBinhGiai12Cung($(this), t)
    }), $(".text-sao-chinh-tinh").click(function(t) {
        "block" == $("#modal-la-so").css("display") ? handlerClickTextSaoChinhTinh($(this), t, "#modal-la-so > div.modal-content > div.luan-giai-modal > div#binh-giai-12-cung > div#binh-giai-12-cung-content > ", !0) : handlerClickTextSaoChinhTinh($(this), t, "")
    }), $("#xemCungChieu").click(function() {
        1 == $("#xemCungChieu").is(":checked") ? $(".cung").hover(function() {
            handlerHoverLaSo(this, "")
        }, function() {
            handlerUnHoverLaSo(this, "")
        }) : $(".cung").off("mouseenter mouseleave")
    }), $(".text-dai-van-number").click(function() {
        "block" == $("#modal-la-so").css("display") ? handlerClickDaiVanNumber($(this), $("#modal-la-so > div.modal-content > div.luan-giai-modal > div#binh-giai-dai-van > div.binh-giai-dai-van-content > div#list-binh-giai-dai-van"), $("#modal-la-so > div.modal-content > div.luan-giai-modal > div#binh-giai-dai-van > div.binh-giai-dai-van-content > table > tbody > tr > td"), !0, $("#modal-la-so > div.modal-content > div.luan-giai-modal > div#binh-giai-dai-van")) : handlerClickDaiVanNumber($(this), $("#list-binh-giai-dai-van"), $("#table-binh-giai-dai-van > tbody > tr > td"), !1, $("#binh-giai-dai-van"))
    }), $("#click-Cung-Sao2").click(function() {
        1 == $("#click-Cung-Sao2").is(":checked") ? ($(".text-sao-chinh-tinh").removeClass("event-click-sao"), $(".text-dai-van-number").removeClass("event-click-sao")) : ($(".text-sao-chinh-tinh").addClass("event-click-sao"), $(".text-dai-van-number").addClass("event-click-sao"))
    }), $("#xemCungChieu").prop("checked", !0), $("#click-tu-hoa-phai").click(function() {
        1 == $("#click-tu-hoa-phai").is(":checked") ? $(".cung-middle-tu-hoa-phai").css("display", "block") : $(".cung-middle-tu-hoa-phai").css("display", "none"), s()
    }), $("#click-an-sao-luu-dai-van").click(function() {
        1 == $("#click-an-sao-luu-dai-van").is(":checked") ? $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            (e = e.trim()).startsWith("ĐV.") && t.removeClass("d-none")
        }) : $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            (e = e.trim()).startsWith("ĐV.") && t.addClass("d-none")
        }), s()
    }), $("#click-an-sao-luu-tu-duc").click(function() {
        1 == $("#click-an-sao-luu-tu-duc").is(":checked") ? $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            "L.Nguyệt Đức" != (e = e.trim()) && "L.Thiên Đức" != e && "L.Phúc Đức" != e && "L.Long Đức" != e || t.removeClass("d-none")
        }) : $("*[data-name*=sao-tot-xau]").each(function() {
            var t = $(this);
            let e = t.text() || "";
            "L.Nguyệt Đức" != (e = e.trim()) && "L.Thiên Đức" != e && "L.Phúc Đức" != e && "L.Long Đức" != e || t.addClass("d-none")
        }), s()
    }), $("#laSoDenTrang, #laSoDenTrang2").click(function() {
        $(".table-la-so").addClass("la-so-den-trang"), $("#note-la-so").addClass("note-la-so-none")
    }), $("#laSoMau, #laSoMau2").click(function() {
        $(".table-la-so").removeClass("la-so-den-trang"), $("#note-la-so").removeClass("note-la-so-none")
    }), $("#print-la-so").on("click", function() {
        const t = $(this).attr("data-name");
        var e = $("#content-la-so").html(),
            a = window.open("", "", "height=700,width=900");
        a.document.write("<html><head><title>" + t + "</title>"), a.document.write('<link rel="stylesheet" href="/public/css/main.css" type="text/css"/>'), a.document.write('<link rel="stylesheet" href="/public/css/bootstrap.min.css" type="text/css"/>'), a.document.write("</head><body>"), a.document.write(e), a.document.write("</body></html>"), a.document.close(), a.onload = function() {
            a.focus(), a.print()
        }
    }), $("#print-la-so-den-trang").on("click", function() {
        const t = $(this).attr("data-name");
        var e = $("#content-la-so").html(),
            a = window.open("", "", "height=700,width=900");
        a.document.write("<html><head><title>" + t + "</title>"), a.document.write("<style>*{-webkit-filter: grayscale(100%); \n  filter: grayscale(100%);}</style>"), a.document.write('<link rel="stylesheet" href="/public/css/main.css" type="text/css"/>'), a.document.write('<link rel="stylesheet" href="/public/css/bootstrap.min.css" type="text/css"/>'), a.document.write("</head><body>"), a.document.write(e), a.document.write("</body></html>"), a.document.close(), a.onload = function() {
            a.focus(), a.print()
        }
    });
    $("#viewMonth3,#inputYear").change(function() {
        const t = $(this).attr("name"),
            e = $("#table-la-so"),
            a = parseInt(e.attr("data-hour")),
            n = parseInt(e.attr("data-day")),
            i = parseInt(e.attr("data-month")),
            s = parseInt(e.attr("data-year")),
            r = parseInt($("#tuHoaPhaiSelect").val());
        let c, l;
        "year" == t ? (c = parseInt(e.attr("data-month-see")), l = parseInt($(this).val())) : (c = parseInt($(this).val()), l = parseInt(e.attr("data-year-see")));
        let d = e.attr("data-gender");
        if (d = "M" == d, a && n && i && s && c && l && r) {
            loadNamXem({
                hour_id: a,
                day: n,
                month: i,
                year: s,
                male: d,
                solar_calendar: !0,
                thang_xem: c,
                nam_xem: l,
                tu_hoa_phai_mode: r || 0
            }, function(t) {
                if (t && t.code && "200" == t.code) {
                    e.attr("data-month-see", c), e.attr("data-year-see", l);
                    const a = t.data;
                    $("*[data-name*=sao-tot-xau]").each(function() {
                        var t = $(this);
                        let e = t.text() || "";
                        ((e = e.trim()).startsWith("L.") || e.startsWith("Hóa") || e.startsWith("ĐV.")) && t.remove()
                    }), $("*[class*=cung-middle-tu-hoa-phai]").each(function() {
                        $(this).empty()
                    }), $("#current-time-full").text(a.current_time_full), a && a.cung_model && a.cung_model.forEach((t, e) => {
                        t && ($(`#LN${t.id}`).text(t.luu_nien), $(`#KNH${t.id}`).text(t.khoi_nguyet_han), $(`#DVT${t.id}`).text(t.dai_van_text), t && t.sao && t.sao.forEach((e, a) => {
                            e.sao && ("H" == e.sao.status ? e.sao.is_special ? $(`#sao-xau-${t.id}`).append(`<div class="font-weight-bold txt-sub-content-bold-la-so text-sao-xau-tot" \ndata-sao-id="${e.sao.id}" data-name="sao-tot-xau" \nstyle="color: ${e.sao.color_code}">\n${e.sao.name} ${e.do_sang&&e.do_sang.abbr?`(${e.do_sang.abbr})`:""}\n</div>`) : $(`#sao-xau-${t.id}`).append(`<div class="txt-sub-content-la-so text-sao-xau-tot" \ndata-sao-id="${e.sao.id}" data-name="sao-tot-xau" \nstyle="color: ${e.sao.color_code}">\n${e.sao.name} ${e.do_sang&&e.do_sang.abbr?`(${e.do_sang.abbr})`:""}\n</div>`) : e.sao.is_special ? $(`#sao-tot-${t.id}`).append(`<div class="font-weight-bold txt-sub-content-bold-la-so text-sao-xau-tot" \ndata-sao-id="${e.sao.id}" data-name="sao-tot-xau" \nstyle="color: ${e.sao.color_code}">\n${e.sao.name} ${e.do_sang&&e.do_sang.abbr?`(${e.do_sang.abbr})`:""}\n</div>`) : $(`#sao-tot-${t.id}`).append(`<div class="txt-sub-content-la-so text-sao-xau-tot" \ndata-sao-id="${e.sao.id}" data-name="sao-tot-xau" \nstyle="color: ${e.sao.color_code}">\n${e.sao.name} ${e.do_sang&&e.do_sang.abbr?`(${e.do_sang.abbr})`:""}\n</div>`))
                        }), t && t.tu_hoa_phais && t.tu_hoa_phais.forEach((e, a) => {
                            e.cung && e.sao && (e.cung == t.cung.name ? $(`#THP${t.id}`).append(`<p class="txt-sub-content-la-so mb-0 font-italic"\n                                                           style="color: ${e.sao.color_code}"><span\n                                                                    class="text-high-light">Tự</span> ${e.sao.name}\n                                                        </p>`) : $(`#THP${t.id}`).append(`<p class="txt-sub-content-la-so mb-0 font-italic"><span\n                                                                    style="color: ${e.sao.color_code}">${e.sao.name}</span>\n                                                            - ${e.cung}</p>`))
                        }))
                    }), o()
                } else alert("Năm xem không hợp lệ")
            })
        } else alert("Vui lòng nhập thông tin")
    }), $("#tuHoaPhaiSelect").on("change", function(t) {
        var e = document.getElementById("table-la-so");
        $("#inputYear").trigger("change"), e.scrollIntoView({
            behavior: "smooth",
            inline: "start"
        })
    }), $("#next-year,#previous-year").click(function() {
        var t = document.getElementById("table-la-so");
        const e = $(this).attr("name");
        if (e && "next" == e) {
            const e = $("#inputYear").val();
            e && e > 0 && ($("#inputYear").val(parseInt(e) + 1), $("#inputYear").trigger("change"), t.scrollIntoView({
                behavior: "smooth",
                inline: "start"
            }))
        } else {
            const e = $("#inputYear").val();
            e && e > 0 && ($("#inputYear").val(parseInt(e) - 1), $("#inputYear").trigger("change"), t.scrollIntoView({
                behavior: "smooth",
                inline: "start"
            }))
        }
    }), $("#next-month,#previous-month").click(function() {
        var t = document.getElementById("table-la-so");
        const e = $(this).attr("name");
        if (e && "next" == e) {
            const e = $("#viewMonth3").val();
            e && e > 0 && e < 12 && ($("#viewMonth3").val(parseInt(e) + 1), $("#viewMonth3").trigger("change"), t.scrollIntoView({
                behavior: "smooth",
                inline: "start"
            }))
        } else {
            const e = $("#viewMonth3").val();
            e && e > 1 && ($("#viewMonth3").val(parseInt(e) - 1), $("#viewMonth3").trigger("change"), t.scrollIntoView({
                behavior: "smooth",
                inline: "start"
            }))
        }
    }), $("#image-la-so").on("click", function() {
        const t = $(this),
            e = t.attr("data-name");
        t.empty(), t.html('<div class="d-flex justify-content-center align-items-center" style="width: 74px">\n                        <div class="spinner-border spinner-border-sm" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>');
        const a = $(".table-la-so").clone().appendTo("#file-hinh-clone");
        a.css("top", ""), a.css("-webkit-transform", "scale(3)"), a.css("-webkit-transform-origin", "0%");
        const n = a[0].getBoundingClientRect().height,
            i = a[0].getBoundingClientRect().width;
        html2canvas(a, {
            scale: 5,
            width: i,
            height: n,
            onrendered: function(a) {
                var n = a.toDataURL("image/png"),
                    i = document.createElement("a"),
                    o = n.replace(/^data:image\/png/, "data:application/octet-stream");
                i.href = o, i.download = e + ".png", i.click(), t.html('\n                <div class="icon-file-hinh"></div>\n                <span class="txt-sub-content text-white">Tải ảnh</span>\n                ')
            }
        }), a.empty()
    }), $("#view-full-screen").click(function(t) {
        $("#modal-la-so").css("display", "block"), $("body").css("overflow", "hidden");
        const e = $("#table-la-so");
        $("#la-so-modal").html(e);
        var a = $(window).height();
        e.css("transform", `scale(${(a+150)/$("#table-la-so")[0].getBoundingClientRect().height}) translate(0%)`), e.css("transform-origin", "50% 0"), e.css("left", "0");
        const n = $("#binh-giai-tong-quan"),
            i = $("#binh-giai-12-cung"),
            o = $("#binh-giai-dai-van"),
            s = $("#binh-giai-tieu-van");
        $("#luan-giai-modal").append(n, i, o, s)
    }), $("#shareLaso").on("click", function() {
        window.location.pathname.substring(1)
    }), $("#share-la-so-content button.btn-copy").on("click", function() {
        const t = $(this).parent();
        if (t) {
            const e = t.find("input");
            e && ($(e).select(), document.execCommand("copy"))
        }
    }), $("#share-ls-fb").on("click", function() {
        var t = screen.height / 2 - 260,
            e = screen.width / 2 - 175,
            a = window.location.href;
        window.open("http://www.facebook.com/sharer.php?s=100&p[url]=" + a, "top=" + t + ",left=" + e + ",toolbar=0,status=0,width=520,height=350")
    }), $(".viewChoLaSo").on("click", function() {
        window.location.href = "/cho-la-so"
    });
    let r = [];
    $(".pushChoLaSo").on("click", function(t) {
        if (isLogged()) {
            const t = $("select[name=yearTieuVan]"),
                i = t.attr("data-yob");
            if (parseInt(t.val())) {
                var a = parseInt(t.val()) - parseInt(i) + 1;
                $("#tuoiTieuVan").text(a), $(".topic-select-tieu-van").removeClass("w-100")
            } else $("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100");
            t.on("change", function() {
                if (parseInt(t.val())) {
                    var e = parseInt(t.val()) - parseInt(i) + 1;
                    $("#tuoiTieuVan").text(e), $("#descriptionTieuVan").removeClass("d-none"), $(".topic-select-tieu-van").removeClass("w-100")
                } else $("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100")
            });
            const o = $("#inputTitleTopic");
            o.on("keydown", function(t) {
                13 == t.keyCode && t.preventDefault()
            }), o.on("keyup", function(t) {
                const e = $(this).val().length;
                $("#titleCountCharacter").text(e + "/" + MAX_LENGTH_TITLE_TOPIC)
            }),$("#modalPushLaSo").modal("show"), $("#imgPushLaSo").on("change", function() {
                listImg = [], r = imagesPreview(this, "div.gallery")
            });
            var n = $("#list-tag-topic > .category.current");
            n && checkSuggestPriceCurrent(n, $("#txt-suggest-price-la-so"), e)
        } else openModalLogin(t)
    });
    var c = [];
    const l = $("#list-tag-topic").find("div");
    $(l[0]).on("click", function() {
        l.removeClass("current"), $(this).addClass("current")
    });
    for (i = 1; i < l.length; i++) c.push(parseInt($(l[i]).attr("data-id-tag"))), $(l[i]).on("click", function() {
        $(l[0]).removeClass("current"), $(this).hasClass("current") ? $(this).removeClass("current") : $(this).addClass("current");
        const t = $("#list-tag-topic").find(".current");
        t.length == l.length - 1 && (l.removeClass("current"), $(l[0]).addClass("current")), checkSuggestPriceCurrent(t, $("#txt-suggest-price-la-so"), e)
    });
    $("#formPushLaSo").on("submit", function(t) {
        if ($(this).find("button").attr("disabled", !0), isLogged()) {
            t.preventDefault();
            const o = $("#name-la-so").text() || "",
                s = $(this).find("div[id=errorForm]");
            var e = $(this).find("textarea[id=inputTitleTopic]").val() || "";
            e = e.trim();
            const r = parseInt($(this).find("input[name=idLaso]").val()),
                l = parseFloat($(this).find("select[name=budget]").val()),
                d = $("#list-tag-topic").find("div.category.current"),
                p = "0" !== $(this).find("select[name=yearTieuVan]").val() ? "Tiểu vận " + $(this).find("select[name=yearTieuVan]").val() + " (" + $(this).find("#descriptionTieuVan").text() + ")" : "",
                m = "0" !== $(this).find("select[name=yearsDaiVan]").val() ? $(this).find("select[name=yearsDaiVan]").val() : "",
                u = "" !== $("#nameMaster").attr("data-id-master-selected") ? parseInt($("#nameMaster").attr("data-id-master-selected")) : 0,
                h = $("#check-privacy-topic").is(":checked");
            var a = [];
            if (1 == d.length && "0" == $(d[0]).attr("data-id-tag")) a = c;
            else
                for (var n = 0; n < d.length; n++) a.push(parseInt($(d[n]).attr("data-id-tag")));
            if (0 == a.length) $(s).text("Chọn tối thiểu 1 chủ đề"), blinkMe(s), $("#formPushLaSo").find("button").attr("disabled", !1);
            else if (e.length < 3 || e.length > MAX_LENGTH_TITLE_TOPIC) $(this).find("textarea[id=inputTitleTopic]").val(e), $("#titleCountCharacter").text(e.length + "/" + MAX_LENGTH_TITLE_TOPIC), $(s).text("Tiêu đề là bắt buộc và có độ dài từ 3-" + MAX_LENGTH_TITLE_TOPIC + " ký tự"), blinkMe(s), $("#formPushLaSo").find("button").attr("disabled", !1);
            else {
                const t = `${DOMAIN}/markets/topics`,
                    n = {
                        title: e,
                        budget: l,
                        la_so_id: r,
                        tags: a,
                        dai_van: m,
                        tieu_van: p,
                        name: o,
                        privacy: h ? 2 : 1
                    };

                function i(t) {
                    $("#formPushLaSo").find("button").attr("disabled", !1);
                    const e = t.responseJSON,
                        a = window.location,
                        n = encodeURIComponent(a);
                    "5000008" == e.msg && ($(s).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${n}'>Nạp ngay</a>`), blinkMe(s)), "600001005" == e.code && ($(s).html(`<span>Số lượt đăng lá số lên chợ có giới hạn. <a href='/payment?previous=${n}'>Nâng cấp</a> lên  <span class="txt-sub-content-mid">Tài khoản VIP</span> để nhận thêm lượt</span>`), blinkMe(s)), "5000009" == e.msg && ($(s).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(s))
                }
                u && (n.masters = [{
                    id: u
                }]), listImg && listImg.length ? ($(s).html("<span>Xin đợi trong lúc tải hình của bạn lên</span>"), Promise.all([uploadImgTopic(listImg)]).then(function(e) {
                    if ($(s).empty(), e && e.length) {
                        let a = e[0].images || [],
                            o = a.length ? a[0].id : 0;
                        o && (n.media = o), Agents.post(t, n, function(t) {
                            if ("200" == t.code) {
                                const e = t.data.slug;
                                window.location.href = "/" + e
                            }
                        }, t => i(t))
                    }
                }, function(t) {
                    $(s).html("<span>Lỗi quá trình tải ảnh, hãy chọn ảnh khác và thử lại</span>"), blinkMe(s), $("#formPushLaSo").find("button").attr("disabled", !1)
                })) : Agents.post(t, n, function(t) {
                    if ("200" == t.code) {
                        const e = t.data.slug;
                        window.location.href = "/" + e
                    }
                }, t => i(t))
            }
        } else t.preventDefault(), openModalLogin(t), $(this).find("button").attr("disabled", !0);
        $(this).find("select[name=getPro]").val()
    })
}
var listImg = [],
    hasUpload = !1;

function imagesPreview(t, e) {
    if (t.files) {
        let n = t.files.length;
        for (let i = 0; i < n; i++) {
            var a = new FileReader;
            a.onload = function(a) {
                const n = `<div class="d-flex list-file-img-container list-image-comment-1 flex-wrap"><div class="view-image-comment"><img class="image-comment-upload" src="${a.target.result}"><div id="btnDeleteImgCreateTopic" class="cursor-pointer delete-image-comment"><div class="total-icon icon-delete-image-topic"></div></div></div></div>`;
                $("div.gallery").empty(), $(e).append(n), $("#btnDeleteImgCreateTopic").click(function() {
                    $("div.gallery").empty(), listImg = [], hasUpload = !0, $(t).val("")
                })
            }, a.readAsDataURL(t.files[i]), listImg.push(t.files[i])
        }
        return listImg
    }
}

function uploadImgTopic(t) {
    return new Promise(function(e, a) {
        t && t.length > 0 ? uploadImgToServer(t, function(t) {
            t && "200" == t.code && e({
                images: t.data
            })
        }) : a({
            images: []
        })
    })
}

function uploadImgToServer(t, e) {
    var a = new FormData;
    t && t.forEach(t => {
        a.append("files", t, t.name)
    });
    var n = {
        url: APIs.media.upload,
        method: "POST",
        timeout: 0,
        headers: {
            "X-TU-VI": getTOKEN()
        },
        processData: !1,
        mimeType: "multipart/form-data",
        contentType: !1,
        data: a
    };
    $.ajax(n).done(function(t) {
        var a = JSON.parse(t);
        e(a)
    })
}

function pushLaSoToHistory(t) {
    let e, a = $("#dia-ban").attr("data-gender"),
        n = $("#dia-ban").attr("data-nam-sinh"),
        i = $("#dia-ban").attr("data-nam-sinh-number");
    e = a.includes("Nam") ? "Nam mệnh" : "Nữ mệnh";
    let o = i.split(" ");
    const s = `${e} - ${n} - ${i}`;
    let r = $("#dia-ban").attr("data-cuc").split("("),
        c = $("#dia-ban").attr("data-menh");
    const l = `${c} - ${r[0]}`,
        d = {
            dateCreate: new Date
        };
    let p = c.split(" ");
    $("#name-la-so").text() ? d.name = $("#name-la-so").text() : d.name = "Lập Lá Số Tử Vi", s && (d.info = s), o && (d.tuoi = o[1]), p && (d.menh = p[p.length - 1]), l && (d.cucMenh = l), t && (d.path = t), $("#luong-la-so").text() && (d.canLuong = $("#luong-la-so").text());
    try {
        let t = JSON.parse(localStorage.getItem("history"));
        t && t.length > 0 ? (t.length > 6 && t.splice(1, 1), t.push(d), localStorage.setItem("history", JSON.stringify(t))) : localStorage.setItem("history", JSON.stringify([d]))
    } catch (t) {
        22 === t.code || t.code
    }
}

function loadLaSoHistory() {
    try {
        const t = JSON.parse(localStorage.getItem("history"));
        t && t.length > 0 && $.map(t.reverse(), function(t, e) {
            if (e < 6 && e > 0) {
                t.timeSince = sinceTime(t.dateCreate);
                const e = {
                    item: t
                };
                var a = $("#laSoCardMini").tmpl(e);
                $("#la-so-created").append(a)
            }
        })
    } catch (t) {
        22 === t.code || t.code
    }
}

function resizeLaSo() {
    var t = $(window).width();
    const e = $("#content-la-so"),
        a = $("#table-la-so");
    if (t < 1201 && t>991) {
		console.log(t);
        if (a.css("-webkit-transform", `scale(${(1100)/1400}) translateX(-50%)`), a.css("-webkit-transform-origin", "0% 0"), a.length > 0) {
            const t = a.get(0);
            e.css("height", t.getBoundingClientRect().height), e.css("position", "relative"), a.css("position", "absolute"), a.css("top", "0"), a.css("left", "50%")
        }
        "block" == $("#modal-detail-topic").css("display") ? $("#close-modal-detail-topic").click() : "block" == $("#modal-la-so").css("display") && $("#close-modal-la-so").click()
    }else if (t < 992 && t > 524) {
		console.log(t);
        if (a.css("-webkit-transform", `scale(${(800)/1400}) translateX(-50%)`), a.css("-webkit-transform-origin", "0% 0"), a.length > 0) {
            const t = a.get(0);
            e.css("height", t.getBoundingClientRect().height), e.css("position", "relative"), a.css("position", "absolute"), a.css("top", "0"), a.css("left", "50%")
        }
        "block" == $("#modal-detail-topic").css("display") ? $("#close-modal-detail-topic").click() : "block" == $("#modal-la-so").css("display") && $("#close-modal-la-so").click()
    } else if (t < 525 && t>421) {
		console.log(t);
        if (a.css("-webkit-transform", `scale(${(t+200)/1400}) translateX(-50%)`), a.css("-webkit-transform-origin", "0% 0"), a.length > 0) {
            const t = a.get(0);
            e.css("height", t.getBoundingClientRect().height), e.css("position", "relative"), a.css("position", "absolute"), a.css("top", "0"), a.css("left", "50%")
        }
        "block" == $("#modal-detail-topic").css("display") ? $("#close-modal-detail-topic").click() : "block" == $("#modal-la-so").css("display") && $("#close-modal-la-so").click()
    } else if (t < 422 ) {
		console.log(t);
        if (a.css("-webkit-transform", `scale(${(t+100)/1400}) translateX(-50%)`), a.css("-webkit-transform-origin", "0% 0"), a.length > 0) {
            const t = a.get(0);
            e.css("height", t.getBoundingClientRect().height), e.css("position", "relative"), a.css("position", "absolute"), a.css("top", "0"), a.css("left", "50%")
        }
        "block" == $("#modal-detail-topic").css("display") ? $("#close-modal-detail-topic").click() : "block" == $("#modal-la-so").css("display") && $("#close-modal-la-so").click()
    } else "block" != $("#modal-detail-topic").css("display") && "block" != $("#modal-la-so").css("display") && (a.removeAttr("style"), e.removeAttr("style"));
    
    const n = $("#setting-la-so-responsive"),
        i = $(".right-content");
    if (t < 769) {
        if (0 === n.find("#setting-la-so").length) {
            const t = $("#setting-la-so");
            n.append(t)
        }
    } else if ("block" != $("#modal-detail-topic").css("display") && 0 === i.find("#setting-la-so").length) {
        const t = $("#setting-la-so");
        i.prepend(t)
    }
}

function inActiveTab() {
    let t = $("#binh-giai-12-cung-content > div");
    for (var e = 0; e < t.length; e++) {
        let a = t[e].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > span"),
            n = t[e].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > div"),
            i = t[e].querySelector(".detail-item-binh-giai-12-cung");
        a.textContent = "Xem chi tiết", $(i).removeClass("show-detail-item-12-cung"), $(n).removeClass("turn-up")
    }
}

function activeTab(t) {
    const e = $(t);
    let a = e[0].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > span"),
        n = e[0].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > div"),
        i = e[0].querySelector("div.detail-item-binh-giai-12-cung");
    a.textContent = "Thu gọn", $(i).addClass("show-detail-item-12-cung"), $(n).addClass("turn-up")
}

function loadLuanGiai(t, e) {
    var a = {
        url: APIs.laSo.luanGiai,
        method: "POST",
        timeout: 0,
        headers: {
            "Content-Type": "application/json"
        },
        data: JSON.stringify(t)
    };
    $.ajax(a).done(function(t) {
        e(t)
    })
}

function handlerLoadLG(t, e, a) {
    e.empty();
	console.log("sss");
    let n = [];
    if (a && a.length > 0)
        for (let t = 0; t < a.length; t++) {
            let e = a[t],
                i = e.title || "",
                o = e.content || "",
                s = "";
            e.luan_giai_source && (s = e.luan_giai_source.name || ""), n.push('<div class="item-binh-giai">\n                                            <p class="m-b-10 txt-content-bold text-color-title">' + i + '</p>\n                                            <p class="m-b-10 txt-content">' + o + '</p>\n                                            <p class="mb-0 text-author-binh-giai">' + s + "</p>\n                                       </div>\n                                    ")
        } else n.push('<h6 class="text-center">Chưa có dữ liệu</h6>');
    t && t.attr("data-loaded", "true"), e.html(n)
}

function handlerClickBinhGiaiDaiVan(t, e) {
    const a = t.text();
    if (a) {
        $("#table-binh-giai-dai-van > tbody > tr > td").removeClass("active-binh-giai-dai-van"), t.addClass("active-binh-giai-dai-van");
        const n = e;
        n.empty(), n.html('\n                            <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    ');
        let i = a.trim().toLowerCase().replace("đại vận", "").replace("tuổi", "").trim().split("-")[0];
        const o = $(`td[data-dai-van="${i}"]`),
            s = getParamSearch($(o[0]).attr("id").replace("parent-", ""));
            console.log(s);
        s.type = "DAI-VAN", loadLuanGiai(s, function(t) {
            if ("200" == t.code) {
                const e = t.data;
                handlerLoadLG(null, n, e)
            } else n.html('<h6 class="text-center">Chưa có dữ liệu</h6>')
        })
    }
}

function handlerClickBinhGiaiTieuVan(t, e) {
    if (t.text()) {
        $("#binh-giai-tieu-van > tbody > tr > td").removeClass("active-binh-giai-dai-van"), t.addClass("active-binh-giai-dai-van");
        const a = e;
        a.empty(), a.html('\n                            <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    ');
        const n = $('td[data-luu-nien="LN.MỆNH"]');
        getParamSearch($(n[0]).attr("id").replace("parent-", "")).type = "VAN-NAM", a.html('<h6 class="text-center">Chưa có dữ liệu</h6>')
    }
}

function handlerClickBinhGiai12Cung(t, e) {
    e.preventDefault();
    const a = t.offset().top;
    $("html,body").animate({
        scrollTop: a - 40
    }, "slow");
    const n = t,
        i = n.attr("data-loaded");
    let o = n[0].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > span"),
        s = n[0].querySelector(" div.view-header-follow-la-so.m-b-5 > div:nth-child(2) > div"),
        r = n[0].querySelector("div.detail-item-binh-giai-12-cung");
    "Thu gọn" == o.textContent ? o.textContent = "Xem chi tiết" : o.textContent = "Thu gọn", $(r).toggleClass("show-detail-item-12-cung"), $(s).toggleClass("turn-up");
    var c = n.attr("id");
    let l, d = "",
        p = !1,
        m = c.replace("cung-", "");
    if ("than" == m) {
        var u = $('span[data-cung="than"]'),
            h = $(u.parent()).children()[0];
        d = $(h).attr("data-cung"), p = !0
    }
    l = getParamSearch(p ? d : m, p);
    let g = $("#" + c + " div.detail-item-binh-giai-12-cung");
    "false" == i && (g.empty(), g.html('\n                            <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    '), loadLuanGiai(l, function(t) {
        if ("200" == t.code) {
        	console.log(t);
            const e = t.data;
            handlerLoadLG(n, g, e)
        } else g.html('<h6 class="text-center">Chưa có dữ liệu</h6>')
    }))
}

function handlerHoverLaSo(t, e) {
    if ($(".view-con-giap-la-so").css("display", "none"), $(".view-con-giap-la-so-hover").css("display", "block"), $(`${e} #list-line-la-so-hover`).removeAttr("class"), t && t.childNodes.length < 6) {
        var a = parseInt($(t).attr("data-cung-full-id"));
        $(`${e} #list-line-la-so-hover`).addClass("view-con-giap-la-so-hover"), $(`${e} #list-line-la-so-hover`).addClass(`list-line-${a}`);
        var n = a;
        if (a > 3 && a < 8) var i = a - 4,
            o = a + 4;
        else if (a > 7) i = a - 4, o = a - 8;
        else i = a + 4, o = a + 8;
        if (a > 5) var s = a - 6;
        else s = a + 6;
        if (0 == a || 6 == a) var r = a + 1;
        else if (1 == a || 7 == a) r = a - 1;
        else if (2 == a) r = a + 9;
        else if (11 == a) r = a - 9;
        else if (3 == a) r = a + 7;
        else if (10 == a) r = a - 7;
        else if (4 == a) r = a + 5;
        else if (9 == a) r = a - 5;
        else if (5 == a) r = a + 3;
        else r = a - 3;
        for (let t = 0; t < 12; t++) t == n || t == i || t == o || t == s || t == r ? $(e + "#cung" + t).addClass("cung-view-hover") : $(e + "#cung" + t).addClass("none-cung-view-hover")
    }
}

function handlerUnHoverLaSo(t, e) {
    if ($(`${e} #list-line-la-so-hover`).css("display", "none"), $(`${e} #list-line-la-so`).css("display", "block"), t && t.childNodes.length < 6) {
        var a = parseInt($(t).attr("data-cung-full-id")),
            n = a;
        if (a > 3 && a < 8) var i = a - 4,
            o = a + 4;
        else if (a > 7) i = a - 4, o = a - 8;
        else i = a + 4, o = a + 8;
        if (a > 5) var s = a - 6;
        else s = a + 6;
        if (0 == a || 6 == a) var r = a + 1;
        else if (1 == a || 7 == a) r = a - 1;
        else if (2 == a) r = a + 9;
        else if (11 == a) r = a - 9;
        else if (3 == a) r = a + 7;
        else if (10 == a) r = a - 7;
        else if (4 == a) r = a + 5;
        else if (9 == a) r = a - 5;
        else if (5 == a) r = a + 3;
        else r = a - 3;
        for (let t = 0; t < 12; t++) t == n || t == i || t == o || t == s || t == r ? $(e + "#cung" + t).removeClass("cung-view-hover") : $(e + "#cung" + t).removeClass("none-cung-view-hover")
    }
}

function handlerClickTextSaoChinhTinh(t, e, a, n) {
    let i, o = t.attr("data-cung"),
        s = "",
        r = !1;
    if ("than" == o) {
        var c = $(t.parent()).children()[0];
        s = $(c).attr("data-cung"), r = !0
    }
    if (i = getParamSearch(r ? s : o, r), "dai-van" == o) goToByScroll("binh-giai-dai-van");
    else if ("tieu-van" == o) goToByScroll("binh-giai-tieu-van");
    else {
        e.preventDefault();
        const t = $("#cung-" + o),
            s = t.attr("data-loaded");
        inActiveTab(), activeTab(a + "#cung-" + o);
        let r = $(a + "#cung-" + o).offset().top;
        if (n) {
            let t = $(a + "#cung-" + o)[0].offsetTop;
            $("#luan-giai-modal").animate({
                scrollTop: t
            }, "slow")
        } else $("html,body").animate({
            scrollTop: r - 5
        }, "slow");
        let c = $(a + "#cung-" + o + " div.detail-item-binh-giai-12-cung");
        "false" == s && (c.empty(), c.html('\n                      <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    '), loadLuanGiai(i, function(e) {
            if ("200" == e.code) {
                const a = e.data;
                handlerLoadLG(t, c, a)
            }
        }))
    }
}

function handlerClickDaiVanNumber(t, e, a, n, i) {
    const o = t.text(),
        s = parseInt(o);
    if (o) {
        $("#table-binh-giai-dai-van > tbody > tr > td").removeClass("active-binh-giai-dai-van");
        let t = a;
        for (let e = 0; e < t.length; e++) {
            let a = t[e],
                n = $(a).text().trim().toLowerCase().replace("đại vận", "").replace("tuổi", "").trim().split("-"),
                i = parseInt(n[0]),
                o = parseInt(n[1]);
            if (s >= i && s < o) {
                $(a).addClass("active-binh-giai-dai-van");
                break
            }
        }
        const o = e;
        o.empty(), o.html('\n                            <div class="spinner-border" role="status" style="margin: auto 50%">\n                              <span class="sr-only">Loading...</span>\n                            </div>\n                    ');
        let r = i.offset().top;
        if (n) {
            let t = i[0].offsetTop;
            $("#luan-giai-modal").animate({
                scrollTop: t
            }, "slow")
        } else $("html,body").animate({
            scrollTop: r - 5
        }, "slow");
        const c = $(`td[data-dai-van="${s}"]`),
            l = getParamSearch($(c[0]).attr("id").replace("parent-", ""));
        l.type = "DAI-VAN", loadLuanGiai(l, function(t) {
            if ("200" == t.code) {
                const e = t.data;
                handlerLoadLG(null, o, e)
            }
        })
    }
}

function loadNamXem(t, e) {
    var a = {
        url: APIs.laSo.luuNien,
        method: "POST",
        timeout: 0,
        headers: {
            "Content-Type": "application/json"
        },
        data: JSON.stringify(t)
    };
    $.ajax(a).done(function(t) {
        e(t)
    })
}

function getDataFromCung(t) {
    const e = $("#parent-" + t),
        a = e.attr("data-chi"),
        n = e.attr("data-cung-id"),
        i = [],
        o = e.find("p.text-chinh-chinh");
    for (let t = 0; t < o.length; t++) {
        let e = o[t];
        const a = $(e).attr("data-sao-id");
        i.push({
            id: parseInt(a)
        })
    }
    const s = e.find("div.sao-tot > div");
    for (let t = 0; t < s.length; t++) {
        let e = s[t];
        const a = $(e).attr("data-sao-id");
        i.push({
            id: parseInt(a)
        })
    }
    const r = e.find("div.sao-xau > div");
    for (let t = 0; t < r.length; t++) {
        let e = r[t];
        const a = $(e).attr("data-sao-id");
        i.push({
            id: parseInt(a)
        })
    }
    return {
        cung_id: parseInt(n),
        chi_id: parseInt(a),
        saos: i
    }
}

function findCungTapHop(t) {
    return "menh" == t ? ["quan-loc", "tai-bach"] : "huynh-de" == t ? ["dien-trach", "tat-ach"] : "phu-the" == t ? ["phuc-duc", "thien-di"] : "tu-tuc" == t ? ["phu-mau", "no-boc"] : "tai-bach" == t ? ["menh", "quan-loc"] : "tat-ach" == t ? ["huynh-de", "dien-trach"] : "thien-di" == t ? ["phuc-duc", "thien-di"] : "no-boc" == t ? ["phu-mau", "tu-tuc"] : "quan-loc" == t ? ["menh", "tai-bach"] : "dien-trach" == t ? ["huynh-de", "tat-ach"] : "phuc-duc" == t ? ["phu-the", "thien-di"] : "phu-mau" == t ? ["tu-tuc", "no-boc"] : void 0
}

function findCungChieu(t) {
    return "menh" == t ? "thien-di" : "huynh-de" == t ? "no-boc" : "phu-the" == t ? "quan-loc" : "tu-tuc" == t ? "dien-trach" : "tai-bach" == t ? "phuc-duc" : "tat-ach" == t ? "phu-mau" : "thien-di" == t ? "menh" : "no-boc" == t ? "huynh-de" : "quan-loc" == t ? "phu-the" : "dien-trach" == t ? "tu-tuc" : "phuc-duc" == t ? "tai-bach" : "phu-mau" == t ? "tat-ach" : void 0
}

function findNhiHop(t) {
    const e = $("#parent-" + t).attr("data-cung-full-id");
    var a = 0;
    0 == e ? a = 1 : 1 == e ? a = 0 : 2 == e ? a = 11 : 11 == e ? a = 2 : 3 == e ? a = 10 : 10 == e ? a = 3 : 4 == e ? a = 9 : 9 == e ? a = 4 : 5 == e ? a = 8 : 8 == e ? a = 5 : 6 == e ? a = 7 : 7 == e && (a = 6);
    var n = $('#table-la-so td[data-cung-full-id="' + a + '"]');
    if (n) {
        var i = n.attr("id");
        return getDataFromCung(i = i.replace("parent-", ""))
    }
}

function getParamSearch(t, e) {
    var a = getDataFromCung(t);
    e && (a.cung_id = 50);
    var n = getDataFromCung(findCungChieu(t)),
        i = findCungTapHop(t),
        o = getDataFromCung(i[0]);
    return {
        main: a,
        type: "CUNG",
        th_right: getDataFromCung(i[1]),
        th_left: o,
        nhi_hop: findNhiHop(t),
        chieu: n
    }
}

function initLoginScreen() {
    $('input[name="password"]').on("change", function() {
        const t = $(this).val();
        Validate.password(t) ? $("#errPass").text("") : $("#errPass").text("Mật khẩu độ dài 6-30 ký tự và không có cách trống")
    }), $('input[name="re_password"]').on("change", function() {
        const t = $(this).val();
        $('input[name="password"]').val().trim() != t ? $("#errRePass").text("Not match the Password!") : $("#errRePass").text("")
    }), $("#formLogin").on("submit", function(t) {
        $(this).find("button").attr("disabled", !0);
        const e = $(this).find('input[name="email"]').val().trim(),
            a = $(this).find('input[name="password"]').val().trim();
        e && validateEmail(e) && a && validatePassword(a) || ($("#errPass").text("Sai định dạng Email hoặc Password"), t.preventDefault(), $(this).find("button").attr("disabled", !1))
    })
}

function initRegisterScreen() {
    $("#formRegister").on("submit", function(t) {
        $("#btnRegister").attr("disabled", !0);
        const e = $(this).find('input[name="name"]').val().trim(),
            a = $(this).find('input[name="email"]').val().trim(),
            n = $(this).find('input[name="password"]').val().trim(),
            i = $(this).find('input[name="re_password"]').val().trim();
        Validate.email(a) ? a.length > 320 ? ($("#errEmail").text("Email ít hơn 320 ký tự"), t.preventDefault(), $("#btnRegister").attr("disabled", !0)) : $("#errEmail").text("") : ($("#errEmail").text("Email không đúng định dạng"), t.preventDefault(), $("#btnRegister").attr("disabled", !0)), Validate.name(e) ? $("#errName").text("") : ($("#errName").text("Tên có độ dài 3-50 ký tự không được chứa số hoặc ký tự đặc biệt"), t.preventDefault(), $("#btnRegister").attr("disabled", !1)), Validate.password(n) ? $("#errPass").text("") : ($("#errPass").text("Mật khẩu độ dài từ 6-30 ký tự và không có cách trống"), t.preventDefault(), $("#btnRegister").attr("disabled", !1)), n != i ? ($("#errRePass").text("Không trùng mật khẩu"), t.preventDefault(), $("#btnRegister").attr("disabled", !1)) : $("#errRePass").text("")
    }), $('input[name="password"]').on("change", function() {
        const t = $(this).val();
        Validate.password(t) ? $("#errPass").text("") : $("#errPass").text("Mật khẩu độ dài từ 6-30 ký tự và không có cách trống")
    }), $('input[name="re_password"]').on("change", function() {
        const t = $(this).val(),
            e = $('input[name="password"]').val().trim();
        Validate.password(t) ? e != t ? $("#errRePass").text("Không trùng mật khẩu") : $("#errRePass").text("") : $("#errRePass").text("Mật khẩu độ dài từ 6-30 ký tự và không có cách trống")
    })
}

function initForgotPassword() {
    $("#formRequestToken").on("submit", function(t) {
        t.preventDefault(), $(this).find("button").attr("disabled", !0);
        const e = $(this).find('input[name="email"]').val().trim();
        if (e)
            if (Validate.email(e) && e.length <= 320) {
                $("#errEmail").text("");
                const t = {
                    email: e
                };
                Agents.post(APIs.auth.forgotPassword, t, function(t) {
                    "200" == t.code ? ($("#formRequestToken").empty(), $("#formRequestToken").html("<span>Yêu cầu gửi thành công! Kiểm tra email để thay đổi mật khẩu mới</span>")) : $("#errEmail").text("Email không tồn tại, thử lại email khác"), $("#formRequestToken").find("button").attr("disabled", !1)
                }, function(t) {
                    const e = t.responseJSON;
                    e ? ("500001016" == e.code ? $("#errEmail").text("Chưa xác thực email này, hãy truy cập email để xác thực") : $("#errEmail").text("Email không tồn tại, thử lại email khác"), $("#formRequestToken").find("button").attr("disabled", !1)) : window.location.href = "/404"
                })
            } else $("#errEmail").text("Sai định dạng Email"), $(this).find("button").attr("disabled", !1);
        else $("#errEmail").text("Email là trường bắt buộc"), $(this).find("button").attr("disabled", !1)
    }), $("#formRequestNewPass").on("submit", function(t) {
        t.preventDefault(), $(this).find("button").attr("disabled", !0);
        const e = $(this).find('input[name="token"]').val().trim(),
            a = $(this).find('input[name="password"]').val().trim(),
            n = $(this).find('input[name="re_password"]').val().trim();
        if (e && a && n)
            if (Validate.password(a) && Validate.password(n))
                if (a === n) {
                    const t = {
                        token: e,
                        new_password_1: a,
                        new_password_2: n
                    };
                    Agents.post(APIs.auth.changeForgotPassword, t, function(t) {
                        "200" == t.code ? window.location.href = "/login?message=changePassSuccess" : window.location.href = "/404", $("#formRequestNewPass").find("button").attr("disabled", !1)
                    }, function(t) {
                        "500001012" == t.responseJSON.msg ? ($("#formRequestNewPass").empty(), $("#formRequestNewPass").html('<div>Yêu cầu đã hết hạn, vui lòng <a href="/forgot-password">gửi lại</a> yêu cầu khác hoặc <a href="/login">đăng nhập</a> để tiếp tục</div>')) : window.location.href = "/404"
                    })
                } else $("#errRePass").text("Nhập lại mật khẩu không khớp"), $(this).find("button").attr("disabled", !1);
        else $("#errPass").text("Mật khẩu độ dài từ 6-30 ký tự và không có cách trống"), $(this).find("button").attr("disabled", !1);
        else $("#errPass").text("Mật khẩu độ dài từ 6-30 ký tự và không có cách trống"), $(this).find("button").attr("disabled", !1)
    })
}

function initProfileGuestScreen() {
    const t = $("input[name=userId]").val() || "";

    function e(e) {
        const n = $("#topicsContainer");
        n.empty();
        for (let t = 0; t < 6; t++) n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        Agents.get(`${APIs.markets.masterTopics}?limit=6&page=${e}&user=${t}`, function(t) {
            if (t) {
                const e = t.data;
                e && setTimeout(function() {
                    const t = e.total_count || 0,
                        i = e.total_page || 0,
                        o = e.page || 1;
                    $("#total-topics").html(`Hiện có ${t} lá số`);
                    const s = e.data || [];
                    n.empty(), $("#topics-pagination").css("display", "none"), s.length ? (s.forEach(function(t) {
                        const e = (t = topicItemHandler(t)).id || 0;
                        $("#cardTopicMarket").tmpl(t).appendTo("#topicsContainer");
                        const a = t.user,
                            n = a && a.is_thay;
                        t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), n && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">');
                        var i = $(`a#${e} > div.list-tag`);
                        i && 1 == i.length && (i = i[0]);
                        const o = t.tags || [];
                        if (o.length > 0)
                            for (let t = 0; t < o.length; t++) {
                                const e = getIconTagTopic(o[t].id || 0),
                                    a = $(e);
                                var s = $("<div class='small-tag'></div>");
                                s.html(a), $(i).find(".tag-container").append(s)
                            } else $(i).addClass("d-none"), $(i).empty();
                        var r = $(`a#${e} .list-view-user`),
                            c = t.view_users || [],
                            l = t.total_view_user || 0;
                        if (l > 0) {
                            const t = 5 == l ? 5 : l > 5 ? 4 : l;
                            for (let e = 0; e < t; e++) {
                                const t = c[e];
                                var d = t ? t.avatar : "";
                                d && "" != d || (d = "/public/images/avt-default.jpg");
                                const a = t ? t.name : "";
                                var p = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${d}" title="${a}">`);
                                $(r).append(p)
                            }
                            if (l > 5) {
                                let t = l - 4 > 99 ? 99 : l - 4;
                                const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                                $(r).append(e)
                            }
                        }
                    }), s && s.length && a(i, o, "topics-pagination"), $("button[name=saveTopic]").on("click", function(t) {
                        if (t.preventDefault(), isLogged()) try {
                            const e = $(this),
                                a = "BUTTON" == t.target.nodeName ? $(t.target.children) : $(t.target),
                                n = e.attr("data-id"),
                                i = e.attr("data-save"),
                                o = `${DOMAIN}/user/saved-list`,
                                s = {
                                    module: "TOPIC",
                                    item_object: n
                                };
                            n && ("false" == i ? Agents.post(o, s, function(t) {
                                if ("200" == t.code) {
                                    e.attr("data-save", "true"), a.attr("src", "/public/images/icon/ic-saved.png");
                                    const t = $(`button[name=saveTopic][data-id=${n}]`);
                                    t.attr("data-save", "true"), t.html(a)
                                }
                            }, function(t) {}) : Agents.delete(o, s, function(t) {
                                if ("200" == t.code) {
                                    e.attr("data-save", "false"), a.attr("src", "/public/images/icon/ic-save.png");
                                    const t = $(`button[name=saveTopic][data-id=${n}]`);
                                    t.attr("data-save", "false"), t.html(a)
                                }
                            }, function(t) {}))
                        } catch (t) {} else openModalLogin(t)
                    }), $(".lazy").lazy()) : n.append('<div class="text-center">Không có kết quả tìm kiếm</div>')
                }, 100)
            }
        })
    }

    function a(t, a, i) {
        var o = [];
        if (t > 0 && a <= t) {
            if (t < 5) o = Array.from(new Array(t), (t, e) => e + 1);
            else if (a <= 4) o = Array.from(new Array(5), (t, e) => e + 1);
            else if (a >= t - 1)
                for (var s = t - 4; s < t + 1; s++) o.push(s);
            else o = [a - 2, a - 1, a, a + 1, a + 2];
            var r = $(`#${i}`),
                c = [];
            if (a > 1) {
                var l = `<li class="paginationjs-prev" data-page="${a-1}"><a class="cursor-pointer" >«</a></li>`;
                c.push(l)
            } else {
                l = '\n                                    <li class="paginationjs-prev disabled">\n                                     <a class="cursor-pointer">«</a>\n                                    </li>\n                                 ';
                c.push(l)
            }
            if (o.forEach(function(t) {
                    var e = `\n                                    <li class="paginationjs-page J-paginationjs-page ${t==a?"active":""}" data-page="${t}">\n                                          <a class="cursor-pointer">${t}</a>\n                                    </li>\n                                `;
                    c.push(e)
                }), a < t) {
                var d = `\n                                    <li class="paginationjs-next" data-page="${a+1}">\n                                    <a class="cursor-pointer" >»</a>\n                                    </li>\n                                 `;
                c.push(d)
            } else {
                d = '\n                                    <li class="paginationjs-next disabled">\n                                    <a class="cursor-pointer">»</a>\n                                    </li>\n                                 ';
                c.push(d)
            }
            r.html(c), r.css("display", "block"), "topics-pagination" == i ? $("#topics-pagination > li").on("click", function(t) {
                const a = $(this);
                if (!a.hasClass("active") && !a.hasClass("disabled")) {
                    const t = a.attr("data-page"),
                        n = parseInt(t);
                    e(n)
                }
            }) : $("#article-pagination > li").on("click", function(t) {
                const e = $(this);
                if (!e.hasClass("active") && !e.hasClass("disabled")) {
                    const t = e.attr("data-page"),
                        a = parseInt(t);
                    n(a), goToByScroll("widget-article")
                }
            })
        }
    }

    function n(e) {
        const n = $("#articleContainer");
        n.empty();
        for (let t = 0; t < 6; t++) n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        Agents.get(`${APIs.article.get}?limit=5&page=${e}&author=${t}`, function(t) {
            if (t) {
                const e = t.data;
                e && setTimeout(function() {
                    const t = e.total_page || 0,
                        i = e.page || 1,
                        o = e.edges || [];
                    n.empty(), $("#article-pagination").css("display", "none"), o.length ? (o.forEach(function(t) {
                        $("#cardArticleAuthor").tmpl(t).appendTo("#articleContainer")
                    }), o && o.length && a(t, i, "article-pagination"), $(".lazy").lazy()) : n.append('<div class="text-center m-t-20">Người dùng chưa có bài viết !</div>')
                }, 100)
            }
        })
    }
    e(1), n(1)
}

function initProfileScreen() {
    const t = document.querySelector("#avatarInputProfile"),
        e = document.querySelector("#preview");

    function a(t, e, n, i, o, s, r) {
        o || (o = 1);
        const c = s || $("#ls-container");
        c.empty(), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), c.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        const l = r || $("#profilePaginationTopic");
        var d = "",
            p = !1;
        t.includes("type=1") ? d = "Thu hồi" : t.includes("type=0") && (d = "Đăng lại", p = !0), Agents.get(t + "&pageSize=6&pageNumber=" + o, function(s) {
            if (200 == s.code) {
                const v = s.data,
                    b = v.data,
                    y = "laso" === n ? `<p class="txt-sub-content text-secondary text-center m-t-20">Chưa có ${e}. <a href="/lap-la-so-tu-vi">Tạo lá số mới</a> </p>` : `<p class="txt-sub-content text-secondary text-center m-t-20">Chưa có ${e}</p>`;
                if (!b && c.html(y) && c.addClass("d-block"), b && b.length > 0) {
                    c.empty(), c.removeClass("d-block"), b.forEach(function(t, e) {
                        var a = t;
                        if ("topic" === n) a = topicItemHandler(a = a.item_object || a);
                        else {
                            const e = a.id;
                            (a = t.laso).id = e;
                            const n = t.name || "",
                                i = a.slug || "",
                                o = a.can_chi_tuoi || "",
                                s = (a.loai_hanh_cua_ban_menh || "").split(" ");
                            a.background = getBackgroundLaSoPreview(o.split(" ")[1], s[s.length - 1]), a.href = "" != n ? i + "?name=" + n : i
                        }
                        a.option = d;
                        var o = i.tmpl({
                            item: a
                        });
                        c.append(o);
                        const s = t.user;
                        s && s.is_thay && ($(`div[data-id-card=${a.id}] .username-topic`).empty(), $(`div[data-id-card=${a.id}] .username-topic`).append(`${s.name}<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="">`)), p && ($(`li[data-action=deleteTopic][data-id=${a.id}]`).attr("data-action", "reUpTopic"), $("li[data-action=reUpTopic]").attr("data-target", "#modalReUpTopic"))
                    }), $("button[name=saveTopic]").on("click", function(s) {
                        s.preventDefault();
                        try {
                            const s = $(this).attr("data-id"),
                                r = `${DOMAIN}/user/saved-list`,
                                l = {
                                    module: "TOPIC",
                                    item_object: s
                                };
                            s && Agents.delete(r, l, function(r) {
                                if ("200" == r.code) {
                                    $(`div[data-id-topic=${s}]`).remove();
                                    const r = 0 === c[0].children.length ? o > 1 ? o - 1 : 1 : o;
                                    a(t, e, n, i, r)
                                }
                            }, function(t) {})
                        } catch (t) {}
                    }), $("li[data-action=deleteTopic]").on("click", function(t) {
                        t.preventDefault();
                        let e = $(this).attr("data-id") || 0;
                        $("#modalConfirmDeleteBtn").attr("data-id", e), $("#modalConfirmDeleteBtn").attr("data-module", "topic"), $("#modalConfirmDeleteTitle").text("Gỡ lá số khỏi chợ"), $("#modalConfirmDeleteContent").text("Bạn có chắc chắn muốn gỡ lá số khỏi chợ? Số xu còn lại trên lá số sẽ được hoàn trả")
                    }), $("li[data-action=reUpTopic]").on("click", function(t) {
                        t.preventDefault();
                        var e = $(this).attr("data-id") || 0,
                            a = $(this).attr("data-title") || 0,
                            n = $("#idTopicReUp");
                        n && n.val(e);
                        var i = $("#titleTopicReUp");
                        i && i.val(a)
                    }), $("li[data-action=deleteLaSo]").on("click", function(t) {
                        t.preventDefault();
                        let e = $(this).attr("data-id") || 0;
                        $("#modalConfirmDeleteBtn").attr("data-id", e), $("#modalConfirmDeleteBtn").attr("data-module", "laso"), $("#modalConfirmDeleteTitle").text("Xóa lá số đã tạo"), $("#modalConfirmDeleteContent").text("Bạn thực sự muốn xóa lá số này?")
                    });
                    var r = v.total_page || 0,
                        m = [];
                    if (r > 0 && o <= r) {
                        if (r < 5) m = Array.from(new Array(r), (t, e) => e + 1);
                        else if (o <= 4) m = Array.from(new Array(5), (t, e) => e + 1);
                        else if (o >= r - 1)
                            for (var u = r - 4; u < r + 1; u++) m.push(u);
                        else m = [o - 2, o - 1, o, o + 1, o + 2];
                        var h = [];
                        if (o > 1) {
                            var g = `<li class="paginationjs-prev" data-page="${o-1}"><a class="cursor-pointer" >«</a></li>`;
                            h.push(g)
                        } else {
                            g = '\n                                    <li class="paginationjs-prev disabled">\n                                     <a class="cursor-pointer">«</a>\n                                    </li>\n                                 ';
                            h.push(g)
                        }
                        if (m.forEach(function(t) {
                                var e = `\n                                    <li class="paginationjs-page J-paginationjs-page ${t==o?"active":""}" data-page="${t}">\n                                          <a class="cursor-pointer">${t}</a>\n                                    </li>\n                                `;
                                h.push(e)
                            }), o < r) {
                            var f = `\n                                    <li class="paginationjs-next" data-page="${o+1}">\n                                    <a class="cursor-pointer" >»</a>\n                                    </li>\n                                 `;
                            h.push(f)
                        } else {
                            f = '\n                                    <li class="paginationjs-next disabled">\n                                    <a class="cursor-pointer">»</a>\n                                    </li>\n                                 ';
                            h.push(f)
                        }
                        l.html(h), l.attr("display", "block"), l.find("li").on("click", function(o) {
                            l.attr("display", "none");
                            const s = $(this);
                            if (!s.hasClass("active") && !s.hasClass("disabled")) {
                                const o = s.attr("data-page"),
                                    r = parseInt(o);
                                a(t, e, n, i, r, c, l)
                            }
                        })
                    }
                }
            }
        }, function(t) {})
    }
    t && t.addEventListener("change", function() {
        for (; e.firstChild;) e.removeChild(e.firstChild);
        const a = t.files,
            n = $("#preview");
        if (n.empty(), n.html('<div class="d-flex justify-content-center align-items-center" style="width: 74px">\n                        <div class="spinner-border spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>'), 0 === a.length) {
            n.empty();
            const t = document.createElement("p");
            t.textContent = "Vui lòng chọn ảnh đại diện!", t.className = "text-white", e.appendChild(t)
        } else
            for (const t of a) {
                const a = document.createElement("p");
                if (validFileType(t) && validFileSize(t) && isLogged()) {
                    var i = new FormData;
                    i.append("file", t), Agents.upload(APIs.users.updateAvatar, Agents.methods.POST, i, function(i) {
                        if (i)
                            if (200 == i.code) {
                                n.empty();
                                const a = document.createElement("img");
                                a.src = URL.createObjectURL(t), a.className = "avatar-profile", e.appendChild(a)
                            } else n.empty(), a.textContent = "Upload avatar không thành công", e.appendChild(a);
                        else n.empty(), a.textContent = "Upload avatar không thành công", e.appendChild(a)
                    }, function(t) {
                        n.empty(), a.textContent = "Upload avatar không thành công", e.appendChild(a)
                    })
                } else n.empty(), t.size > 2e6 ? a.textContent = "Dung lượng ảnh quá lớn" : a.textContent = `File name ${t.name}: Not a valid file type. Update your selection.`, e.appendChild(a)
            }
    }), $("#budget").on("change", function() {
        $("div[id=errorForm]").html(""), $("#formReUpTopic").find("button").attr("disabled", !1)
    }), $("#formReUpTopic").on("submit", function(t) {
        $(this).find("button").attr("disabled", !0), t.preventDefault();
        const e = $(this).find("div[id=errorForm]"),
            a = $(this).find("input[id=titleTopicReUp]").val(),
            n = parseInt($(this).find("input[id=idTopicReUp]").val()),
            i = parseFloat($(this).find("select[name=budget]").val()),
            o = `${DOMAIN}/markets/topics`,
            s = {
                title: a,
                budget: i,
                id: n
            };
        Agents.put(o, s, function(t) {
            if ("200" == t.code) {
                const e = t.data.slug || "";
                window.location.href = "/" + e
            }
        }, function(t) {
            $("#formReUpTopic").find("button").attr("disabled", !1);
            const a = t.responseJSON,
                n = window.location,
                i = encodeURIComponent(n);
            "5000008" == a.msg && ($(e).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${i}'>Nạp ngay</a>`), blinkMe(e)), "5000009" == a.msg && ($(e).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(e)), "600001005" == a.code && ($(e).html(`<span>Số lượt đăng lá số lên chợ có giới hạn. <a href='/payment?previous=${i}'>Nâng cấp</a> lên  <span class="txt-sub-content-mid">Tài khoản VIP</span> để nhận thêm lượt</span>`), blinkMe(e))
        })
    });
    const n = $("input[name=userId]").val() || "";

    function i(t) {
        const e = $("#topicsContainer");
        e.empty();
        for (let t = 0; t < 6; t++) e.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        Agents.get(`${APIs.markets.masterTopics}?limit=6&page=${t}&user=${n}`, function(t) {
            if (t) {
                const a = t.data;
                a && setTimeout(function() {
                    const t = a.total_count || 0,
                        n = a.total_page || 0,
                        o = a.page || 1;
                    $("#total-topics").html(`Hiện có ${t} lá số`);
                    const s = a.data || [];
                    e.empty(), $("#topics-pagination").css("display", "none"), s.length ? (s.forEach(function(t) {
                        const e = (t = topicItemHandler(t)).id || 0;
                        $("#cardTopicMarket").tmpl(t).appendTo("#topicsContainer");
                        const a = t.user,
                            n = a && a.is_thay;
                        t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), n && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">');
                        var i = $(`a#${e} > div.list-tag`);
                        i && 1 == i.length && (i = i[0]);
                        const o = t.tags || [];
                        if (o.length > 0)
                            for (let t = 0; t < o.length; t++) {
                                const e = getIconTagTopic(o[t].id || 0),
                                    a = $(e);
                                var s = $("<div class='small-tag'></div>");
                                s.html(a), $(i).find(".tag-container").append(s)
                            } else $(i).addClass("d-none"), $(i).empty();
                        var r = $(`a#${e} .list-view-user`),
                            c = t.view_users || [],
                            l = t.total_view_user || 0;
                        if (l > 0) {
                            const t = 5 == l ? 5 : l > 5 ? 4 : l;
                            for (let e = 0; e < t; e++) {
                                const t = c[e];
                                var d = t ? t.avatar : "";
                                d && "" != d || (d = "/public/images/avt-default.jpg");
                                const a = t ? t.name : "";
                                var p = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${d}" title="${a}">`);
                                $(r).append(p)
                            }
                            if (l > 5) {
                                let t = l - 4 > 99 ? 99 : l - 4;
                                const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                                $(r).append(e)
                            }
                        }
                    }), s && s.length && function(t, e) {
                        var a = [];
                        if (t > 0 && e <= t) {
                            if (t < 5) a = Array.from(new Array(t), (t, e) => e + 1);
                            else if (e <= 4) a = Array.from(new Array(5), (t, e) => e + 1);
                            else if (e >= t - 1)
                                for (var n = t - 4; n < t + 1; n++) a.push(n);
                            else a = [e - 2, e - 1, e, e + 1, e + 2];
                            var o = $("#topics-pagination"),
                                s = [];
                            if (e > 1) {
                                var r = e - 1,
                                    c = `<li class="paginationjs-prev" data-page="${r}"><a class="cursor-pointer" >«</a></li>`;
                                s.push(c)
                            } else {
                                var c = '\n                                    <li class="paginationjs-prev disabled">\n                                     <a class="cursor-pointer">«</a>\n                                    </li>\n                                 ';
                                s.push(c)
                            }
                            if (a.forEach(function(t) {
                                    var a = t == e ? "active" : "",
                                        n = `\n                                    <li class="paginationjs-page J-paginationjs-page ${a}" data-page="${t}">\n                                          <a class="cursor-pointer">${t}</a>\n                                    </li>\n                                `;
                                    s.push(n)
                                }), e < t) {
                                var l = e + 1,
                                    d = `\n                                    <li class="paginationjs-next" data-page="${l}">\n                                    <a class="cursor-pointer" >»</a>\n                                    </li>\n                                 `;
                                s.push(d)
                            } else {
                                var d = '\n                                    <li class="paginationjs-next disabled">\n                                    <a class="cursor-pointer">»</a>\n                                    </li>\n                                 ';
                                s.push(d)
                            }
                            o.html(s), $("#topics-pagination").css("display", "block"), $("#topics-pagination > li").on("click", function(t) {
                                const e = $(this);
                                if (!e.hasClass("active") && !e.hasClass("disabled")) {
                                    const t = e.attr("data-page"),
                                        a = parseInt(t);
                                    i(a)
                                }
                            })
                        }
                    }(n, o), $("button[name=saveTopic]").on("click", function(t) {
                        if (t.preventDefault(), isLogged()) try {
                            const e = $(this),
                                a = "BUTTON" == t.target.nodeName ? $(t.target.children) : $(t.target),
                                n = e.attr("data-id"),
                                i = e.attr("data-save"),
                                o = `${DOMAIN}/user/saved-list`,
                                s = {
                                    module: "TOPIC",
                                    item_object: n
                                };
                            n && ("false" == i ? Agents.post(o, s, function(t) {
                                if ("200" == t.code) {
                                    e.attr("data-save", "true"), a.attr("src", "/public/images/icon/ic-saved.png");
                                    const t = $(`button[name=saveTopic][data-id=${n}]`);
                                    t.attr("data-save", "true"), t.html(a)
                                }
                            }, function(t) {}) : Agents.delete(o, s, function(t) {
                                if ("200" == t.code) {
                                    e.attr("data-save", "false"), a.attr("src", "/public/images/icon/ic-save.png");
                                    const t = $(`button[name=saveTopic][data-id=${n}]`);
                                    t.attr("data-save", "false"), t.html(a)
                                }
                            }, function(t) {}))
                        } catch (t) {} else openModalLogin(t)
                    }), $(".lazy").lazy()) : e.append('<div class="text-center">Không có kết quả tìm kiếm</div>')
                }, 100)
            }
        })
    }
    const o = "true" == $("body").attr("data-master");
    o && i(1);
    var s = (window.location.search.substring(1) || "").toLowerCase();
    switch ($(".tab-profile .tab-item, #changeTabUpdateProfile").on("click", function() {
            const t = $(this).attr("data-id");
            switch ($(".tab-item").removeClass("tab-item-active"), t) {
                case "1":
                    window.history.pushState("", "", "?tab=1"), $("#profile-master").removeClass("d-none"), o && i(1), $(this).addClass("tab-item-active"), Agents.get(APIs.users.update, function(t) {
                        if (200 == t.code) {
                            var e = t.data,
                                a = e.gender;
                            t.data.gender = "M" == a ? "Nam" : "Nữ";
                            var n = e.rank;
                            n || (t.data.rank = {
                                title: ""
                            });
                            var i = e.next_rank,
                                o = 0;
                            if (i) {
                                let a = e.point || 0;
                                o = (i.base_ranking || 0) - a, t.data.need_point = o, t.data.next_rank_title = i.title
                            } else t.data.need_point = 0, t.data.next_rank_title = "";
                            var s = e.about || "";
                            if ($(this).addClass("tab-item-active"), $("#bcProfile").text("Thông tin cá nhân"), $("#widget-left").empty(), $("#profileInformation").tmpl(t.data).appendTo("#widget-left"), n || ($("#currentRank").addClass("d-none"), $("#currentRank").empty()), o <= 0 && $("#needPoint").empty(), e.is_thay || !1) {
                                const t = e.name;
                                $("#profileFullName").empty(), $("#profileFullName").html(`<p class="small-mb txt-sub-title-bold">Thầy:</p>\n                <p class="regular-mb txt-content">${t}<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1"/></p>`);
                                const a = $("#nextRank").find("a");
                                $(a).attr("name", "toBoardRankPageMaster")
                            }
                            "" == s && ($("#aboutContainer").addClass("d-none"), $("#aboutContainer").empty()), $("#widget-left").append("\n                            <script type=\"text/javascript\">\n                               $('#changeTabUpdateProfile').on('click', function() {\n                                 $('#btn-edit-profile').click()\n                               });\n                               $('a[name=toBoardRankPage]').click(function () {\n                                    localStorage.setItem('openCollapse', 'criteriaUser');\n                                    window.location.href = '/ho-tro-va-hoi-dap';\n                                })\n                                $('a[name=toBoardRankPageMaster]').click(function () {\n                                    localStorage.setItem('openCollapse', 'criteriaPro');\n                                    window.location.href = '/ho-tro-va-hoi-dap';\n                                })\n                             <\/script>       \n                            ")
                        }
                    }, function(t) {});
                    break;
                case "2":
                    window.history.pushState("", "", "?tab=2"), $("#profile-master").addClass("d-none"), $(this).addClass("tab-item-active"), Agents.get(APIs.users.update, function(t) {
                        if (200 == t.code) {
                            const e = t.data,
                                a = e.gender || "M";
                            if (e) {
                                $("#bcProfile").text("Chỉnh sửa thông tin"), $("#widget-left").empty(), $(this).addClass("tab-item-active");
                                const t = e.about || "";
                                "" == t && (e.about = t), $("#profileEdit").tmpl(e).appendTo("#widget-left"),
                                    function() {
                                        const t = new Date,
                                            e = t.getFullYear();
                                        var a = t.getDate();
                                        a = a > 9 ? a : "0" + a.toString();
                                        var n = t.getMonth() + 1;
                                        n = n > 9 ? n : "0" + n.toString();
                                        const i = e + "-" + n + "-" + a;
                                        $("#dateInputProfile").attr("max", i)
                                    }(), $("#widget-left").append("\n                              <script type=\"text/javascript\">\n                                $('#btnUpdateProfile').on('click', function (e) {\n                                    const name = $('#nameInputProfile').val() || '';\n                                    let username = $('#usernameInputProfile').val()\n                                    let email = $('#emailInputProfile').val()\n                                    let dob = $('#dateInputProfile').val() || ''\n                                    let phone = $('#phoneInputProfile').val()\n                                    let gender = $('#genderInputProfile').val()\n                                    let address = $('#addressInputProfile').val()\n                                    let idCard = $('#idCardInputProfile').val()\n                                    let about = $('#aboutInputProfile').val()\n                    \n                                    let paramFalse = false\n                                    const selectedDate = new Date(dob);\n                                    const now = new Date();\n                                    if (dob && now.getTime() > selectedDate.getTime()) {\n                                        var splitDob = dob.split('-');\n                                        var year = splitDob[0];\n                                        var month = splitDob[1];\n                                        var day = splitDob[2];\n                                        dob = day + \"/\" + month + \"/\" + year\n                                        $('#dateInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#dateInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    var param = {\n                                        name: name,\n                                        email: email,\n                                        dob: dob,\n                                        gender: gender,\n                                    }\n                                    if (validateName(name)) {\n                                        $('#nameInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#nameInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    let oldUsername = $('#oldUsername');\n                                    oldUsername = oldUsername.val() || '';\n                                    if (username != oldUsername){\n                                        if (validateUsername(username)) {\n                                            $('#usernameInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                            let startUsername = username.substr(0,4);\n                                            if (startUsername == 'tuvi') {\n                                                $('#usernameInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                                $('#errUsername').text('Username thay đổi không thể bắt đầu bằng \"tuvi\"')\n                                                paramFalse = true\n                                            } else {\n                                                $('#errUsername').text('');\n                                                param.username = username;\n                                            }\n                                        } else {\n                                            $('#usernameInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                            paramFalse = true\n                                        }   \n                                    }\n                                    if (validateEmail(email)) {\n                                        $('#emailInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#emailInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    if (phone) {\n                                        param.phone = phone;\n                                        if (validatePhone(phone)) {\n                                            $('#phoneInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                        } else {\n                                            $('#phoneInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                            paramFalse = true\n                                        }\n                                    }\n                                    if (address) {\n                                        param.address = address;\n                                        if (validateAddress(address)) {\n                                            $('#addressInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                        } else {\n                                            $('#addressInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                            paramFalse = true\n                                        }\n                                    }\n                                    if (idCard) {\n                                        param.id_card = idCard;\n                                        if (validateIdCard(idCard)) {\n                                            $('#idCardInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                        } else {\n                                            $('#idCardInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                            paramFalse = true\n                                        }\n                                    }\n                                    if (about) {\n                                        if(about.length>250){\n                                            about = about.substr(0,250);\n                                        }\n                                        param.about = about;\n                                    }\n                                    \n                                    if (paramFalse) {\n                                        $('#titleMes').text('Lưu ý!!')\n                                        $('#contentMes').text('Bạn cần điền đầy đủ, chính xác thông tin. Các thông tin sai hoặc thiếu đã được bôi vàng. Vui lòng kiểm tra lại')\n                                    } else {\n                                         $('#warningChangeEmail').text('');\n                                        Agents.put(APIs.users.update, param, function (res) {\n                                            \n                                            if (res) {\n                                                if (res.code == 200) {\n                                                    const oldEmail = $('#oldEmail').val() || '';\n                                                    if(email != oldEmail) {\n                                                         $('#emailInputProfile').css(\"border\", \"2.5px solid red\");\n                                                         $('#warningChangeEmail').text('Kiểm tra Email để xác thực email mới. Nếu không xác thực email sẽ quay về như cũ');\n                                                    }\n                                                    $('span[id=userFullName]').text(name);\n                                                    const username = $('#usernameInputProfile').val();\n                                                    $('#oldUsername').val(username);\n                                                    $('#titleMes').text('Cập nhật thành công')\n                                                    $('#contentMes').text('Bạn đã cập nhật thông tin cá nhân thành công. Tuvi.vn cảm ơn bạn!')\n                                                } else {\n                                                    $('#titleMes').text('Cập nhật không thành công')\n                                                    $('#contentMes').text('Bạn chưa cập nhật thông tin cá nhân thành công, vui lòng kiểm tra lại thông tin cá nhân')\n                                                }\n                                            } else {\n                                                \n                                            }\n                                        }, function (err) {\n                                           const error = err.responseJSON || undefined;\n                                            if(error && error.data) {\n                                                const data = error.data;\n                                                const username = data.username || '';\n                                                const code = username.code || ''\n                                                if(code == \"700002019\") {\n                                                    $('#titleMes').text('Cập nhật không thành công')\n                                                    $('#contentMes').text('Username không hợp lệ, chứa các từ khóa bị cấm');\n                                                    $('#usernameInputProfile').css(\"border\", \"solid 1px red\");\n                                                } else {\n                                                    $('#titleMes').text('Cập nhật không thành công')\n                                                    $('#contentMes').text('Bạn chưa cập nhật thông tin cá nhân thành công, vui lòng kiểm tra lại thông tin cá nhân')\n                                                }\n                                            } else if(error && error.code == \"700002012\") {\n                                                $('#titleMes').text('Cập nhật không thành công')\n                                                $('#contentMes').text('Email đã trùng với tài khoản khác. Vui lòng chọn một Email khác');\n                                                const oldEmail = $('#oldEmail').val() || '';\n                                                $('#emailInputProfile').val(oldEmail);\n                                            } else if(error && error.code == \"700002013\") {\n                                                $('#titleMes').text('Cập nhật không thành công');\n                                                $('#contentMes').text('Username đã trùng với tài khoản khác. Vui lòng chọn một Username khác');\n                                                $('#usernameInputProfile').css(\"border\", \"solid 1px red\");\n                                            } else {\n                                                $('#titleMes').text('Cập nhật không thành công')\n                                                $('#contentMes').text('Bạn chưa cập nhật thông tin cá nhân thành công, vui lòng kiểm tra lại thông tin cá nhân')\n                                            }\n                                        })\n                                    }\n                                })\n                             <\/script>   \n                            "), $("#widget-left #genderInputProfile").val(a), $("#aboutInputProfile").on("keyup", function() {
                                        let t = $(this).val() || "";
                                        t = t.length + "/250", $("#aboutCountCharacter").text(t)
                                    })
                            }
                        }
                    }, function(t) {});
                    break;
                case "3": {
                    window.history.pushState("", "", "?tab=3"), $("#profile-master").addClass("d-none"), $(this).addClass("tab-item-active"), $("#bcProfile").text("Quản lý lá số trên chợ"), $("#widget-left").empty(), $("#profileLaSoManagement").tmpl().appendTo("#widget-left"), $("#title-widget").text("Quản lý lá số trên chợ"), $("#block-topic").tmpl().appendTo("#content-profile"), $("#block-topic").tmpl().appendTo("#content-profile"), $("#block-topic").tmpl().appendTo("#content-profile");
                    const t = $("#widget-left").find("div[data-id=ls-container]"),
                        e = $("#widget-left").find("ul[class=pagination]"),
                        n = $("#widget-left").find("span[data-id=nameList]"),
                        i = ["Lá số trên chợ", "Đã thu hồi", "Đã trả xu mở bình luận khóa"];
                    for (let t = 0; t < n.length; t++) $(n[t]).text(i[t]);
                    a(`${DOMAIN}/users/topics?type=1&search=`, i[0], "topic", $("#lstcCardProfile"), 1, $(t[0]), $(e[0])), a(`${DOMAIN}/users/topics?type=0&search=`, i[1], "topic", $("#lstcCardProfile"), 1, $(t[1]), $(e[1])), a(`${DOMAIN}/users/topics?type=2&search=`, i[2], "topic", $("#unlockedCardProfile"), 1, $(t[2]), $(e[2]));
                    break
                }
                case "4":
                    window.history.pushState("", "", "?tab=4"), $("#profile-master").addClass("d-none"), $(this).addClass("tab-item-active"), $("#bcProfile").text("Quản lý lá số đã tạo"), $("#widget-left").empty(), $("#profileLaSoManagement").tmpl().appendTo("#widget-left"), $("#block-la-so-profile").tmpl().appendTo("#content-profile"), $("#title-widget").text("Quản lý lá số đã tạo"), a(`${DOMAIN}/users/la-so?`, "Lá số đã tạo", "laso", $("#lasoCardProfile"));
                    break;
                case "5":
                    window.history.pushState("", "", "?tab=5"), $("#profile-master").addClass("d-none"), $(this).addClass("tab-item-active"), $("#bcProfile").text("Đã lưu"), $("#widget-left").empty(), $("#profileLaSoManagement").tmpl().appendTo("#widget-left"), $("#block-la-so-profile").tmpl().appendTo("#content-profile"), $("#title-widget").text("Đã lưu"), a(`${DOMAIN}/user/saved-list?module=TOPIC`, "Lá số đã lưu", "topic", $("#saveCardProfile"));
                    break;
                case "6":
                    window.history.pushState("", "", "?tab=6"), $("#profile-master").addClass("d-none"), $(this).addClass("tab-item-active"),
                        function t(e, a) {
                            var n = e;
                            const i = `${DOMAIN}/transactions?pageNumber=${n}&pageSize=${a}`;
                            Agents.get(i, function(e) {
                                if (200 == e.code) {
                                    const u = e.data,
                                        {
                                            balance: h,
                                            all_spent: g,
                                            all_received: f,
                                            edges: v,
                                            total_page: b
                                        } = u;
                                    e.data.balance = formatPrice(h), e.data.all_spent = formatPrice(g), e.data.all_received = formatPrice(f), $(this).addClass("tab-item-active"), $("#bcProfile").text("Lịch sử giao dịch"), $("#widget-left").empty(), $("#profileHistoryManagement").tmpl(e.data).appendTo("#widget-left");
                                    const y = $("#historyTransactionPagination"),
                                        k = $("#list-result-history-profile");
                                    if (v) {
                                        var i = v;
                                        let e;
                                        k.empty(), e = i ? '<tr class="txt-content-bold color-background-line">\n                                                    <td>STT</td>\n                                                    <td>Thời gian</td>\n                                                    <td>Phát sinh giao dịch</td>\n                                                    <td>Giao dịch (Xu)</td>\n                                                    <td>Số dư (Xu)</td>\n                                                  </tr>' : '<p class="txt-content-bold">Chưa có lịch sử giao dịch</p>', k.html(e), i && i.forEach(function(t, e) {
                                            t.index = e + 1;
                                            let a = t.amount || 0;
                                            a = formatPrice(a);
                                            let n = t.new_balance || 0,
                                                i = t.old_balance || 0,
                                                o = t.action_type || "",
                                                s = t.sender_module || "",
                                                r = t.receiver_module || "";
                                            const c = function(t, e, a) {
                                                if (0 == e) return {
                                                    color: "text-xu-cash-back",
                                                    amount: `${e}`
                                                };
                                                return t ? "CASH_BACK" == a ? {
                                                    color: "text-xu-cash-back",
                                                    amount: `+${e}`
                                                } : {
                                                    color: "text-xu-received",
                                                    amount: `+${e}`
                                                } : {
                                                    color: "text-xu-used",
                                                    amount: `-${e}`
                                                }
                                            }(n > i, a, o.toUpperCase());
                                            o = function(t, e, a) {
                                                switch (t) {
                                                    case "DEPOSIT":
                                                        return "Nạp tiền";
                                                    case "CASH_BACK":
                                                        return "Hoàn tiền";
                                                    case "PUSH_LS_TO_MARKET":
                                                        return "Đẩy lá số lên chợ";
                                                    case "UP_TOP_LS_MARKET":
                                                        return "Đẩy lá số lên Top chợ";
                                                    case "GIFT_CODE":
                                                        return "Quà tặng";
                                                    case "UNLOCK_COMMENT":
                                                        return "USER" == e && "SYSTEM" == a ? "Luận giải được mở" : "Mở luận giải";
                                                    default:
                                                        return "Lỗi"
                                                }
                                            }(o.toUpperCase(), r.toUpperCase(), s.toUpperCase()), t.action_type = o, t.color_code = c.color, t.amount = c.amount, t.new_balance = formatPrice(n);
                                            const l = {
                                                item: t
                                            };
                                            var d = $("#lrhpTable").tmpl(l);
                                            k.append(d)
                                        }), n || (n = 1);
                                        var o = b || 0,
                                            s = [];
                                        if (o > 0 && n <= o) {
                                            if (o < 5) s = Array.from(new Array(o), (t, e) => e + 1);
                                            else if (n <= 4) s = Array.from(new Array(5), (t, e) => e + 1);
                                            else if (n >= o - 1)
                                                for (var r = o - 4; r < o + 1; r++) s.push(r);
                                            else s = [n - 2, n - 1, n, n + 1, n + 2];
                                            var c = [];
                                            if (n > 1) {
                                                var l = n - 1,
                                                    d = `<li class="paginationjs-prev" data-page="${l}"><a class="cursor-pointer" >«</a></li>`;
                                                c.push(d)
                                            } else {
                                                var d = '\n                                    <li class="paginationjs-prev disabled">\n                                     <a class="cursor-pointer">«</a>\n                                    </li>\n                                 ';
                                                c.push(d)
                                            }
                                            if (s.forEach(function(t) {
                                                    var e = t == n ? "active" : "",
                                                        a = `\n                                    <li class="paginationjs-page J-paginationjs-page ${e}" data-page="${t}">\n                                          <a class="cursor-pointer">${t}</a>\n                                    </li>\n                                `;
                                                    c.push(a)
                                                }), n < o) {
                                                var p = n + 1,
                                                    m = `\n                                    <li class="paginationjs-next" data-page="${p}">\n                                    <a class="cursor-pointer" >»</a>\n                                    </li>\n                                 `;
                                                c.push(m)
                                            } else {
                                                var m = '\n                                    <li class="paginationjs-next disabled">\n                                    <a class="cursor-pointer">»</a>\n                                    </li>\n                                 ';
                                                c.push(m)
                                            }
                                            y.html(c), y.attr("display", "block"), y.find("li").on("click", function(e) {
                                                const n = $(this);
                                                if (!n.hasClass("active") && !n.hasClass("disabled")) {
                                                    const e = n.attr("data-page"),
                                                        i = parseInt(e);
                                                    t(i, a)
                                                }
                                            })
                                        }
                                    } else k.html('<p class="txt-content-bold">Chưa có lịch sử giao dịch</p>')
                                }
                            }, function(t) {})
                        }(1, 10);
                    break;
                case "7":
                    window.history.pushState("", "", "?tab=7"), $("#profile-master").addClass("d-none"), $("#bcProfile").text("Đổi mật khẩu"), $(this).addClass("tab-item-active"), $("#widget-left").empty(), $("#profileChangePassword").tmpl().appendTo("#widget-left"), $("#widget-left").append("\n                        <script type=\"text/javascript\">\n                                $('#changePasswordProfile').on('click', function (e) {\n                                    let oldPass = $('#oldPasswordInputProfile').val()\n                                    let newPass = $('#newPasswordInputProfile').val()\n                                    let newPassConfirm = $('#newPasswordConfirmInputProfile').val()\n                    \n                                    let paramFalse = false\n                                    if (validatePassword(oldPass)) {\n                                        $('#oldPasswordInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#oldPasswordInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    if (validatePassword(newPass)) {\n                                        $('#newPasswordInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#newPasswordInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    if (validatePassword(newPassConfirm) && newPass === newPassConfirm) {\n                                            $('#newPasswordConfirmInputProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                        } else {\n                                            $('#newPasswordConfirmInputProfile').css(\"border\", \"2.5px solid yellow\")\n                                            paramFalse = true\n                                        }    \n                                    \n                                    if (paramFalse) {\n                                        $(this).attr('type','button');\n                                        $('#titleMes').text('Lưu ý!!')\n                                        $('#contentMes').text('Bạn cần điền đầy đủ, chính xác thông tin. Các thông tin sai hoặc thiếu đã được bôi vàng. Vui lòng kiểm tra lại')\n                                        if (newPass != newPassConfirm) {\n                                            $('#contentMes').text('Nhập lại mật khẩu không chính xác');\n                                        }\n                                        $(this).attr('data-target','#exampleModalCenter');\n                                    } else {\n                                        var param = {\n                                            old_password: oldPass,\n                                            new_password_1: newPass,\n                                            new_password_2: newPassConfirm,\n                                        }\n                                        Agents.post(APIs.auth.changePassword, param, function (res) {\n                                            \n                                            if (res) {\n                                                \n                                                if (res.code == 200) {\n                                                    $('#titleMes').text('Cập nhật thành công')\n                                                    $('#contentMes').text('Bạn đã cập nhật mật khẩu thành công. Tuvi.vn cảm ơn bạn!')\n                                                    window.location.href = '/logout?previous=https://tuvi.vn/login?message=%C4%90%E1%BB%95i%20m%E1%BA%ADt%20kh%E1%BA%A9u%20th%C3%A0nh%20c%C3%B4ng%20%21'\n                                                } else {\n                                                    $('#titleMes').text('Cập nhật không thành công')\n                                                    $('#contentMes').text('Bạn chưa cập nhật mật khẩu thành công, vui lòng kiểm tra lại thông tin cá nhân')\n                                                }\n                                            } else {\n                                                \n                                            }\n                                        }, function (err) {\n                                            const error = err.responseJSON || undefined;\n                                            if(error && error.code == \"500001008\") {\n                                                $('#titleMes').text('Cập nhật không thành công')\n                                                $('#contentMes').text('Sai mật khẩu cũ. Chọn Quên mật khẩu để lấy lại mật khẩu cũ qua email');\n                                            } else {\n                                                $('#titleMes').text('Cập nhật không thành công')\n                                                $('#contentMes').text('Bạn chưa cập nhật mật khẩu thành công, vui lòng kiểm tra lại thông tin cá nhân')\n                                            }\n                                        })\n                                        $(this).attr('data-target','#exampleModalCenter');\n                                        $(this).attr('type','reset');\n                                    }\n                                })\n                             <\/script>       \n                    ");
                    break;
                case "8":
                    window.history.pushState("", "", "?tab=8"), $("#profile-master").addClass("d-none"), $("#bcProfile").text("Quà tặng"), $(this).addClass("tab-item-active"), $("#widget-left").empty(), $("#profileGiftCode").tmpl().appendTo("#widget-left"), $("#widget-left").append("\n                        <script type=\"text/javascript\">\n                            $('#acceptGiftCodeProfile').on('click', function (e) {\n                                    const code = $('#giftCodeProfile').val() || '';\n                                    let paramFalse = false\n                                    var param = {\n                                        code: code,\n                                    }\n                                    if (validateUsername(code)) {\n                                        $('#giftCodeProfile').css(\"border\", \"solid 1px var(--border-color)\")\n                                    } else {\n                                        $('#giftCodeProfile').css(\"border\", \"2.5px solid yellow\")\n                                        paramFalse = true\n                                    }\n                                    if (paramFalse) {\n                                        $('#titleMes').text('Lưu ý!!')\n                                        $('#contentMes').text('Bạn cần điền đúng mã quà tặng. Vui lòng kiểm tra lại')\n                                    } else {\n                                        Agents.post(APIs.gift.code, param, function (res) {\n                                            \n                                            if (res) {\n                                                if (res.code == 200) {\n                                                    var codePrice =  res.data.value\n                                                    var balance = $('#userBalance')\n                                                    var balanceNumber = parseInt(balance.text().replaceAll('.',''))\n                                                    if(codePrice) {\n                                                        balance.text(formatPrice(balanceNumber + parseInt(codePrice)))\n                                                        $('#giftCodeProfile').val('')\n                                                    }\n                                                    $('#titleMes').text('Thành công')\n                                                    $('#contentMes').text('Bạn đã nhập mã quà tặng thành công!')\n                                                } else {\n                                                    $('#giftCodeProfile').val('')\n                                                    $('#titleMes').text('Không thành công')\n                                                    $('#contentMes').text('Mã quà tặng không đúng')\n                                                }\n                                            } else {\n                                                \n                                            }\n                                        }, function (err) {\n                                            $('#giftCodeProfile').val('')\n                                            $('#titleMes').text('Không thành công')\n                                            $('#contentMes').text('Mã quà tặng không đúng')\n                                        })\n                                    }\n                                })\n                        <\/script>            \n                    ");
                    break;
                case "9":
                    $("#btn-logout").on("click", function() {
                        window.location.href = "/logout"
                    })
            }
        }), s) {
        case "tab=1":
            $(".tab-item[data-id=1]").trigger("click");
            break;
        case "tab=2":
            $(".tab-item[data-id=2]").trigger("click");
            break;
        case "tab=3":
            $(".tab-item[data-id=3]").trigger("click");
            break;
        case "tab=4":
            $(".tab-item[data-id=4]").trigger("click");
            break;
        case "tab=5":
            $(".tab-item[data-id=5]").trigger("click");
            break;
        case "tab=6":
            $(".tab-item[data-id=6]").trigger("click");
            break;
        case "tab=7":
            $(".tab-item[data-id=7]").trigger("click")
    }
    $("#modalConfirmDeleteBtn").on("click", function(t) {
        t.preventDefault(), $("#modalConfirmDelete").modal("hide");
        let e = $(this).attr("data-id") || 0,
            n = $(this).attr("data-module") || "topic";
        if (e) {
            let t, i;
            "topic" === n ? (t = `${DOMAIN}/users/topics`, i = {
                id: parseInt(e)
            }) : (t = `${DOMAIN}/la-so-user`, i = {
                id: parseInt(e)
            }), Agents.delete(t, i, function(t) {
                if ("200" == t.code) {
                    if ($(`div[data-id-card=${e}]`).remove(), "topic" === n) {
                        const t = $("#widget-left").find("div[data-id=ls-container]"),
                            e = $("#widget-left").find("ul[class=pagination]"),
                            n = ["Lá số trên chợ", "Đã thu hồi", "Đã trả xu mở bình luận khóa"],
                            i = $(e[0]).find("li.paginationjs-page.J-paginationjs-page.active");
                        let o = i.length ? $(i[0]).attr("data-page") : 1;
                        const s = $(t[0]).find("div[data-name=topic-market]");
                        o > 1 && 0 == s.length && (o -= 1), a(`${DOMAIN}/users/topics?type=1&search=`, n[0], "topic", $("#lstcCardProfile"), o, $(t[0]), $(e[0])), a(`${DOMAIN}/users/topics?type=0&search=`, n[1], "topic", $("#lstcCardProfile"), 1, $(t[1]), $(e[1]))
                    }
                    if ("laso" === n) {
                        let t = $("li.paginationjs-page.J-paginationjs-page.active").attr("data-page") || 1;
                        const e = $("#ls-container").find("div[data-name=la-so-da-tao]");
                        t > 1 && 0 == e.length && (t -= 1), a(`${DOMAIN}/users/la-so?`, "Lá số đã tạo", "laso", $("#lasoCardProfile"), t)
                    }
                }
            }, function(t) {})
        }
    }), $("a[name=toBoardRankPage]").click(function() {
        localStorage.setItem("openCollapse", "criteriaUser"), window.location.href = "/ho-tro-va-hoi-dap"
    }), $("a[name=toBoardRankPageMaster]").click(function() {
        localStorage.setItem("openCollapse", "criteriaPro"), window.location.href = "/ho-tro-va-hoi-dap"
    })
}

function initTopTopicScreen() {
    const t = $("#pagination-topTopics"),
        e = parseInt($("#topTopicPageContainer").attr("data-total-top-topics")),
        a = `${APIs.markets.top}`;
    t.pagination({
        dataSource: a,
        locator: "data.data",
        totalNumber: e,
        pageSize: 4,
        showPageNumbers: !0,
        showPrevious: !0,
        showNext: !0,
        showFirstOnEllipsisShow: !0,
        showLastOnEllipsisShow: !0,
        ajax: {},
        callback: function(t, e) {
            if (t) {
                const e = t;
                $("#topTopicPageContainer").empty(), e.forEach(function(t) {
                    t = topicItemHandler(t), $("#topTopicPage").tmpl(t).appendTo("#topTopicPageContainer")
                })
            }
            initSaveTopicGlobal()
        }
    })
}

function initChoLasoScreen() {
    $("#btnUpLaso").addClass("d-none");
    const t = 1e4,
        e = 1e8;
    $("#min-budget-present").val(formatPrice(t)), $("#max-budget-present").val(formatPrice(e));
    const a = $("#min-budget"),
        n = $("#max-budget");
    g(), $("#pushTopChoLaSo").click(function(t) {
        isLogged() ? window.location.href = "/profile?tab=3" : window.location.href = "/login?previous=/cho-la-so"
    });
    const i = (e - t) / 100,
        o = (e - t - 8 * i) / 9;
    var s = [],
        r = t,
        c = t;
    for (let t = 1; t < 9; t++) {
        let t = {
            start: r = c + o,
            end: c = r + i,
            class: "brake-point"
        };
        s.push(t)
    }
    var l = $("#budgetSlider").slider({
        rangeHighlights: s
    });

    function d() {
        const a = new URLSearchParams(window.location.search),
            n = a.get("page") || 1;
        var i = {
            search: a.get("search") || "",
            min: a.get("min") || t,
            max: a.get("max") || e,
            order: a.get("order") || 0,
            tag: a.get("tag") || 0
        };
        $("#min-budget-present").val(formatPrice(i.min)), $("#max-budget-present").val(formatPrice(i.max)), $("#list-tag-topic > .category").removeClass("current"), $(`#list-tag-topic > .category[data-id=${i.tag}]`).addClass("current"), $("#input-search-topic").val(i.search), $("#orderTopicBy").val(i.order);
        const o = parseFloat(i.min),
            s = parseFloat(i.max);
        l.slider("setValue", [o, s]), u(n, i, !0)
    }

    function p(t) {
        const e = h(),
            a = new URL(window.location);
        a.searchParams.set("page", t), a.searchParams.set("search", e.search), a.searchParams.set("min", e.min), a.searchParams.set("max", e.max), a.searchParams.set("order", e.order), a.searchParams.set("tag", e.tag || 0), window.history.pushState({
            params: e
        }, "", a)
    }

    function m(t, e) {
        const a = $("#topTopicContainer");
        a.empty(), a.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), a.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), a.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), a.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        const n = $(".top-topic-container > .rectangle-left"),
            i = $(".top-topic-container > .rectangle-right");
        n.removeClass("d-flex"), n.addClass("d-none"), i.removeClass("d-flex"), i.addClass("d-none"), Agents.get(`${APIs.markets.top}?pageSize=${t}&pageNumber=${e}`, function(t) {
            setTimeout(function() {
                if (t) {
                    const e = t.data;
                    if (e) {
                        a.empty();
                        const t = e.data || [],
                            o = e.page_info.has_next_page || !1,
                            s = e.page_info.has_previous_page || !1,
                            r = e.page || 1;
                        t.forEach(function(t) {
                            const e = (t = topicItemHandler(t)).id || 0;
                            $("#topicsOrderBy").tmpl(t).appendTo("#topTopicContainer");
                            const a = t.user;
                            a && a.is_thay && $(`a[data-id-topic=${e}] .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="">')
                        }), s && (n.removeClass("d-none"), n.addClass("d-flex"), n.attr("data-page", r)), o && (i.removeClass("d-none"), i.addClass("d-flex"), i.attr("data-page", r)), $(".lazy").lazy()
                    }
                }
            }, 100)
        }, function(t) {})
    }

    function u(t, e, a) {
        a || $("html, body").animate({
            scrollTop: $("#topicsContainer").offset().top
        }, 500);
        const n = $("#topicsContainer");
        n.empty(), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>'), n.append('<div class="linear-background la-so-preview-item text-decoration-none right"></div>');
        var i = `?pageSize=10&pageNumber=${t}`;
        if (e) {
            i += `&max=${e.max}&min=${e.min}&search=${e.search}&order=${e.order}`;
            const t = e.tag;
            t && t > 0 && (i += `&tag=${t}`)
        }
        Agents.get(`${APIs.markets.topics}${i}`, function(t) {
            if (t) {
                const e = t.data;
                e && setTimeout(function() {
                    const t = e.total_count || 0,
                        a = e.total_page || 0,
                        i = e.page || 1;
                    $("#total-topics").html(`Hiện có ${t} lá số`);
                    const o = e.data || [];
                    n.empty(), $("#topics-pagination").css("display", "none"), o.length ? (o.forEach(function(t) {
                        const e = (t = topicItemHandler(t)).id || 0;
                        $("#cardTopicMarket").tmpl(t).appendTo("#topicsContainer");
                        const a = t.user,
                            n = a && a.is_thay;
                        t && t.media && t.media.path && $(`a#${e} .topic-picture-preview`).append(`<img class="topic-picture lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${t.media.path}" alt="topicPicture">`), n && $(`a#${e} .username-topic`).append('<img src="/public/images/icon/professor-verify.png" class="icon-professor-verify ml-1" alt="professorIc">');
                        var i = $(`a#${e} > div.list-tag`);
                        i && 1 == i.length && (i = i[0]);
                        const o = t.tags || [];
                        if (o.length > 0)
                            for (let t = 0; t < o.length; t++) {
                                const e = getIconTagTopic(o[t].id || 0),
                                    a = $(e);
                                var s = $("<div class='small-tag'></div>");
                                s.html(a), $(i).find(".tag-container").append(s)
                            } else $(i).addClass("d-none"), $(i).empty();
                        var r = $(`a#${e} .list-view-user`),
                            c = t.view_users || [],
                            l = t.total_view_user || 0;
                        if (l > 0) {
                            const t = 5 == l ? 5 : l > 5 ? 4 : l;
                            for (let e = 0; e < t; e++) {
                                const t = c[e];
                                var d = t ? t.avatar : "";
                                d && "" != d || (d = "/public/images/avt-default.jpg");
                                const a = t ? t.name : "";
                                var p = $(`<img class="la-so-avt-activity lazy" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="${d}" title="${a}">`);
                                $(r).append(p)
                            }
                            if (l > 5) {
                                let t = l - 4 > 99 ? 99 : l - 4;
                                const e = $('<div class="la-so-preview-activity-more txt-sub-content"></div>').text(`+${t}`);
                                $(r).append(e)
                            }
                        }
                    }), o && o.length && function(t, e) {
                        var a = [];
                        if (t > 0 && e <= t) {
                            if (t < 5) a = Array.from(new Array(t), (t, e) => e + 1);
                            else if (e <= 4) a = Array.from(new Array(5), (t, e) => e + 1);
                            else if (e >= t - 1)
                                for (var n = t - 4; n < t + 1; n++) a.push(n);
                            else a = [e - 2, e - 1, e, e + 1, e + 2];
                            var i = $("#topics-pagination"),
                                o = [];
                            if (e > 1) {
                                var s = e - 1,
                                    r = `<li class="paginationjs-prev" data-page="${s}"><a class="cursor-pointer" >«</a></li>`;
                                o.push(r)
                            } else {
                                var r = '\n                                    <li class="paginationjs-prev disabled">\n                                     <a class="cursor-pointer">«</a>\n                                    </li>\n                                 ';
                                o.push(r)
                            }
                            if (a.forEach(function(t) {
                                    var a = t == e ? "active" : "",
                                        n = `\n                                    <li class="paginationjs-page J-paginationjs-page ${a}" data-page="${t}">\n                                          <a class="cursor-pointer">${t}</a>\n                                    </li>\n                                `;
                                    o.push(n)
                                }), e < t) {
                                var c = e + 1,
                                    l = `\n                                    <li class="paginationjs-next" data-page="${c}">\n                                    <a class="cursor-pointer" >»</a>\n                                    </li>\n                                 `;
                                o.push(l)
                            } else {
                                var l = '\n                                    <li class="paginationjs-next disabled">\n                                    <a class="cursor-pointer">»</a>\n                                    </li>\n                                 ';
                                o.push(l)
                            }
                            i.html(o), $("#topics-pagination").css("display", "block"), $("#topics-pagination > li").on("click", function(t) {
                                const e = $(this);
                                if (!e.hasClass("active") && !e.hasClass("disabled")) {
                                    const t = e.attr("data-page"),
                                        a = parseInt(t);
                                    u(a, h()), p(a)
                                }
                            })
                        }
                    }(a, i), g(), $(".lazy").lazy()) : n.append('<div class="text-center">Không có kết quả tìm kiếm</div>')
                }, 100)
            }
        })
    }

    function h() {
        const t = $("#input-search-topic").val() || "",
            e = $(a).val(),
            i = $(n).val(),
            o = $("#orderTopicBy").val(),
            s = $("#list-tag-topic > div.category.current");
        var r = 0;
        if (s) {
            const t = s[0];
            t && (r = $(t).attr("data-id"))
        }
        return {
            search: t,
            min: e,
            max: i,
            order: o,
            tag: r
        }
    }

    function g() {
        $("button[name=saveTopic]").on("click", function(t) {
            if (t.preventDefault(), isLogged()) try {
                const e = $(this),
                    a = "BUTTON" == t.target.nodeName ? $(t.target.children) : $(t.target),
                    n = e.attr("data-id"),
                    i = e.attr("data-save"),
                    o = `${DOMAIN}/user/saved-list`,
                    s = {
                        module: "TOPIC",
                        item_object: n
                    };
                n && ("false" == i ? Agents.post(o, s, function(t) {
                    if ("200" == t.code) {
                        e.attr("data-save", "true"), a.attr("src", "/public/images/icon/ic-saved.png");
                        const t = $(`button[name=saveTopic][data-id=${n}]`);
                        t.attr("data-save", "true"), t.html(a)
                    }
                }, function(t) {}) : Agents.delete(o, s, function(t) {
                    if ("200" == t.code) {
                        e.attr("data-save", "false"), a.attr("src", "/public/images/icon/ic-save.png");
                        const t = $(`button[name=saveTopic][data-id=${n}]`);
                        t.attr("data-save", "false"), t.html(a)
                    }
                }, function(t) {}))
            } catch (t) {} else openModalLogin(t)
        })
    }
    l.on("slide", function(a) {
        const n = a.value;
        if (n && 2 == n.length) {
            const a = n[0] || t,
                i = n[1] || e;
            $("#min-budget-present").val(formatPrice(a)), $("#max-budget-present").val(formatPrice(i))
        }
    }), l.on("slideStop", function(t) {
        const e = t.value,
            i = e[0],
            o = e[1];
        $(a).val(i), $("#min-budget-present").val(formatPrice(i)), $(n).val(o), $("#max-budget-present").val(formatPrice(o))
    }), $(a).on("change", function(e) {
        const a = parseFloat($(n).val()),
            i = parseFloat($(this).val()),
            o = i > t ? i < a ? i : a - 1 : t;
        l.slider("setValue", [o, a]), $(this).val(o), $("#min-budget-present").val(formatPrice(o))
    }), $("#min-budget-present, #max-budget-present").on("keydown", function(t) {
        /^[\d]$/.test(t.key) || [8, 17, 18, 37, 38, 39, 40, 46].includes(t.keyCode) || t.preventDefault(), 0 == $(this).val().length && 48 == t.keyCode && t.preventDefault()
    }), $("#min-budget-present, #max-budget-present").on("keyup", function(t) {
        const e = $(this).val();
        e.length > 1 && $(this).val(formatPriceNew(e))
    }), $("#min-budget-present").on("change", function() {
        const t = $(this).val();
        $(a).val(t.replaceAll(".", "")), $(a).trigger("change")
    }), $("#max-budget-present").on("change", function() {
        const t = $(this).val();
        $(n).val(t.replaceAll(".", "")), $(n).trigger("change")
    }), $(n).on("change", function(t) {
        const n = parseFloat($(a).val()),
            i = parseFloat($(this).val()),
            o = i < e ? i > n ? i : n + 1 : e;
        l.slider("setValue", [n, o]), $(this).val(o), $("#max-budget-present").val(formatPrice(o))
    }), m(4, 1), $(".top-topic-container > .rectangle-left").on("click", function() {
        const t = $(this).attr("data-page");
        var e = parseInt(t) - 1;
        e >= 1 && m(4, e)
    }), $(".top-topic-container > .rectangle-right").on("click", function() {
        const t = $(this).attr("data-page");
        m(4, parseInt(t) + 1)
    }), $("#list-tag-topic > .category").on("click", function() {
        $("#list-tag-topic > .category").removeClass("current"), $(this).addClass("current"), u(1, h()), p(1)
    }), $("#btnFilterBudget").on("click", function() {
        u(1, h()), p(1)
    }), $("#btn-search-topic").on("click", function() {
        u(1, h()), p(1)
    }), $("#input-search-topic").keyup(function(t) {
        if (13 == t.keyCode) {
            u(1, h()), p(1)
        }
    }), $("#orderTopicBy").on("change", function() {
        u(1, h()), p(1)
    }), $("#criteriaUser").click(function() {
        localStorage.setItem("openCollapse", "criteriaUser"), window.location.href = "/ho-tro-va-hoi-dap"
    }), $("#criteriaPro").click(function() {
        localStorage.setItem("openCollapse", "criteriaPro"), window.location.href = "/ho-tro-va-hoi-dap"
    }), $("#ruleSocial").click(function() {
        localStorage.setItem("openCollapse", "ruleSocial"), window.location.href = "/ho-tro-va-hoi-dap"
    }), d(), window.onpopstate = function(t) {
        d()
    };
    const f = $("#expandParagraph");
    if (f.length > 0) {
        const t = f[0].scrollHeight;
        t > 300 ? (f.attr("style", "height: 300px"), $("#readMore").on("click", function() {
            const e = t + "px";
            f.attr("style", "height: " + e), $(this).empty()
        })) : $("#readMore").empty()
    }
    const v = $(".change-la-so-layout");
    for (let t = 0; t < v.length; t++) {
        const e = v[t];
        $(e).click(function() {
            v.removeClass("change-la-so-layout-active"), $(this).addClass("change-la-so-layout-active"), ("1" === $(this).attr("data-mode") ? 1 : 0) ? $("#topicsContainer").attr("class", "la-so-preview-grid-layout") : $("#topicsContainer").attr("class", "la-so-preview-row-layout")
        })
    }
    $("#btn-create-laso").click(function(t) {
        isLogged() ? window.location.href = "/dang-la-so" : openModalLogin(t)
    });
    let b = $("#filter-container");
    var y = $("#filter-block");
    const k = y.scrollHeight;
    $(window).width() > 768 ? backFilterToDefaultPosition() : putFilterToBlockMobile(), $("#btnFilterChoLaSo").click(function() {
        if ("true" === $(this).attr("data-expanded")) $(this).attr("style", "background-color: white"), $(this).attr("data-expanded", !1), y.attr("style", "height: 0px"), b.addClass("d-none");
        else {
            $(this).attr("style", "background-color: var(--line-color)"), $(this).attr("data-expanded", !0);
            const t = k + "px";
            y.attr("style", "height: " + t), b.removeClass("d-none")
        }
    })
}

function putFilterToBlockMobile() {
    let t = $(".div-search-topic");
    $("#filter-block").append(t);
    let e = $("#filter-container");
    e.addClass("remove-padding-widget"), e.attr("style", "outline: none !important"), e.addClass("d-none"), $("#filter-block").append(e), $("#call-for-purchase-container-mobile").removeClass("d-none"), $("#call-for-purchase-container-web").addClass("d-none")
}

function backFilterToDefaultPosition() {
    let t = $(".div-search-topic");
    $("#default-filter-position").append(t);
    let e = $("#filter-container");
    e.removeClass("remove-padding-widget"), e.removeClass("d-none"), e.removeAttr("style"), $("#default-filter-position").append(e), $("#call-for-purchase-container-mobile").addClass("d-none"), $("#call-for-purchase-container-web").removeClass("d-none")
}

function resizeChoLaso() {
    const t = $("#right-content-sticky-cho-la-so");
    $(window).width() < 769 ? t.removeClass("sticky-top") : t.addClass("sticky-top")
}

function initPayment() {
    $("div.payments-container > div.payments").on("click", function() {
        $("div.payments-container > div.payments").removeClass("payments-active"), $(this).addClass("payments-active");
        const t = $(this).attr("data-content");
        t && ($(".bank-container").addClass("d-none"), $("#" + t).removeClass("d-none"))
    }), $("div.denominations-container > div.denominations").on("click", function() {
        $("div.denominations-container > div.denominations").removeClass("denominations-active"), $(this).addClass("denominations-active");
        const t = $(this).attr("data-display");
        $("div.price-display > div:nth-child(2)").text(t)
    }), $("div.bank-container > div.banks").on("click", function() {
        $("div.bank-container > div.banks").removeClass("banks-active"), $(this).addClass("banks-active")
    }), $("#paid").on("click", function() {
        if (isLogged()) {
            const i = $(this);
            i.attr("disabled", !0), i.empty(), i.append('<div class="spinner-border" role="status"><span class="sr-only">Loading...</span></div>');
            var t = $("div.payments-container > div.payments.payments-active").attr("data-method"),
                e = $("div.denominations-container > div.denominations.denominations-active").attr("data-value"),
                a = $("div.bank-container > div.banks.banks-active").attr("data-id");
            if (a && t && e) {
                var n = {
                    amount: parseInt(e),
                    bank: a,
                    method: t
                };
                Agents.post(APIs.payments.requestPayment, n, function(t) {
                    if (i.html("Thanh toán"), i.attr("disabled", !1), "200" == t.code) {
                        const e = t.data;
                        e && (window.location.href = e)
                    } else alert("Có lỗi sảy ra !")
                }, function(t) {
                    alert("Có lỗi sảy ra !"), i.attr("disabled", !1)
                })
            } else alert("Vui lòng chọn ngân hàng!");
            i.attr("disabled", !1), i.html("Thanh toán")
        }
    })
}

function initDetailTopic(t) {
    var e = $("#detail-topic").attr("data-id");
    $("#widget-comment").empty();
    var a = window.location.href,
        n = new URL(a).searchParams.get("comment"),
        i = `${APIs.markets.comment}?topic=${e}&limit=10&page=1&commentId=${n}`,
        o = [],
        s = [],
        r = [],
        c = parseInt($("#detail-topic").attr("data-suggest-price"));

    function l(t, e) {
        return new Promise(function(a, n) {
            e && e.length > 0 ? uploadImgToSever(e, function(e) {
                e && "200" == e.code && a({
                    id: t,
                    images: e.data
                })
            }) : a({
                id: t,
                images: []
            })
        })
    }

    function d(t, e, a, n, i, o, s, r, c, l, d, p, m, u, h, g, f) {
        const {
            data: v
        } = e, {
            id: b
        } = v, y = {
            id: b,
            content: a,
            type: n,
            created: i,
            time: sinceTime(i),
            like_count: 0,
            null_like: "d-none",
            owner_report: "d-none",
            is_mod: "d-none",
            total_unlock_str: "d-none",
            user: {
                avatar: o || "/public/images/avt-default.jpg",
                name: s,
                username: r,
                rank: {
                    title: l,
                    id: c
                },
                rank_id: c,
                is_teacher: checkRole() ? "" : "d-none"
            }
        };
        if (2 == n) y.price = formatPrice(d), y.price_null_formart = d;
        else if (a && a.split("\n").length - 1 > 5) {
            if (C = getPosition(a, "\n", 4)) {
                var k = a.substring(0, C),
                    x = a.substring(C, a.length);
                k && x && (y.is_view_more = "", y.show_line = "line-clamp-4", y.content_new = `${k} <span class="d-none" id="more-${b}"> ${x} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${b}" id="dots-${b}">Xem thêm</span>`)
            }
        } else if (a && a.length > 500) {
            var C;
            if (C = 500) {
                k = a.substring(0, C), x = a.substring(C, a.length);
                k && x && (y.is_view_more = "", y.show_line = "line-clamp-4", y.content_new = `${k} <span class="d-none" id="more-${b}"> ${x} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${b}" id="dots-${b}">Xem thêm</span>`)
            }
        } else y.content_new = a, y.is_view_more = "d-none";
        if (f)
            if (y.is_sub = "sub-cmt-margin", y.isSub = !0, y.id_comment = b, y.id = f, $(`#sub-comment-${f}`).length > 0) {
                const t = {
                    item: y
                };
                if (1 == n) {
                    $.template("commentDefaultTemplate", commentDefaultTemplate);
                    var w = checkMod() ? $.tmpl("commentDefaultTemplate", t) : $("#comment-default-user").tmpl(t);
                    $(`#sub-comment-${f}`).append(w), p.text(u + 1)
                } else {
                    w = $("#comment-key-mine").tmpl(t);
                    forContentCommentKey($(w).find("#content-comment-topic"), y.content, b), $(`#sub-comment-${f}`).append(w), p.text(u + 1), m.text(h + 1)
                }
            } else {
                const t = document.createElement("div");
                $(t).attr("id", `sub-comment-${f}`);
                const e = {
                    item: y
                };
                if (1 == n) {
                    $.template("commentDefaultTemplate", commentDefaultTemplate);
                    w = checkMod() ? $.tmpl("commentDefaultTemplate", e) : $("#comment-default-user").tmpl(e);
                    $(t).append(w), $(t).insertAfter(`#comment-${f}`), p.text(u + 1)
                } else {
                    w = $("#comment-key-mine").tmpl(e);
                    forContentCommentKey($(w).find("#content-comment-topic"), y.content, b), $(t).append(w), $(t).insertAfter(`#comment-${f}`), p.text(u + 1), m.text(h + 1)
                }
            }
        else {
            const t = {
                item: y
            };
            if (1 == n) {
                $.template("commentDefaultTemplate", commentDefaultTemplate);
                w = checkMod() ? $.tmpl("commentDefaultTemplate", t) : $("#comment-default-user").tmpl(t);
                $("#container-comment").prepend(w), p.text(u + 1)
            } else {
                w = $("#comment-key-mine").tmpl(t);
                forContentCommentKey($(w).find("#content-comment-topic"), y.content, b), $("#container-comment").prepend(w), p.text(u + 1), m.text(h + 1)
            }
        }
        $("#content-comment-" + g).val(""), $(".content-comment-teacher-" + g).val(""), $("#select-price-comment-" + g).val("0"), $(`.comment-default-topic[data-id-comment=${g}]`).click(), $(".lenght-comment").text("0"), "container" != g && $("#form-comment-" + g).remove(), t.empty(), t.text("Đăng"), deleteCommentDraft(window.location.pathname)
    }

    function p(t, e, a, n, i, o, s) {
        var r = $("div#content-comment-topic[data-sub-id='" + e + "']"),
            c = $("div#content-comment-topic[data-id='" + e + "']"),
            l = $("div#price-comment-topic[data-id='" + e + "']"),
            d = $("div#price-comment-topic[data-sub-id='" + e + "']");
        if (r.length > 0) {
            var p = $("li.edit-comment[data-sub-id='" + e + "']");
            2 == a ? (r.empty(), forContentCommentKey(r, s, e), d.text(`${formatPrice(n)}`), p.attr("data-price", n)) : (p.attr("data-content", s), checkMod() ? (r.html(i), o ? r.next().addClass("d-none") : r.next().removeClass("d-none")) : (r.text(i), r.removeClass("line-clamp-4"), r.next().removeClass("d-none"), o ? r.next().addClass("d-none") : (r.addClass("line-clamp-4"), r.next().text("Xem thêm"))))
        } else {
            var m = $("li.edit-comment[data-id='" + e + "']"),
                u = c[0];
            2 == a ? ($(u).empty(), forContentCommentKey($(u), s, e), $(m[0]).attr("data-price", n), $(l[0]).text(`${formatPrice(n)}`)) : ($(m[0]).attr("data-content", s), checkMod() ? ($(u).html(i), o ? $(u).next().addClass("d-none") : $(u).next().removeClass("d-none")) : ($(u).text(i), $(u).removeClass("line-clamp-4"), $(u).next().removeClass("d-none"), o ? $(u).next().addClass("d-none") : ($(u).addClass("line-clamp-4"), $(u).next().text("Xem thêm"))))
        }
        var h = document.querySelectorAll(".view-image-comment");
        h && h.forEach(t => {
            $(t).remove()
        }), t.empty(), t.text("Xác nhận"), $("#editCommentModal").modal("hide")
    }
    Agents.get(i, function(t) {
        if (t && 200 == t.code) {
            const i = t.data.data;
            t.data && t.data.page_info && !t.data.page_info.has_next_page && (t.data.page_info.next = "d-none"), t.data && t.data.page_info && !t.data.page_info.has_previous_page && (t.data.page_info.previous = "d-none"), checkRole() || (t.data.is_role = "d-none"), $("#widget-comment-topic").tmpl(t.data).appendTo("#widget-comment");
            var a = $("#container-comment");
            getListComment(i, a), n && goToByScroll(`comment-${n}`), a.append(`\n                    <script type="text/javascript">\n                        $('#next-page-comment').on('click', function() {\n                            const btn = $(this)\n                            var pageNew = $(this).attr('data-page')\n                            var hasNextPage = $(this).attr('data-has-next-page')\n                            if(hasNextPage) {\n                                pageNew = parseInt(pageNew) + 1;\n                                var valueSelect = $('#change-option-comment').val();\n                                var url = "${APIs.markets.comment}" + "?topic=${e}&limit=10&page=" + pageNew + "&orderType=" + valueSelect;\n                                Agents.get(url, function(res) {\n                                    if(res && res.code == 200) {\n                                        const dataApi = res.data\n                                        \n                                        btn.attr('data-page', dataApi.page)\n                                        btn.attr('data-has-next-page', dataApi.page_info.has_next_page)\n                                        if(!dataApi.page_info.has_next_page) {\n                                            btn.addClass('d-none')\n                                        }\n                                        const dataListComment = dataApi.data\n                                        var container = $('#container-comment');\n                                        getListComment(dataListComment, container)\n                                    }\n                                }, function(err) {\n                                    \n                                })\n                          }\n                        })\n                        $('#previous-page-comment').on('click', function() {\n                            const btn = $(this)\n                            var pageNew = $(this).attr('data-page')\n                            var hasNextPage = $(this).attr('data-has-next-page')\n                            if(hasNextPage) {\n                                pageNew = parseInt(pageNew) - 1;\n                                var valueSelect = $('#change-option-comment').val();\n                                var url = "${APIs.markets.comment}" + "?topic=${e}&limit=10&page=" + pageNew + "&orderType=" + valueSelect;\n                                Agents.get(url, function(res) {\n                                    if(res && res.code == 200) {\n                                        const dataApi = res.data\n                                        \n                                        btn.attr('data-page', dataApi.page)\n                                        btn.attr('data-has-next-page', dataApi.page_info.has_previous_page)\n                                        if(!dataApi.page_info.has_previous_page) {\n                                            btn.addClass('d-none')\n                                        }\n                                        const dataListComment = dataApi.data\n                                        var container = $('#container-comment');\n                                        getListComment(dataListComment, container, true)\n                                    }\n                                }, function(err) {\n                                    \n                                })\n                          }\n                        })\n                    <\/script>       \n                `)
        }
    }, function(t) {}), saveDraftComment(t), $("#btn-hide-topic").on("click", function() {
        const t = $(this).attr("data-id-topic") || 0;
        $("#modConfirmHide").attr("data-id", t), $("#modConfirmHide").attr("data-target-type", "")
    }), $(document.body).on("click", function(e) {
        var a = t.split("-"),
            n = 0,
            i = a[a.length - 1];
        if (i && (n = i.replace("t", "")), $(e.target).hasClass("btn-like-comment"))
            if (isLogged()) {
                const t = $(e.target);
                var c = t.attr("data-id"),
                    p = t.attr("data-sub-id"),
                    m = {};
                p ? (m.parent_id = parseInt(c), m.id = parseInt(p)) : m.id = parseInt(c), t.hasClass("cmt-like") ? Agents.post(APIs.markets.unLike, m, function(e) {
                    if (e && 200 == e.code) {
                        t.removeClass("cmt-like");
                        var a = t.next(),
                            n = parseInt(a.text());
                        1 == n ? (a.addClass("d-none"), a.text(0)) : a.text(n - 1)
                    }
                }, function(t) {}) : Agents.post(APIs.markets.like, m, function(e) {
                    if (e && 200 == e.code) {
                        t.addClass("cmt-like");
                        var a = t.next();
                        if (a.hasClass("d-none")) a.removeClass("d-none"), a.text(1);
                        else {
                            var n = parseInt(a.text());
                            a.text(n + 1)
                        }
                    }
                }, function(t) {})
            } else openModalLogin(e);
        else if ($(e.target).hasClass("btn-rep-comment"))
            if (isLogged()) {
                const t = $(e.target);
                var u = t.attr("data-id"),
                    h = t.attr("data-sub"),
                    g = t.attr("data-sub-id"),
                    f = {
                        id_parent: u
                    };
                if (f.id = g || u, checkRole() || (f.is_role = "d-none"), 0 == $(`#form-comment-${f.id}`).length)
                    if ("true" == h)
                        if (g) {
                            var v = `div[id=comment-${u}][data-sub-id=${g}]`;
                            $("#template-comment-topic").tmpl(f).insertAfter(v), $(`#content-comment-${g}`).focus()
                        } else $("#template-comment-topic").tmpl(f).insertAfter("#comment-" + u), $(`#content-comment-${u}`).focus();
                else $("#template-comment-topic").tmpl(f).insertAfter("#comment-" + u), $(`#content-comment-${u}`).focus()
            } else openModalLogin(e);
        else if ($(e.target).hasClass("edit-comment"))
            if (isLogged()) {
                s = [];
                var b = (w = $(e.target)).attr("data-content"),
                    y = w.attr("data-type"),
                    k = (w.attr("data-paid"), w.attr("data-price"));
                c = w.attr("data-id"), p = w.attr("data-sub-id");
                if ((T = $("#editCommentInput")).attr("data-type", y), p ? T.attr("data-id", p) : T.attr("data-id", c), 1 == y) $("#formInputPrice").addClass("d-none"), $("#form-input-default-comment").removeClass("d-none"), b && T.val(b);
                else {
                    $("#list-content-edit").empty(), z = p ? $(`.content-comment-topic[data-id=${c}][data-sub-id=${p}]`) : $(`.content-comment-topic[data-id=${c}]`);
                    var x = [],
                        C = [];
                    z && z[0].childNodes.forEach((t, e) => {
                        "SPAN" == $(t).prop("tagName") ? $(t).hasClass("txt-content") ? x.push(t) : $(t).hasClass("text-decoration-underline") || t.childNodes.forEach((t, e) => {
                            x.push(t)
                        }) : x.push(t)
                    }), x && x.forEach((t, e) => {
                        const a = $(t).prop("tagName");
                        "P" == a ? C.push({
                            title: t.textContent,
                            images: [],
                            index: e
                        }) : "SPAN" == a ? (C[C.length - 1].content = t.textContent, C[C.length - 1].length = t.textContent.length) : t.childNodes.forEach((t, e) => {
                            $(t).hasClass("image-comment-key") && C[C.length - 1].images.push({
                                id: parseInt($(t).attr("data-key")),
                                path: $(t).attr("src")
                            })
                        })
                    }), r = C, C && C.forEach((t, e) => {
                        const a = {
                            item: t
                        };
                        var n = $("#template-input-item-comment").tmpl(a);
                        $("#list-content-edit").append(n), t.images.forEach(e => {
                            const a = `<div class="view-image-comment"><img src="${e.path}" class="image-comment-upload" alt=""><div class="cursor-pointer delete-image-comment" data-id="${e.id}" data-type="edit" data-key="edit"><div class="total-icon icon-delete-image-comment"></div></div></div>`;
                            $(`.list-image-comment-${t.index}-edit`).append(a)
                        })
                    }), $("#priceCommentInput").val(k), $("#formInputPrice").removeClass("d-none"), $("#form-input-default-comment").addClass("d-none")
                }
            } else openModalLogin(e);
        else if ($(e.target).hasClass("delete-comment"))
            if (isLogged()) {
                var w = $(e.target),
                    A = (c = parseInt(w.attr("data-id")), p = parseInt(w.attr("data-sub-id")), y = parseInt(w.attr("data-type")), $("#btn-check-delete-comment-topic"));
                A.attr("data-id", c), A.attr("data-sub-id", p), A.attr("data-type", y)
            } else openModalLogin(e);
        else if ($(e.target).hasClass("report-comment"))
            if (isLogged()) {
                w = $(e.target), c = parseInt(w.attr("data-id")), p = parseInt(w.attr("data-sub-id"));
                var T = $("#reportCommentInput");
                p ? T.attr("data-id", p) : T.attr("data-id", c)
            } else openModalLogin(e);
        else if ($(e.target).hasClass("comment-teacher")) {
            w = $(e.target);
            if (isLogged())
                if (checkRole()) {
                    c = w.attr("data-id-comment");
                    $("#form-for-teacher-" + c).removeClass("d-none"), $("#content-comment-" + c).addClass("d-none"), $("#btn-comment-default-" + c).addClass("color-brand"), $("#btn-comment-default-" + c).attr("data-type", 2), setCommentDraft(t)
                } else $(".comment-default-topic").click(), openModalHaveError("Chức năng chưa được mở khóa", "Tính năng này áp dụng cho tài khoản Thầy, vui lòng liên hệ Tuvi.vn để biết thêm thông tin!");
            else $(".comment-default-topic").click(), openModalLogin(e)
        } else if ($(e.target).hasClass("comment-default-topic")) {
            c = (w = $(e.target)).attr("data-id-comment");
            $("#form-for-teacher-" + c).addClass("d-none"), $("#content-comment-" + c).removeClass("d-none"), $("#btn-comment-default-" + c).removeClass("color-brand"), $("#btn-comment-default-" + c).attr("data-type", 1)
        } else if ($(e.target).hasClass("next-page-comment-sub")) {
            const t = $(e.target);
            var I = t.attr("data-page"),
                _ = t.attr("data-has-next-page"),
                P = t.attr("data-parent");
            if (_) {
                I = parseInt(I) + 1;
                var M = `${APIs.markets.comment}?topic=${n}&limit=5&page=${I}&parent=${P}`;
                Agents.get(M, function(e) {
                    if (e && 200 == e.code) {
                        const a = e.data;
                        t.attr("data-page", a.page), t.attr("data-has-next-page", a.page_info.has_next_page), a.page_info.has_next_page || t.addClass("d-none"), getComment(a.data, $("#sub-comment-" + P), a.page, a.page_info.has_next_page, P, !0)
                    }
                }, function(t) {})
            }
        } else if ($(e.target).hasClass("btn-open-comment-key")) {
            const t = $(e.target),
                a = $("#btn-open-comment-key-topic");
            c = t.attr("data-id");
            var S = t.attr("data-sub-id"),
                L = (k = t.attr("data-price"), t.attr("data-price-no-format"));
            isLogged() ? c && (S ? a.attr("data-id", S) : a.attr("data-id", c), a.attr("data-price", L), $("#price-comment-key-topic").text(k)) : openModalLogin(e)
        } else if ($(e.target).hasClass("btn-comment-default"))
            if (isLogged()) {
                const t = $(e.target);
                t.attr("data-target", ""), t.attr("data-toggle", "");
                var N = t.attr("data-id-comment"),
                    D = (n = t.attr("data-topic"), y = t.attr("data-type"), t.attr("data-avatar")),
                    E = t.attr("data-name"),
                    O = t.attr("data-username"),
                    B = t.attr("data-parent"),
                    R = t.attr("data-rank-id"),
                    F = t.attr("data-rank-title"),
                    V = (b = $("#content-comment-" + N).val().trim(), new Date),
                    H = (k = 0, !0),
                    U = [];
                if (t.empty(), t.append('<div class="d-flex justify-content-center align-items-center spinner-image-comment" id="spinner-image-comment">\n                        <div class="spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>'), t.hasClass("color-brand")) {
                    var j = document.querySelectorAll(`.title-comment-teacher-${N}`),
                        q = document.querySelectorAll(`.content-comment-teacher-${N}`),
                        G = [],
                        z = [];
                    j && j.forEach((t, e) => {
                        const a = $(t).text().trim();
                        G.push(a)
                    }), q && q.forEach(t => {
                        const e = $(t).val(),
                            a = $(t).attr("data-key");
                        e.trim().length < 200 && (H = !1), z.push({
                            id: a,
                            content: e
                        })
                    }), H && z.forEach((t, e) => {
                        var a = o.find(e => e.id == t.id),
                            n = a ? a.listFile : [],
                            i = {
                                id: t.id || "",
                                content: t.content || "",
                                title: G[e] || "",
                                images: n
                            };
                        U.push(i)
                    }), U && U.length > 0 && (b = U, k = parseInt($(`#select-price-comment-${N}`).val()))
                }
                if (1 == y && b.length > 1e3 && (b = ""), b && b.length > 0 && n && y) {
                    m = {
                        topic: parseInt(n)
                    };
                    1 == y ? (m.content = b, m.type = parseInt(y)) : m.contents = b, B && (m.parent = parseInt(B)), H && (m.price = k);
                    var K = $("#total-comment"),
                        X = $("#total-comment-key"),
                        J = parseInt(K.text()),
                        Y = parseInt(X.text()),
                        W = (x = m.contents, []);
                    x && x.forEach(function(t) {
                        W.push(l(t.id, t.images))
                    }), W && W.length > 0 && Promise.all(W).then(function(e) {
                        m.contents.forEach(function(t) {
                            let a = e.find(e => e.id == t.id);
                            if (a) {
                                var n = [];
                                a.images.forEach(function(t) {
                                    n.push({
                                        id: t.id,
                                        path: t.path
                                    })
                                }), t.images = n, delete t.id
                            }
                        }), Agents.post(APIs.markets.commentMaster, m, function(e) {
                            if (e && 200 == e.code) {
                                d(t, e, b, y, V, D, E, O, R, F, k, K, X, J, Y, N, B), o = [];
                                var a = document.querySelectorAll(".view-image-comment");
                                a && a.forEach(t => {
                                    $(t).remove()
                                })
                            }
                        }, function(e) {
                            t.empty(), t.text("Đăng"), openModalHaveError("Chưa viết bình luận", "Để đăng bình luận khóa bạn vui lòng viết đầy đủ bình luận!")
                        })
                    }, function(e) {
                        t.empty(), t.text("Đăng")
                    }), 1 == y && Agents.post(APIs.markets.comment, m, function(e) {
                        e && 200 == e.code && d(t, e, b, y, V, D, E, O, R, F, k, K, X, J, Y, N, B)
                    }, function(e) {
                        t.empty(), t.text("Đăng"), openModalHaveError("Bình luận", "Vui lòng viết bình luận (không quá 1000 ký tự)")
                    })
                } else t.empty(), t.text("Đăng"), 2 == y ? openModalHaveError("Chưa viết bình luận", "Để đăng bình luận khóa bạn vui lòng viết đầy đủ bình luận!") : openModalHaveError("Bình luận", "Vui lòng viết bình luận (không quá 1000 ký tự)")
            } else openModalLogin(e);
        else if ($(e.target).hasClass("btn-delete-form-comment"))
            if (isLogged()) {
                var Q = (w = $(e.target)).attr("data-key");
                $(`#form-comment-${Q}`).remove()
            } else openModalLogin(e);
        else if ($(e.target).hasClass("btn-read-more")) {
            c = (w = $(e.target)).attr("data-id");
            var Z = 0;
            Z = (S = w.attr("data-sub-id")) || c;
            var tt = $(`#more-${Z}`);
            tt.hasClass("d-none") ? (tt.removeClass("d-none"), w.text("Thu gọn")) : (tt.addClass("d-none"), w.text("Xem thêm"))
        } else if ($(e.target).hasClass("delete-image-comment") || $(e.target).hasClass("icon-delete-image-comment")) {
            w = $(e.target);
            $(e.target).hasClass("icon-delete-image-comment") && (w = $(e.target).parent());
            Q = w.attr("data-key"), c = w.attr("data-id"), y = w.attr("data-type");
            var et = w.attr("data-name");
            "edit" == y ? "edit" == Q ? r.forEach(t => {
                var e = (t.images || []).filter(t => t.id != c);
                t.images = e
            }) : s && s.forEach((t, e) => {
                t.id == Q && (t.listFile = t.listFile.filter(t => t.name != et))
            }) : o && o.forEach((t, e) => {
                t.id == Q && (t.listFile = t.listFile.filter(t => t.name != et))
            }), w.parent().remove()
        } else if ($(e.target).hasClass("image-comment-key")) {
            B = (w = $(e.target)).parent();
            var at = w.attr("src");
            $("#img-preview").empty(), B && B[0] && B[0].childNodes && B[0].childNodes.forEach(t => {
                var e = $(t).attr("src");
                e == at ? $("#img-preview").append(`<img src="${e}" alt="" class="img-preview-modal">`) : $("#img-preview").append(`<img src="${e}" alt="" class="img-preview-modal d-none">`)
            })
        } else if ($(e.target).hasClass("mode-hide-comment-topic")) {
            const t = (w = $(e.target)).attr("data-sub-id") || w.attr("data-id"),
                a = w.attr("data-sub-id") ? "data-sub-id" : "data-id";
            $("#modConfirmHide").attr("data-id", t), $("#modConfirmHide").attr("data-target-type", a)
        } else if ($(e.target).hasClass("btn-read-more-default-comment")) {
            w = $(e.target);
            (b = w.prev()).hasClass("line-clamp-4") ? (b.removeClass("line-clamp-4"), w.text("Thu gọn")) : (b.addClass("line-clamp-4"), w.text("Xem thêm"))
        }
    }), $(document.body).on("change", function(t) {
        if ($(t.target).hasClass("change-option-comment")) {
            var a = $(t.target).val(),
                n = `${APIs.markets.comment}?topic=${e}&limit=10&page=1&orderType=${a}`;
            Agents.get(n, function(t) {
                if (t && 200 == t.code) {
                    const n = t.data.data;
                    var e = $("#next-page-comment");
                    e.removeClass("d-none"), t.data && t.data.page_info && !t.data.page_info.has_next_page && e.addClass("d-none"), e.attr("data-page", t.data.page), e.attr("data-has-next-page", t.data.page_info.has_next_page);
                    var a = $("#container-comment");
                    a.empty(), getListComment(n, a)
                }
            }, function(t) {})
        } else if ($(t.target).hasClass("select-price-comment")) {
            var i = parseInt($(t.target).val()),
                r = parseInt($("#text-budget-topic").attr("data-budget").replaceAll(".", ""));
            r && i && i > r && openModalHaveError("Cảnh báo", "Giá bình luận lớn hơn Ngân sách lá số, vui lòng xem xét lại lựa chọn của bạn!")
        } else if ($(t.target).hasClass("file-image-upload-comment")) {
            var c = $(t.target),
                l = c.attr("data-key"),
                d = c.attr("data-type"),
                p = $(`.list-image-comment-${l}`),
                m = $(`.list-image-comment-${l}-edit`);
            "edit" == d ? uploadImgForComment(m, t.target, s, l, d) : uploadImgForComment(p, t.target, o, l, d)
        }
    }), $(document.body).on("keydown", function(t) {
        if ($(t.target).hasClass("text-area-comment") || $(t.target).hasClass("txt-comment-key")) {
            $(t.target).attr("data-id");
            0 == $(t.target).val().length && (13 != t.keyCode && 32 != t.keyCode || t.preventDefault())
        } else 27 == t.keyCode && (t.preventDefault(), $("#close-modal-detail-topic").click())
    }), initSaveTopicGlobal(), $("#editCommentModal").on("show.bs.modal", function(t) {
        $("#warningEditComment").text("")
    }), $("#btn-accept-edit-comment").click(function(t) {
        const e = $(this);
        e.attr("data-target", ""), e.attr("data-toggle", ""), e.empty(), e.append('<div class="d-flex justify-content-center align-items-center spinner-image-comment" id="spinner-image-comment">\n                        <div class="spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>');
        var a = $("#editCommentInput"),
            n = a.val(),
            i = parseInt(a.attr("data-id")),
            o = parseInt(a.attr("data-type")),
            c = parseInt($("#priceCommentInput").val()),
            d = !0,
            m = "";
        if (2 == o) {
            var u = document.querySelectorAll(".title-comment-teacher-edit"),
                h = document.querySelectorAll(".content-comment-teacher-edit"),
                g = [],
                f = [],
                v = !0,
                b = [];
            u && u.forEach(t => {
                const e = $(t).text();
                g.push(e)
            }), h && h.forEach(t => {
                const e = $(t).val(),
                    a = $(t).attr("data-key");
                e.length < 200 && (d = !1), f.push({
                    id: a,
                    content: e
                })
            }), d && f.forEach((t, e) => {
                var a = s.find(e => e.id == t.id),
                    n = a ? a.listFile : [],
                    i = {
                        id: t.id || "",
                        content: t.content || "",
                        title: g[e] || "",
                        images: n
                    };
                b.push(i)
            }), b && b.length > 0 && (n = b)
        } else {
            if (n && n.split("\n").length - 1 > 5) {
                if (x = getPosition(n, "\n", 4)) {
                    var y = n.substring(0, x),
                        k = n.substring(x, n.length);
                    y && k && (v = !1, m = `${y} <span class="d-none" id="more-${i}"> ${k} </span><span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${i}" id="dots-${i}">Xem thêm</span>`)
                }
            } else if (n && n.length > 500) {
                var x;
                if (x = 500) {
                    y = n.substring(0, x), k = n.substring(x, n.length);
                    y && k && (v = !1, m = `${y} <span class="d-none" id="more-${i}"> ${k} </span><span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${i}" id="dots-${i}">Xem thêm</span>`)
                }
            } else m = n, v = !0
        }
        if (1 == o && n.length > 1e3 && (n = ""), n && n.length > 0 && i && o) {
            var C = {
                id: i
            };
            2 == o ? (C.price = c, C.contents = n) : (C.content = n, C.type = o);
            var w = C.contents,
                A = [];
            w && w.forEach(function(t) {
                A.push(l(t.id, t.images))
            }), A && A.length > 0 && Promise.all(A).then(function(t) {
                let a = C.contents;
                a.forEach(function(e, a) {
                    let n = t.find(t => t.id == e.id);
                    if (n) {
                        var i = [];
                        n.images.forEach(function(t) {
                            i.push({
                                id: t.id,
                                path: t.path
                            })
                        }), e.images = i, delete e.id
                    }
                    var o = r[a].images;
                    o && o.forEach(t => {
                        e.images.push(t)
                    })
                });
                var s = [];
                a.forEach(function(t) {
                    var e = Object.assign({}, t),
                        a = [];
                    (t.images || []).forEach(function(t) {
                        var e = Object.assign({}, t);
                        delete e.path, a.push(e)
                    }), e.images = a, s.push(e)
                }), C.contents = s, Agents.put(APIs.markets.commentMaster, C, function(t) {
                    t && 200 == t.code && p(e, i, o, c, m, v, n)
                }, function(t) {
                    e.empty(), e.text("Xác nhận"), openModalHaveError("Sửa bình luận không thành công", "Bình luận đã được trả phí không thể Sửa!")
                })
            }, function(t) {
                e.empty(), e.text("Xác nhận")
            }), 1 == o && Agents.put(APIs.markets.comment, C, function(t) {
                t && 200 == t.code && p(e, i, o, c, m, v, n)
            }, function(t) {
                e.empty(), e.text("Xác nhận"), openModalHaveError("Sửa bình luận không thành công", "Bình luận đã được trả phí không thể Sửa!")
            })
        } else 2 == o ? (e.attr("data-dismiss", ""), e.empty(), e.text("Xác nhận"), $("#warningEditComment").text("Để sửa bình luận khóa bạn vui lòng viết đầy đủ!"), blinkMe($("#warningEditComment"))) : (e.attr("data-dismiss", ""), e.empty(), e.text("Xác nhận"), $("#warningEditComment").text("Vui lòng viết bình luận (không quá 1000 ký tự)"), blinkMe($("#warningEditComment")))
    }), $("#btn-accept-report-comment").click(function() {
        var t = $("#reportCommentInput"),
            e = parseInt(t.attr("data-id")),
            a = parseInt($("#commentReportTitle").val()),
            n = t.val();
        if (e && a) {
            var i = {
                title_id: a,
                content: n || "",
                comment_id: e
            };
            Agents.post(APIs.markets.report, i, function(e) {
                e && 200 == e.code && (t.val(""), $("#titleCheckMes").text("Phản hồi thành công"), $("#contentCheckMes").text("Phản hồi của bạn đã được gửi đi thành công. Tuvi.vn cảm ơn bạn đã góp ý!"))
            }, function(e) {
                t.val(""), $("#titleCheckMes").text("Phản hồi không thành công"), $("#contentCheckMes").text("Phản hồi của bạn chưa được gửi thành công!")
            })
        }
    }), $("#btn-open-comment-key-topic").click(function(t) {
        var e = $(this).attr("data-id"),
            a = $("#detail-topic").attr("data-name");
        if ($("#openCommentKeyModal").modal("hide"), e) {
            var n = `${APIs.markets.private}?id=${parseInt(e)}`;
            Agents.post(n, null, function(t) {
                if (t && 200 == t.code) {
                    var {
                        data: e
                    } = t, {
                        contents: n,
                        price: i,
                        user: o,
                        id: s
                    } = e, r = o.rank ? o.rank.title || "Lỗi xếp hạng" : "Chưa xếp hạng";
                    const h = {
                        item: {
                            thay: {
                                username: o.username,
                                name: o.name,
                                rank_id: o.rank_id,
                                rank: {
                                    title: r
                                }
                            },
                            user: {
                                name: a
                            },
                            create_at: sinceTime(new Date),
                            amount: formatPrice(i)
                        }
                    };
                    var c = $("#template-history-topic").tmpl(h),
                        l = parseInt($("#budget-topic-history").text().replaceAll(".", "")) - i;
                    l >= 0 && $("#budget-topic-history").text(formatPrice(l));
                    var d = $("#list-history-topic");
                    if ("false" == d.attr("data-history") && (d.empty(), d.attr("data-history", !0)), d.prepend(c), $("#titleCheckMes").text("Thành công"), $("#contentCheckMes").text("Bạn đã mở khóa luận giải thành công, tuvi.vn Cảm ơn bạn!"), $("#checkComment").modal("show"), n && n.length > 0) {
                        var p = $("div#content-comment-key-topic[data-sub-id='" + s + "']"),
                            m = $("div#content-comment-key-topic[data-id='" + s + "']");
                        if (p.length > 0) p.attr("class", ""), p.parent().attr("class", "cmt-bubble-open"), p.addClass("unlocked-cmt-content"), p.next().remove(), p.next().remove(), p.prev().removeClass("d-none"), p.prev().addClass("d-flex"), p.empty(), forContentCommentKey(p, n, s);
                        else {
                            var u = m[0];
                            u && ($(u).empty(), $(u).attr("class", ""), $(u).parent().attr("class", "cmt-bubble-open"), $(u).addClass("unlocked-cmt-content"), $(u).next().remove(), $(u).next().remove(), $(u).prev().removeClass("d-none"), $(u).prev().addClass("d-flex"), forContentCommentKey($(u), n, s))
                        }
                    }
                }
            }, function(t) {
                var e = window.location.href;
                const a = encodeURIComponent(e);
                $("#checkComment").modal("show"), "true" == $("#view-comment-topic").attr("data-owner") ? $("#contentCheckMes").html('<p>Mở khóa luận giải thất bại, vui lòng <span class="text-decoration-underline cursor-pointer text-hyperlink" onclick="clickEditTopic()">thay đổi ngân sách lá số</span> để mở khóa luận giải!</p>') : $("#contentCheckMes").html(`<p>Mở khóa luận giải thất bại, vui lòng <a href="/payment?previous=${a}">nạp thêm xu</a> để mở khóa luận giải!</p>`), $("#titleCheckMes").text("Không thành công")
            })
        }
    }), $("#btn-check-delete-comment-topic").click(function(t) {
        var e = $(this);
        e.attr("data-dismiss", "modal"), e.attr("data-target", ""), e.attr("data-toggle", "");
        var a = parseInt(e.attr("data-id")),
            n = parseInt(e.attr("data-sub-id")),
            i = parseInt(e.attr("data-type")),
            o = $("#total-comment"),
            s = $("#total-comment-key"),
            r = parseInt(o.text()),
            c = parseInt(s.text());
        if (n) {
            var l = {
                id: n
            };
            Agents.delete(APIs.markets.comment, l, function(t) {
                t && 200 == t.code && ($("div[data-sub-id='" + n + "']").remove(), 2 == i ? (o.text(r - 1), s.text(c - 1)) : o.text(r - 1))
            }, function(t) {
                const a = t.responseJSON || void 0;
                a && "600001001" == a.code ? (e.attr("data-dismiss", ""), openModalHaveError("Xóa bình luận không thành công", "Bình luận đã được trả phí không thể xóa!")) : (e.attr("data-dismiss", ""), openModalHaveError("Xóa bình luận không thành công", "Có lỗi xảy ra"))
            })
        } else {
            l = {
                id: a
            };
            Agents.delete(APIs.markets.comment, l, function(t) {
                if (t && 200 == t.code) {
                    var e = $(`#comment-${a}`),
                        n = $(`#sub-comment-${a}`);
                    if (n) {
                        var l = n.next();
                        "true" == l.attr("data-has-next-page") ? (e.remove(), n.remove(), l.remove()) : (e.remove(), n.remove())
                    } else e.remove();
                    2 == i ? (o.text(r - 1), s.text(c - 1)) : o.text(r - 1)
                }
            }, function(t) {
                const e = t.responseJSON || void 0;
                e && "600001001" == e.code ? openModalHaveError("Xóa bình luận không thành công", "Bình luận đã được trả phí không thể xóa!") : openModalHaveError("Xóa bình luận không thành công", "Có lỗi xảy ra")
            })
        }
    }), $("#view-full-screen-topic").click(function(t) {
        $("body").css("overflow", "hidden"), $("#modal-detail-topic").css("display", "block"), $(this).addClass("d-none");
        const e = $("#table-la-so"),
            a = $("#content-detail-la-so"),
            n = $("#setting-la-so");
        a.html(e);
        var i = $(window).height();
        e.css("transform", `scale(${(i+150)/$("#table-la-so")[0].getBoundingClientRect().height}) translate(0%)`), e.css("transform-origin", "50% 0"), e.css("left", "0"), a.css("width", $("#table-la-so")[0].getBoundingClientRect().width), $("#modal-content-detail-topic").css("height", $("#table-la-so")[0].getBoundingClientRect().height);
        const o = $("#widget-comment");
        n.addClass("resize-setting-la-so"), $("#comment-topic-modal").append(n), $("#comment-topic-modal").append(o)
    }), $("#close-modal-detail-topic").click(function() {
        $("#modal-detail-topic").css("display", "none");
        const t = $("#widget-comment"),
            e = $("#table-la-so"),
            a = $("#setting-la-so");
        e.removeAttr("style"), a.removeClass("resize-setting-la-so"), $("#wide-left-content").append(t), $("#content-la-so").append(e), $("#right-content-topic").prepend(a), $("#view-full-screen-topic").removeClass("d-none"), $("body").css("overflow", "")
    }), $("#btn-next-page-history").click(function() {
        var t = $(this),
            a = parseInt(t.attr("data-page"));
        if ("true" == t.attr("data-next-page")) {
            var n = `${APIs.markets.unLock}?topic=${e}&limit=10&page=${a+1}`;
            Agents.get(n, function(e) {
                if (e && 200 == e.code) {
                    const {
                        data: a,
                        page: n,
                        page_info: i
                    } = e.data;
                    t.attr("data-page", n), t.attr("data-next-page", i.has_next_page), i && 0 == i.has_next_page && t.remove(), a && a.forEach((t, e) => {
                        t.amount && (t.amount = formatPrice(t.amount)), t.create_at && (t.create_at = sinceTime(t.create_at));
                        const a = {
                            item: t
                        };
                        var n = $("#template-history-topic").tmpl(a);
                        $("#list-history-topic").append(n)
                    })
                }
            }, function(t) {
                (t.responseJSON || void 0) && openModalHaveError("Lỗi hệ thống", "Có lỗi xảy ra")
            })
        }
    }), $("#modConfirmHide").click(function() {
        openModalHideMod($(this).attr("data-id"), $(this).attr("data-target-type"))
    }), $(".button-preview-image-modal").click(function() {
        var t, e, a, n = $(this),
            i = $("#img-preview"),
            o = n.attr("data-type");
        i && i[0] && i[0].childNodes.length > 1 && (i[0].childNodes.forEach((n, o) => {
            $(n).hasClass("d-none") || (t = n), 0 == o ? e = n : o == i[0].childNodes.length - 1 && (a = n)
        }), t && ("next" == o ? ($(t).addClass("d-none"), $(t).next().length > 0 ? $(t).next().removeClass("d-none") : $(e).removeClass("d-none")) : ($(t).addClass("d-none"), $(t).prev().length > 0 ? $(t).prev().removeClass("d-none") : $(a).removeClass("d-none"))))
    });
    const m = $("#inputTitleTopic");
    let u = m.val() || "";
    u = u.trim();
    const h = $("#list-tag-edit-topic").find("div");
    for (var g = [], f = [], v = 0; v < h.length; v++) g.push(h[v].className), v > 0 && (f.push(parseInt($(h[v]).attr("data-id-tag"))), $(h[v]).on("click", function() {
        $(h[0]).removeClass("current"), $(this).hasClass("current") ? $(this).removeClass("current") : $(this).addClass("current");
        const t = $("#list-tag-edit-topic").find(".current");
        t.length === h.length - 1 && (h.removeClass("current"), $(h[0]).addClass("current")), checkSuggestPriceCurrent(t, $("#txt-suggest-price"), c)
    }));
    $(h[0]).on("click", function() {
        h.removeClass("current"), $(this).addClass("current")
    });
    const b = $("select[name=yearTieuVan]"),
        y = b.val(),
        k = $("select[name=yearsDaiVan]"),
        x = k.val();
    $("#listMaster").attr("hidden", !0), $("#delInput").on("click", function() {
        $("#nameMaster").val(""), $("#nameMaster").attr("placeholder", "Nhập tên thầy..."), $("#nameMaster").on("click", function() {
            $("#listMaster").attr("hidden", !1), eventOnFocusInput()
        })
    });
    const C = $("div.gallery").attr("data-has-img");
    $("#imgEditLaSo").on("change", function() {
        listImg = [], imagesPreview(this, "div.gallery"), hasUpload = !0
    }), $("#btn-edit-topic").click(function(t) {
        if (t.preventDefault(), isLogged()) {
            $("#modalEditTopic").modal("show"), m.val(u);
            const t = m.val().length;
            $("#titleCountCharacter").text(t + "/500"), m.on("keydown", function(t) {
                13 == t.keyCode && t.preventDefault()
            }), m.on("keyup", function(t) {
                const e = $(this).val().length;
                $("#titleCountCharacter").text(e + "/500")
            });
            for (var e = 0; e < h.length; e++) $(h[e]).attr("class", g[e]);
            b.val(y);
            const n = b.attr("data-yob");
            if (parseInt(y) ? $("#tuoiTieuVan").text(parseInt(y) - parseInt(n)) : ($("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100")), b.on("change", function() {
                    parseInt(b.val()) ? ($("#tuoiTieuVan").text(parseInt(b.val()) - parseInt(n)), $("#descriptionTieuVan").removeClass("d-none"), $(".topic-select-tieu-van").removeClass("w-100")) : ($("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100"))
                }),  "true" == C) {
                const t = $(".gallery").attr("data-default");
                if (t) {
                    let e = `<div class="d-flex list-file-img-container list-image-comment-1 flex-wrap"><div class="view-image-comment"><img class="image-comment-upload" src="${t}"><div id="btnDeleteImgCreateTopic" class="cursor-pointer delete-image-comment"><div class="total-icon icon-delete-image-topic"></div></div></div></div>`;
                    listImg = [], $(".gallery").empty(), $(".gallery").append(e), $("#btnDeleteImgCreateTopic").click(function() {
                        $("div.gallery").empty(), listImg = [], hasUpload = !0
                    })
                } else {
                    let t = '<div class="d-flex list-file-img-container list-image-comment-1 flex-wrap"><div class="view-image-comment"><img class="image-comment-upload" src="#" alt="loadImg_error"><div id="btnDeleteImgCreateTopic" class="cursor-pointer delete-image-comment"><div class="total-icon icon-delete-image-topic"></div></div></div></div>';
                    listImg = [], $(".gallery").empty(), $(".gallery").append(t), $("#btnDeleteImgCreateTopic").click(function() {
                        $("div.gallery").empty(), listImg = [], hasUpload = !0
                    })
                }
            }
            "false" == C && (listImg = [], $(".gallery").empty()), k.val(x);
            const i = $("#nameMaster").attr("data-default-master");
            i ? ($("#nameMaster").val(i), $("#delInput").attr("hidden", !1), $("#nameMaster").attr("disabled", !0)) : ($("#delInput").attr("hidden", !0), $("#nameMaster").val(""), $("#nameMaster").attr("placeholder", "Nhập tên thầy..."), $("#nameMaster").attr("disabled", !1), $("#nameMaster").on("click", function() {
                $("#listMaster").attr("hidden", !1), eventOnFocusInput()
            }));
            var a = $("#list-tag-edit-topic > .category.current");
            a && checkSuggestPriceCurrent(a, $("#txt-suggest-price"), c)
        } else openModalLogin(t)
    }), $("#formEditTopic").on("submit", function(t) {
        if ($(this).find("button").attr("disabled", !0), isLogged()) {
            t.preventDefault();
            const n = $("#name-la-so").text() || "",
                i = $(this).find("div[id=errorForm]"),
                o = $(this).find("textarea[id=inputTitleTopic]").val(),
                s = parseInt($(this).find("input[name=idTopic]").val()),
                r = parseFloat($(this).find("select[name=budget]").val()),
                c = $("#list-tag-edit-topic").find("div.category.current"),
                l = "0" !== $(this).find("select[name=yearTieuVan]").val() ? "Tiểu vận " + $(this).find("select[name=yearTieuVan]").val() + " (" + $(this).find("#descriptionTieuVan").text() + ")" : "",
                d = "0" !== $(this).find("select[name=yearsDaiVan]").val() ? $(this).find("select[name=yearsDaiVan]").val() : "",
                p = "" !== $("#nameMaster").attr("data-id-master-selected") ? parseInt($("#nameMaster").attr("data-id-master-selected")) : 0;
            var e = [];
            if (1 == c.length && "0" == $(c[0]).attr("data-id-tag")) e = f;
            else
                for (var a = 0; a < c.length; a++) e.push(parseInt($(c[a]).attr("data-id-tag")));
            if (0 == e.length) $(i).text("Chọn tối thiểu 1 chủ đề"), blinkMe(i);
            else if (o.length < 3 || o.length > MAX_LENGTH_TITLE_TOPIC) $(i).text("Tiêu đề là bắt buộc và có độ dài từ 3-" + MAX_LENGTH_TITLE_TOPIC + " ký tự"), blinkMe(i);
            else {
                const t = `${DOMAIN}/markets/topics`,
                    a = {
                        title: o,
                        budget: r,
                        id: s,
                        tags: e,
                        dai_van: d,
                        tieu_van: l,
                        name: n
                    };
                if (p && (a.masters = [{
                        id: p
                    }]), hasUpload) listImg && listImg.length ? Promise.all([uploadImgTopic(listImg)]).then(function(e) {
                    if (e && e.length) {
                        let n = e[0].images || [],
                            o = n.length ? n[0].id : 0;
                        o && (a.media = parseInt(o)), Agents.put(t, a, function(t) {
                            $("#formEditTopic").find("button").attr("disabled", !1), "200" == t.code && window.location.reload()
                        }, function(t) {
                            $("#formEditTopic").find("button").attr("disabled", !1);
                            const e = window.location,
                                a = encodeURIComponent(e),
                                n = t.responseJSON;
                            "5000008" == n.msg && ($(i).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${a}'>Nạp ngay</a>`), blinkMe(i)), "5000009" == n.msg && ($(i).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(i))
                        })
                    }
                }) : Agents.put(t, a, function(t) {
                    $("#formEditTopic").find("button").attr("disabled", !1), "200" == t.code && window.location.reload()
                }, function(t) {
                    $("#formEditTopic").find("button").attr("disabled", !1);
                    const e = window.location,
                        a = encodeURIComponent(e),
                        n = t.responseJSON;
                    "5000008" == n.msg && ($(i).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${a}'>Nạp ngay</a>`), blinkMe(i)), "5000009" == n.msg && ($(i).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(i))
                });
                else if (C) {
                    let e = $(".gallery").attr("data-id-img");
                    a.media = parseInt(e), Agents.put(t, a, function(t) {
                        $("#formEditTopic").find("button").attr("disabled", !1), "200" == t.code && window.location.reload()
                    }, function(t) {
                        $("#formEditTopic").find("button").attr("disabled", !1);
                        const e = window.location,
                            a = encodeURIComponent(e),
                            n = t.responseJSON;
                        "5000008" == n.msg && ($(i).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${a}'>Nạp ngay</a>`), blinkMe(i)), "5000009" == n.msg && ($(i).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(i))
                    })
                } else Agents.put(t, a, function(t) {
                    $("#formEditTopic").find("button").attr("disabled", !1), "200" == t.code && window.location.reload()
                }, function(t) {
                    $("#formEditTopic").find("button").attr("disabled", !1);
                    const e = window.location,
                        a = encodeURIComponent(e),
                        n = t.responseJSON;
                    "5000008" == n.msg && ($(i).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${a}'>Nạp ngay</a>`), blinkMe(i)), "5000009" == n.msg && ($(i).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(i))
                })
            }
            $("#formEditTopic").find("button").attr("disabled", !1)
        } else t.preventDefault(), openModalLogin(t)
    }), $("#pushTop").click(function(t) {
        if (isLogged()) {
            const t = `${DOMAIN}/markets/topics/top`,
                e = parseInt($("input[name=idTopic]").val());
            Agents.post(t, {
                id: e
            }, function(t) {
                if (t && t.hasOwnProperty("code") && "200" == t.code) {
                    const t = '<p>Lá số của bạn đã lên <span class="txt-content-bold">TOP Chợ Lá Số</span></p>',
                        e = "Đẩy TOP thành công";
                    $("p[data-name=titleMessage]").text(e), $("div[data-name=contentMessage]").html(t)
                }
            }, function(t) {
                const e = t.responseJSON;
                if (e && "5000008" == e.msg) {
                    $("p[data-name=titleMessage]").text("Không thành công");
                    const t = window.location,
                        e = encodeURIComponent(t);
                    $("div[data-name=contentMessage]").html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${e}'>Nạp ngay</a>`);
                    const a = $("#modalMessage").find("button");
                    $(a).text("Nạp"), $(a).click(function() {
                        window.location.href = "/payment?previous=" + e
                    })
                }
            }), $(this).attr("data-target", "#modalMessage"), $(this).attr("data-toggle", "modal")
        } else openModalLogin(t)
    }), $("#openModalPushTop").click(function(t) {
        t.preventDefault(), isLogged() ? $("#modalTopTopic").modal("show") : openModalLogin(t)
    }), $("#btn-chi-them").click(function() {
        $("#btn-edit-topic").click()
    }), $(document.body).bind("input propertychange", function(t) {
        if ($(t.target).hasClass("txt-comment-key")) {
            var e = $(t.target),
                a = e.attr("data-key"),
                n = e.attr("data-id-comment"),
                i = e.val().trim().length;
            $(`#lenght-comment-${a}-${n}`).text(`${i}`)
        }
    }), $("#content-comment").keydown(function(t) {
        13 == t.keyCode && alert("you pressed enter ^_^")
    })
}

function initPaymentCallback() {
    const t = $("input#previousPayment").val() || "";
    if ("" !== t) {
        $("#linkRedirect").attr("href", t);
        var e = 5,
            a = setInterval(function() {
                e <= 0 ? (clearInterval(a), document.getElementById("timerRedirect").innerHTML = "Kết thúc", window.location.href = t) : document.getElementById("timerRedirect").innerHTML = "Bạn sẽ được quay trở lại trang gần nhất sau " + e + " giây ...", e -= 1
            }, 1e3)
    } else $("#countDownRedirect").empty()
}

function getComment(t, e, a, n, i, o) {
    const s = document.createElement("div");
    $(s).attr("id", `sub-comment-${i}`);
    var r = $("#view-comment-topic").attr("data-owner");
    if (t && t.forEach((t, e) => {
            if (t.is_sub = "sub-cmt-margin", t.isSub = !0, t.time = sinceTime(t.created), t.id_comment = t.id, t.id = i, 0 == t.total_unlock && (t.total_unlock_str = "d-none"), 2 == t.type);
            else if (t.content && t.content.split("\n").length - 1 > 5) {
                if (o = getPosition(t.content, "\n", 4)) {
                    var a = t.content.substring(0, o),
                        n = t.content.substring(o, t.content.length);
                    a && n && (t.is_view_more = "", t.show_line = "line-clamp-4", t.content_new = `${a} <span class="d-none" id="more-${t.id_comment}"> ${n} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${t.id_comment}" id="dots-${t.id_comment}">Xem thêm</span>`)
                }
            } else if (t.content && t.content.length > 500) {
                var o;
                if (o = 500) {
                    a = t.content.substring(0, o), n = t.content.substring(o, t.content.length);
                    a && n && (t.is_view_more = "", t.show_line = "line-clamp-4", t.content_new = `${a} <span class="d-none" id="more-${t.id_comment}"> ${n} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${t.id_comment}" id="dots-${t.id_comment}">Xem thêm</span>`)
                }
            } else t.content_new = t.content, t.is_view_more = "d-none";
            if (t.user.avatar || (t.user.avatar = "/public/images/icon/ic_default_avt.jpg"), t.user.rank || (t.user.rank = {
                    id: 1
                }), t.user.is_thay || (t.user.is_teacher = "d-none"), t.is_like && (t.liked = "cmt-like"), t.is_owner ? t.owner_report = "d-none" : t.owner_cmt = "d-none", checkMod() || (t.is_mod = "d-none"), "false" != r || t.is_owner || (t.owner_delete = "d-none"), t.like_count && 0 !== t.like_count || (t.null_like = "d-none"), t.price ? (t.price_null_formart = t.price, t.price = `${formatPrice(t.price)}`) : (t.price_null_formart = 0, t.price = "0"), 1 == t.type) {
                const e = {
                    item: t
                };
                $.template("commentDefaultTemplate", commentDefaultTemplate);
                var c = checkModComment(t.user.is_moderator) ? $.tmpl("commentDefaultTemplate", e) : $("#comment-default-user").tmpl(e);
                $(s).append(c)
            } else if (t.is_owner) {
                const e = {
                    item: t
                };
                c = $("#comment-key-mine").tmpl(e);
                forContentCommentKey($(c).find("#content-comment-topic"), t.contents, t.id_comment), $(s).append(c)
            } else if (t.is_paid) {
                const e = {
                    item: t
                };
                c = $("#comment-key-unlock").tmpl(e);
                forContentCommentKey($(c).find("#content-comment-topic"), t.contents, t.id_comment), $(s).append(c)
            } else {
                const e = {
                    item: t
                };
                c = $("#comment-key-lock").tmpl(e);
                forContentCommentKey($(c).find("#content-comment-topic"), t.contents, t.id_comment), $(s).append(c)
            }
        }), e.append(s), n && !o) {
        var c = '<button class="txt-content-mid text-hyperlink regular-m btn cmt-act-btn hover-line-color sub-cmt-margin next-page-comment-sub"' + `                   id="next-page-comment-sub" data-page="${a}" data-has-next-page="${n}" data-parent="${i}">▼ Xem thêm bình luận</button>`;
        e.append(c)
    }
}

function getListComment(t, e, a) {
    e.append('<div class="d-flex justify-content-center align-items-center spinner-image-comment" id="spinner-image-comment">\n                        <div class="spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>');
    var n = e.find(".spinner-image-comment");
    t && a && (t = t.reverse()), t && t.forEach((t, i) => {
        var o = $("#view-comment-topic").attr("data-owner");
        if (t.time = sinceTime(t.created), 2 == t.type);
        else if (t.content && t.content.split("\n").length - 1 > 5) {
            if (c = getPosition(t.content, "\n", 4)) {
                var s = t.content.substring(0, c),
                    r = t.content.substring(c, t.content.length);
                s && r && (t.is_view_more = "", t.show_line = "line-clamp-4", t.content_new = `${s} <span class="d-none" id="more-${t.id}"> ${r} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${t.id}" id="dots-${t.id}">Xem thêm</span>`)
            }
        } else if (t.content && t.content.length > 500) {
            var c;
            if (c = 500) {
                s = t.content.substring(0, c), r = t.content.substring(c, t.content.length);
                s && r && (t.is_view_more = "", t.show_line = "line-clamp-4", t.content_new = `${s} <span class="d-none" id="more-${t.id}"> ${r} </span> <span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${t.id}" id="dots-${t.id}">Xem thêm</span>`)
            }
        } else t.content_new = t.content, t.is_view_more = "d-none";
        if (0 == t.total_unlock && (t.total_unlock_str = "d-none"), t.user.avatar || (t.user.avatar = "/public/images/icon/ic_default_avt.jpg"), t.user.rank || (t.user.rank = {
                id: 1
            }), t.user.is_thay || (t.user.is_teacher = "d-none"), t.is_like && (t.liked = "cmt-like"), t.price ? (t.price_null_formart = t.price, t.price = `${formatPrice(t.price)}`) : (t.price_null_formart = 0, t.price = "0"), t.is_owner ? t.owner_report = "d-none" : t.owner_cmt = "d-none", checkMod() || (t.is_mod = "d-none"), "false" != o || t.is_owner || (t.owner_delete = "d-none"), t.like_count && 0 !== t.like_count || (t.null_like = "d-none"), t.subs && t.subs.data && (t.isSub = !0), 1 == t.type) {
            const n = {
                item: t
            };
            $.template("commentDefaultTemplate", commentDefaultTemplate);
            var l = checkModComment(t.user.is_moderator) ? $.tmpl("commentDefaultTemplate", n) : $("#comment-default-user").tmpl(n);
            a ? e.prepend(l) : e.append(l), t.subs && t.subs.data && getComment(t.subs.data, e, t.subs.page, t.subs.page_info.has_next_page, t.id)
        } else if (t.is_owner) {
            const n = {
                item: t
            };
            l = $("#comment-key-mine").tmpl(n);
            forContentCommentKey($(l).find("#content-comment-topic"), t.contents, t.id), a ? e.prepend(l) : e.append(l), t.subs && t.subs.data && getComment(t.subs.data, e, t.subs.page, t.subs.page_info.has_next_page, t.id)
        } else if (t.is_paid) {
            const n = {
                item: t
            };
            l = $("#comment-key-unlock").tmpl(n);
            forContentCommentKey($(l).find("#content-comment-topic"), t.contents, t.id), a ? e.prepend(l) : e.append(l), t.subs && t.subs.data && getComment(t.subs.data, e, t.subs.page, t.subs.page_info.has_next_page, t.id)
        } else {
            const n = {
                item: t
            };
            l = $("#comment-key-lock").tmpl(n);
            forContentCommentKey($(l).find("#content-comment-topic"), t.contents, t.id), a ? e.prepend(l) : e.append(l), t.subs && t.subs.data && getComment(t.subs.data, e, t.subs.page, t.subs.page_info.has_next_page, t.id)
        }
        n.remove()
    }), n.remove()
}

function forContentCommentKey(t, e, a) {
    if (e && t) {
        var n = $(`<span class="d-none" id="more-${a}"></span>`);
        e.forEach((e, a) => {
            var i = getCommentTemplate(e.title, e.content, e.images);
            a > 0 ? n.append(i) : t.append(i)
        }), e.length > 1 && (t.append(n), t.append(`<span class="btn-read-more txt-content-mid text-decoration-underline cursor-pointer" data-id="${a}" id="dots-${a}">Xem thêm</span>`))
    }
}

function getCommentTemplate(t, e, a) {
    if (t && e) {
        var n = `<p class="txt-content-bold mb-0 m-t-10">${t}</p><span class="txt-content m-r-5">${e}</span>`;
        if (a && a.length > 0) {
            var i = "";
            a.forEach((t, e) => {
                i += `<img src="${t.path}" data-key="${t.id}" class="image-comment-key" alt="" data-toggle="modal" data-target="#modalPreviewImage" />`
            }), n += `<div class="d-flex flex-wrap">${i}</div>`
        }
        return n
    }
}

function formatArrayComment(t) {
    var e = [],
        a = (t = t.replaceAll('<strong class="txt-content-bold">', "")).split("</p>");
    return a && a.forEach((t, a) => {
        var n = t.split('</strong><p class="txt-content m-b-10">');
        if (n && n[0] && n[1]) {
            var i = {
                title: n[0],
                content: n[1],
                index: `key-${a}`,
                length: n[1].length
            };
            e.push(i)
        }
    }), e
}

function clickEditTopic() {
    $("#btn-edit-topic").click()
}

function uploadImgForComment(t, e, a, n, i) {
    const o = e.files;
    t[0];
    t.append('<div class="d-flex justify-content-center align-items-center spinner-image-comment" style="width: 74px" id="spinner-image-comment">\n                        <div class="spinner-border spinner-border" role="status">\n                            <span class="sr-only">Loading...</span>\n                        </div>\n                     </div>');
    const s = $(".spinner-image-comment");
    if (0 === o.length) s.remove();
    else {
        if (t[0].childNodes.length < 6)
            for (const e of o) {
                document.createElement("p");
                if (validFileType(e) && validFileSize(e) && isLogged()) {
                    s.remove();
                    const o = `<div class="view-image-comment" data-file="${e}" id="img-${e.name}"><img src="${URL.createObjectURL(e)}" class="image-comment-upload" alt=""><div class="cursor-pointer delete-image-comment" data-name="${e.name}" data-key="${n}" data-type="${i}"><div class="total-icon icon-delete-image-comment"></div></div></div>`;
                    if (a && a.length > 0) {
                        var r = a.find(t => t.id == n);
                        r ? r.listFile.push(e) : a.push({
                            id: n,
                            listFile: [e]
                        }), t.append(o)
                    } else a.push({
                        id: n,
                        listFile: [e]
                    }), t.append(o)
                } else s.remove(), e.size > 2e6 ? alert("Dung lượng ảnh quá lớn") : alert(`File name ${e.name}: Not a valid file type. Update your selection.`)
            }
        s.remove(), $(e).val("")
    }
}

function uploadImgToSever(t, e) {
    var a = new FormData;
    t && t.forEach(t => {
        a.append("files", t, t.name)
    });
    var n = {
        url: APIs.media.upload,
        method: "POST",
        timeout: 0,
        headers: {
            "X-TU-VI": getTOKEN()
        },
        processData: !1,
        mimeType: "multipart/form-data",
        contentType: !1,
        data: a
    };
    $.ajax(n).done(function(t) {
        var a = JSON.parse(t);
        e(a)
    })
}

function setCommentDraft(t) {
    let e = JSON.parse(localStorage.getItem("historyComment"));
    var a = e && e.find(e => e.path == t);
    a && a.comments.forEach((t, e) => {
        $(`textarea.content-comment-teacher-container[data-key=${t.id}]`).val(t.content), $(`#lenght-comment-${t.id}-container`).text(t.content.length)
    })
}

function deleteCommentDraft(t) {
    let e = JSON.parse(localStorage.getItem("historyComment"));
    e && e.length > 0 && (e = e.filter(e => e.path != t), localStorage.setItem("historyComment", JSON.stringify(e)))
}

function saveDraftComment(t) {
    setInterval(function() {
        var e = document.querySelectorAll(".title-comment-teacher-container"),
            a = document.querySelectorAll(".content-comment-teacher-container"),
            n = [],
            i = {
                path: t,
                comments: []
            };
        if (e && e.forEach((t, e) => {
                const a = $(t).text().trim();
                n.push(a)
            }), a && a.forEach(t => {
                if ($(t).val().trim().length > 0) {
                    const e = $(t).val(),
                        a = $(t).attr("data-key");
                    i.comments.push({
                        id: a,
                        content: e
                    })
                }
            }), i.comments.length > 0) {
            let e = JSON.parse(localStorage.getItem("historyComment"));
            if (e && e.length > 0) {
                var o = e.find(e => e.path == t);
                if (o) {
                    var s = e.indexOf(o);
                    e[s] = i
                } else e.push(i);
                localStorage.setItem("historyComment", JSON.stringify(e))
            } else localStorage.setItem("historyComment", JSON.stringify([i]))
        }
    }, 3e3)
}

function initTeacherPolicyScreen() {
    $("#btn-register-teacher").click(function() {
        goToByScroll("formRegisterPolicyTeacher")
    }), $("#btn-register-policy").click(function() {
        const t = $("#name-policy-input").val() || "";
        let e = $("#phone-policy-input").val(),
            a = !1;
        var n = {
            name: t,
            phone: e
        };
        validateName(t) ? $("#name-policy-input").css("border", "solid 1px var(--border-color)") : ($("#name-policy-input").css("border", "2.5px solid yellow"), a = !0), validatePhone(e) ? $("#phone-policy-input").css("border", "solid 1px var(--border-color)") : ($("#phone-policy-input").css("border", "2.5px solid yellow"), a = !0), a ? openModalHaveError("Lưu ý!!", "Bạn cần điền đầy đủ, chính xác thông tin. Các thông tin sai hoặc thiếu đã được bôi vàng. Vui lòng kiểm tra lại") : Agents.post(APIs.others.masterContact, n, function(t) {
            t && (200 == t.code ? openModalHaveError("Thành công", "Đã gửi thông tin thành công!") : openModalHaveError("Không thành công", "Gửi thông tin không thành công! Vui lòng kiểm trả thông tin cá nhân của bạn!"))
        }, function(t) {
            const e = t.responseJSON || void 0;
            e && e.data, openModalHaveError("Không thành công", "Có lỗi xảy ra!")
        })
    })
}

function initPaymentRequestScreen() {
    var t = $("#t-fee").attr("data-value"),
        e = $("#d-fee").attr("data-value");

    function a(t) {
        t && ("200" == t ? ($("#msg").removeClass("d-none"), $("#msg").addClass("d-flex"), $("#msg #info").text("Yêu cầu rút xu của bạn đã được gửi đi thành công !"), $("#msg #content").text("Hệ thống sẽ giữ lại số xu cần rút và kiểm tra, nếu như không có vấn đề gì, quý tín chủ sẽ nhận được thanh toán sau 2-3 ngày làm việc. Liên hệ qua Email: contact@tuvi.vn để được hỗ trợ và hướng dẫn"), $('button[name="request"]').attr("disabled", !0), $("#msg #icon").attr("src", "/public/images/icon/professor-verify.png")) : ($("#msg").removeClass("d-none"), $("#msg").addClass("d-flex"), $("#msg #info").text("Yêu cầu rút xu của bạn đã được gửi đi không thành công !"), $("#msg #content").text("Hệ thống sẽ giữ lại số xu cần rút và kiểm tra, nếu như không có vấn đề gì, quý tín chủ sẽ nhận được thanh toán sau 2-3 ngày làm việc. Liên hệ qua Email: contact@tuvi.vn để được hỗ trợ và hướng dẫn"), $('button[name="request"]').attr("disabled", !0), $("#msg #icon").attr("src", "/public/images/icon/error.png")))
    }

    function n() {
        return function(t) {
            return t = t.replaceAll(".", ""), parseInt(t)
        }($("#userBalance").text())
    }

    function i(t) {
        return t.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, "$1,")
    }

    function o(t, e, a) {
        let n = $(t).val();
        return n && n.length >= e && n.length <= a ? ($(t).removeClass("is-invalid"), !0) : ($(t).addClass("is-invalid"), !1)
    }

    function s(t, e, a) {
        let n = $(t).val();
        return (n = parseInt(n.replaceAll(",", ""))) && n >= e && n <= a ? ($(t).removeClass("is-invalid"), !0) : ($(t).addClass("is-invalid"), !1)
    }
    $('select[name="method"]').on("change", function() {
        0 == $(this).val() ? $(".new-method").removeClass("d-none") : $(".new-method").addClass("d-none")
    }), Agents.get(APIs.payments.request, function(t) {
        const e = t.data || [];
        var a = [];
        e.length > 0 && e.forEach(function(t) {
            var e = t.name + " - " + t.bank.name + " - " + t.account;
            a.push(`<option value="${t.id}">${e}</option>`)
        }), $('select[name="method"]').append(a)
    }, function(t) {}), Agents.get(APIs.payments.banking, function(t) {
        const e = t.data;
        if (e) {
            var a = [];
            e.forEach(function(t) {
                a.push(`<option value="${t.id}">${t.name}</option>`)
            }), $('select[name="bank"]').append(a)
        }
    }, function(t) {}), $('button[name="request"]').on("click", function() {
        var t = s('input[name="amount"]', 5e5, n());
        let e = $('select[name="method"]').val();
        if (0 == (e = parseInt(e))) {
            let e = $('input[name="amount"]').val().trim();
            e = e.replace(/[^0-9]/g, ""), e = parseInt(e);
            const n = {};
            var i = o('input[name="name"]', 3, 50),
                r = o('input[name="account"]', 3, 100);
            if (t && r && i) {
                let t = $('input[name="name"]').val().trim(),
                    i = $('input[name="account"]').val().trim(),
                    o = $('select[name="bank"]').val();
                o = parseInt(o), n.amount = e, n.name = t, n.account = i, n.banking = o, Agents.post(APIs.payments.request, n, function(t) {
                    a(t.code)
                }, function(t) {
                    a(t.responseJSON.code)
                })
            }
        } else {
            let n = $('input[name="amount"]').val().trim();
            n = n.replace(/[^0-9]/g, ""), n = parseInt(n);
            const i = {};
            t && (i.method = e, i.amount = n), Agents.post(APIs.payments.request, i, function(t) {
                if (t) {
                    a(t.code)
                }
            }, function(t) {
                a(t.responseJSON.code)
            })
        }
    }), $('input[name="name"]').on("input", function() {
        o('input[name="name"]', 3, 100)
    }), $('input[name="account"]').on("input", function() {
        o('input[name="account"]', 3, 100)
    }), $('input[name="amount"]').on("input", function() {
        let a = $(this).val();
        a = a.replace(/[^0-9]/g, "");
        var o = parseInt(a) || 0,
            r = i(o);
        $(this).val(r), s('input[name="amount"]', 1e5, n()) && $('button[name="request"]').attr("disabled", !1), $("#r-amount").text(r + " đ");
        var c = o * (t / 100),
            l = o * (e / 100);
        c = parseInt(c);
        var d = parseInt(l);
        $("#r-vat").text(i(c) + " đ"), $("#r-discount-vat").text(i(d) + " đ");
        var p = o - c - d;
        $("#r-result").text(i(p) + " đ")
    })
}

function initDangLaSoScreen() {
    $("#btnUpLaso").addClass("d-none"), $("#tab-create-topic").click(function() {
        $(this).hasClass("step-bar-active") || $("#btn-create-la-so").click()
    }), $("#btn-create-la-so").click(function() {
        var t = $("#nameForm").val(),
            e = $("#dayFormLaSo").val(),
            a = $("#monthFormLaSo").val(),
            n = $("#yearFormLaSo").val(),
            i = $("input[name='calendar']:checked").val(),
            o = $("#hourFormLaSo").val(),
            s = $("input[name='gender']:checked").val(),
            r = $("#viewYearFormLaSo").val(),
            c = $("#viewMonthFormLaSo").val();
        e = e ? parseInt(e) : 1, a = a ? parseInt(a) : 1, n = n ? parseInt(n) : 1, o = o ? parseInt(o) : 1, r = r ? parseInt(r) : 1, c = c ? parseInt(c) : 1;
        var l = {
            name: t,
            day: e,
            month: a,
            year: n,
            solar_calendar: i = "true" == i,
            hour_id: o,
            male: s = "true" == s,
            nam_xem: r,
            thang_xem: c
        };
        Agents.post(APIs.laSo.get, l, function(e) {
            if (200 == e.code) {
                var {
                    slug: a
                } = e.data, n = a.split("-"), i = n[n.length - 1], o = $("#tab-create-topic"), s = $("#tab-create-la-so");
                s.removeClass("step-bar-active"), s.find("step-bar-arrow").remove(), o.addClass("step-bar-active"), o.attr("data-la-so", i), o.attr("data-name", t), $("#createPostPushLaSo").removeClass("d-none"), $("#formCreateLaSo").addClass("d-none");
                var r = APIs.laSo.get + "/" + a;
                Agents.get(r, function(t) {
                    if (200 == t.code) {
                        var {
                            lunar_year: e,
                            cung_model: a
                        } = t.data, n = [], i = $("#yearOfTieuVan2Res"), o = $("#yearDaiVan");
                        i.attr("data-yob", e);
                        for (var s = e + 1; s < e + 101; s++) n.push(s);
                        var r = (new Date).getFullYear(),
                            c = a[0].dai_van,
                            l = c %= 10,
                            d = 0;
                        i.empty(), i.append('<option value="0">Không có nhu cầu xem</option>'), n.forEach(t => {
                            t == r && (d = t), i.append(`<option value="${t}" ${t==r?"selected":""}>${t}</option>`)
                        }), o.empty(), o.append('<option value="0">Không có nhu cầu xem</option>');
                        for (s = 0; s < 11; s++) {
                            var p = `Đại vận ${l+10*s} - ${l+10*s+9}`;
                            o.append(`<option value="${p}">${p}</option>`)
                        }
                        d > 0 ? ($("#tuoiTieuVan").text(d - e + 1), $(".topic-select-tieu-van").removeClass("w-100"), $("#descriptionTieuVan").removeClass("d-none")) : ($("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100"))
                    }
                }, function(t) {})
            }
        }, function(t) {})
    });
    let t = [];
    var e = parseInt($("#body-create-post").attr("data-suggest-price")),
        a = [];
    const n = $("#list-tag-topic").find("div");
    $(n[0]).on("click", function() {
        n.removeClass("current"), $(this).addClass("current")
    });
    for (var i = 1; i < n.length; i++) a.push(parseInt($(n[i]).attr("data-id-tag"))), $(n[i]).on("click", function() {
        $(n[0]).removeClass("current"), $(this).hasClass("current") ? $(this).removeClass("current") : $(this).addClass("current");
        const t = $("#list-tag-topic").find(".current");
        t.length == n.length - 1 && (n.removeClass("current"), $(n[0]).addClass("current")), checkSuggestPriceCurrent(t, $("#txt-suggest-price-create-post"), e)
    });
    $("#createPostPushLaSo").on("submit", function(t) {
        if ($(this).find("button").attr("disabled", !0), isLogged()) {
            t.preventDefault();
            const s = $("#tab-create-topic").attr("data-name") || "",
                r = $(this).find("div[id=errorForm]");
            var e = $(this).find("textarea[id=inputTitleTopic]").val() || "";
            e = e.trim();
            const c = parseInt($("#tab-create-topic").attr("data-la-so")),
                l = parseFloat($(this).find("select[name=budget]").val()),
                d = $("#list-tag-topic").find("div.category.current"),
                p = "0" !== $(this).find("select[name=yearTieuVan]").val() ? "Tiểu vận " + $(this).find("select[name=yearTieuVan]").val() + " (" + $(this).find("#descriptionTieuVan").text() + ")" : "",
                m = "0" !== $(this).find("select[name=yearsDaiVan]").val() ? $(this).find("select[name=yearsDaiVan]").val() : "",
                u = "" !== $("#nameMaster").attr("data-id-master-selected") ? parseInt($("#nameMaster").attr("data-id-master-selected")) : 0,
                h = $("#check-privacy-topic").is(":checked");
            var n = [];
            if (1 == d.length && "0" == $(d[0]).attr("data-id-tag")) n = a;
            else
                for (var i = 0; i < d.length; i++) n.push(parseInt($(d[i]).attr("data-id-tag")));
            if (0 == n.length) $(r).text("Chọn tối thiểu 1 chủ đề"), blinkMe(r), $("#createPostPushLaSo").find("button").attr("disabled", !1);
            else if (e.length < 3 || e.length > MAX_LENGTH_TITLE_TOPIC) $(this).find("textarea[id=inputTitleTopic]").val(e), $("#titleCountCharacter").text(e.length + "/" + MAX_LENGTH_TITLE_TOPIC), $(r).text("Tiêu đề là bắt buộc và có độ dài từ 3-" + MAX_LENGTH_TITLE_TOPIC + " ký tự"), blinkMe(r), $("#createPostPushLaSo").find("button").attr("disabled", !1);
            else {
                const t = `${DOMAIN}/markets/topics`,
                    a = {
                        title: e,
                        budget: l,
                        la_so_id: c,
                        tags: n,
                        dai_van: m,
                        tieu_van: p,
                        name: s,
                        privacy: h ? 2 : 1
                    };
                u && (a.masters = [{
                    id: u
                }]), listImg && listImg.length ? Promise.all([uploadImgTopic(listImg)]).then(function(e) {
                    if (e && e.length) {
                        let n = e[0].images || [],
                            i = n.length ? n[0].id : 0;
                        i && (a.media = i), Agents.post(t, a, function(t) {
                            if ("200" == t.code) {
                                const e = t.data.slug;
                                window.location.href = "/" + e
                            }
                        }, t => o(t))
                    }
                }, function(t) {
                    $(r).html("<span>Lỗi quá trình tải ảnh, hãy chọn ảnh khác và thử lại</span>"), blinkMe(r), $("#createPostPushLaSo").find("button").attr("disabled", !1)
                }) : Agents.post(t, a, function(t) {
                    if ("200" == t.code) {
                        const e = t.data.slug;
                        window.location.href = "/" + e
                    }
                }, t => o(t))
            }

            function o(t) {
                $("#createPostPushLaSo").find("button").attr("disabled", !1);
                const e = t.responseJSON,
                    a = window.location,
                    n = encodeURIComponent(a);
                "5000008" == e.msg && ($(r).html(`<span>Không đủ xu trong ví. Vui lòng nạp thêm để thực hiện!</span> <a href='/payment?previous=${n}'>Nạp ngay</a>`), blinkMe(r)), "600001005" == e.code && ($(r).html(`<span>Số lượt đăng lá số lên chợ có giới hạn. <a href='/payment?previous=${n}'>Nâng cấp</a> lên  <span class="txt-sub-content-mid">Tài khoản VIP</span> để nhận thêm lượt</span>`), blinkMe(r)), "5000009" == e.msg && ($(r).text("Lỗi thanh toán! Vui lòng thử lại sau"), blinkMe(r))
            }
        } else t.preventDefault(), openModalLogin(t), $(this).find("button").attr("disabled", !0)
    }), $("#imgPushLaSo").on("change", function() {
        listImg = [], t = imagesPreview(this, "div.gallery")
    });
    const o = $("select[name=yearTieuVan]"),
        s = o.attr("data-yob");
    if (parseInt(o.val())) {
        var r = parseInt(o.val()) - parseInt(s) + 1;
        $("#tuoiTieuVan").text(r), $(".topic-select-tieu-van").removeClass("w-100")
    } else $("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100");
    o.on("change", function() {
        const t = o.attr("data-yob");
        if (parseInt(o.val())) {
            var e = parseInt(o.val()) - parseInt(t) + 1;
            $("#tuoiTieuVan").text(e), $("#descriptionTieuVan").removeClass("d-none"), $(".topic-select-tieu-van").removeClass("w-100")
        } else $("#descriptionTieuVan").addClass("d-none"), $(".topic-select-tieu-van").addClass("w-100")
    });
    const c = $("#inputTitleTopic");
    c.on("keydown", function(t) {
        13 == t.keyCode && t.preventDefault()
    }), c.on("keyup", function(t) {
        const e = $(this).val().length;
        $("#titleCountCharacter").text(e + "/" + MAX_LENGTH_TITLE_TOPIC)
    }),  searchMaster(), $("#tab-create-la-so").click(function() {
        $("#btn-back-dang-la-so").click()
    }), $("#btn-back-dang-la-so").click(function() {
        var t = $("#tab-create-topic");
        $("#tab-create-la-so").addClass("step-bar-active"), t.find("step-bar-arrow").remove(), t.removeClass("step-bar-active"), $("#createPostPushLaSo").addClass("d-none"), $("#formCreateLaSo").removeClass("d-none")
    })
}

function checkSuggestPriceCurrent(t, e, a) {
    var n = !1;
    for (let o = 0; o < t.length; o++) {
        var i = t[o];
        0 == $(i).attr("data-id-tag") && (n = !0, e.text(`Giá gợi ý: tối thiểu ${formatPrice(12*a)} Xu`))
    }
    n || e.text(`Giá gợi ý: tối thiểu ${formatPrice(a*t.length)} Xu`)
}
$(".collapse").on("show.bs.collapse", function() {
    $(this).prev().find(".icon-up").addClass("turn-up")
}), $(".collapse").on("hide.bs.collapse", function() {
    $(this).prev().find(".icon-up").removeClass("turn-up")
});

